196,608	2015-08-10 15:23:14		desk_com_connector.internal_validateServerVersion	create virtual procedure desk_com_connector.internal_validateServerVersion (
) as
begin
    declare integer server_build_min = 2976 ;
    declare integer server_interfaces_min = 4342 ;
    declare integer server_core_min = 4481 ;
    declare integer server_infrastructure_min = 1682 ;
    declare integer server_build_current ;
    declare integer server_interfaces_current ;
    declare integer server_core_current ;
    declare integer server_infrastructure_current ;
    server_build_current = select
            cast (
                substring (
                    b.build
                    ,1
                    ,4
                ) as integer
            )
        from
            (
                call "SYSADMIN.getServerVersion" ()) b ;
    server_interfaces_current = select
            cast (
                substring (
                    i.interfaces
                    ,1
                    ,4
                ) as integer
            )
        from
            (
                call "SYSADMIN.getServerVersion" ()) i ;
    server_core_current = select
            cast (
                substring (
                    c.core
                    ,1
                    ,4
                ) as integer
            )
        from
            (
                call "SYSADMIN.getServerVersion" ()) c ;
    server_infrastructure_current = select
            cast (
                substring (
                    infra.infrastructure
                    ,1
                    ,4
                ) as integer
            )
        from
            (
                call "SYSADMIN.getServerVersion" ()) infra ;
    if (
        (
            server_build_current < server_build_min
        )
        or (
            server_core_current < server_core_min
        )
        or (
            server_interfaces_current < server_interfaces_min
        )
        or (
            server_infrastructure_current < server_infrastructure_min
        )
    )
    begin
        error 'Please, for correct connector running upgrade server to: Server build : ' || server_build_min || ' ; Interfaces build: ' || server_interfaces_min || ' ; Core build: ' || server_core_min || ' ; Infrastructure build: ' || server_infrastructure_min || ' . Your current are:  Server build: ' || server_build_current || ' ; Interfaces build: ' || server_interfaces_current || ' ; Core build: ' || server_core_current || ' ; Infrastructure build: ' || server_infrastructure_current ;
    end
end	READY
2	2015-04-24 18:07:13		affilinet_adv.parseGetOrders	"CREATE VIRTUAL PROCEDURE affilinet_adv.parseGetOrders
(
   IN xmldata xml
)
RETURNS 
(
	""auto_order_management_action"" string,
	""auto_order_management_action_date"" timestamp,
	""cancellation_reason"" string,
	""click_date"" timestamp,
	""last_status_change_date"" timestamp,
	""net_price"" double,
	""network_fee"" double,
	""order_id"" string,
	""publisher_commission"" double,
	""publisher_id"" integer,
	""registration_date"" timestamp,
	""transaction_id"" integer,
	""transaction_status"" string,
	""creative_info_creative_number"" integer,
	""creative_info_creative_type"" string,
	""rate_info_is_tiered_rate"" boolean,
	""rate_info_rate_description"" string,
	""rate_info_rate_mode"" string,
	""rate_info_rate_number"" integer,
	""rate_info_rate_value"" double,
	""total_count"" integer
)
AS BEGIN
SELECT 
""xml_table.auto_order_management_action"" as ""auto_order_management_action"",
parsetimestamp( nullif( ""xml_table.auto_order_management_action_date"", '' ), 'yyyy-MM-dd''T''HH:mm:ss' ) as ""auto_order_management_action_date"",  
""xml_table.cancellation_reason"" as ""cancellation_reason"",
parsetimestamp( nullif( ""xml_table.click_date"", '' ) , 'yyyy-MM-dd''T''HH:mm:ss' ) as ""click_date"",
parsetimestamp( nullif( ""xml_table.last_status_change_date"", '' ) , 'yyyy-MM-dd''T''HH:mm:ss' ) as ""last_status_change_date"",
cast( nullif( ""xml_table.net_price"" , '' ) as double )  as ""net_price"",
cast( nullif( ""xml_table.network_fee"", '' ) as double )  as ""network_fee"",
""xml_table.order_id"" as ""order_id"",
cast( nullif( ""xml_table.publisher_commission"", '' ) as double ) as ""publisher_commission"",
cast( nullif( ""xml_table.publisher_id"", '' ) as integer ) as ""publisher_id"",
parsetimestamp( nullif( ""xml_table.registration_date"", '' ) , 'yyyy-MM-dd''T''HH:mm:ss' ) as ""registration_date"",
cast( nullif( ""xml_table.transaction_id"", '' ) as integer ) as ""transaction_id"",
""xml_table.transaction_status"" as ""transaction_status"",
cast( nullif( ""xml_table.creative_info_creative_number"", '' ) as integer ) as ""creative_info_creative_number"",
""xml_table.creative_info_creative_type"" as ""creative_info_creative_type"",
cast( nullif( ""xml_table.rate_info_is_tiered_rate"", '' ) as boolean )  as ""rate_info_is_tiered_rate"",
""xml_table.rate_info_rate_description"" as ""rate_info_rate_description"",
""xml_table.rate_info_rate_mode"" as ""rate_info_rate_mode"",
cast( nullif( ""xml_table.rate_info_rate_number"", '' ) as integer ) as ""rate_info_rate_number"",
cast( nullif( ""xml_table.rate_info_rate_value"", '' ) as double )as ""rate_info_rate_value"",
cast( nullif( ""xml_table.total_count"", '' ) as integer ) as ""total_count""
FROM 
XMLTABLE(XMLNAMESPACES( DEFAULT 'http://affilinet.framework.esbfa/advertiserservices/ordermanagement/messages','http://affilinet.framework.esbfa/advertiserservices/ordermanagement/types' as ""a"",'http://www.w3.org/2001/XMLSchema-instance' as ""i"" ),
'//GetOrdersResponse/OrderCollection/a:Order' PASSING xmldata 
	COLUMNS 
	""auto_order_management_action"" STRING  PATH 'a:AutoOrderManagementAction',
	""auto_order_management_action_date"" STRING  PATH 'a:AutoOrderManagementActionDate',
	""cancellation_reason"" STRING  PATH 'a:CancellationReason',
	""click_date"" STRING  PATH 'a:ClickDate',
	""last_status_change_date"" STRING  PATH 'a:LastStatusChangeDate',
	""net_price"" STRING  PATH 'a:NetPrice',
	""network_fee"" STRING  PATH 'a:NetworkFee',
	""order_id"" STRING  PATH 'a:OrderId',
	""publisher_commission"" STRING  PATH 'a:PublisherCommission',
	""publisher_id"" STRING  PATH 'a:PublisherId',
	""registration_date"" STRING  PATH 'a:RegistrationDate',
	""transaction_id"" STRING  PATH 'a:TransactionId',
	""transaction_status"" STRING  PATH 'a:TransactionStatus',
	""creative_info_creative_number"" STRING  PATH 'a:CreativeInfo/a:CreativeNumber',
	""creative_info_creative_type"" STRING  PATH 'a:CreativeInfo/a:CreativeType',
	""rate_info_is_tiered_rate"" STRING  PATH 'a:RateInfo/a:IsTieredRate',
	""rate_info_rate_description"" STRING  PATH 'a:RateInfo/a:RateDescription',
	""rate_info_rate_mode"" STRING  PATH 'a:RateInfo/a:RateMode',
	""rate_info_rate_number"" STRING  PATH 'a:RateInfo/a:RateNumber',
	""rate_info_rate_value"" STRING  PATH 'a:RateInfo/a:RateValue',
	""total_count"" STRING PATH '../../../GetOrdersResponse/TotalCount'
) ""xml_table"" ;
END"	READY
3	2015-04-24 18:07:23		affilinet_adv.parseGetStatisticsPerPublisher	"CREATE VIRTUAL PROCEDURE affilinet_adv.parseGetStatisticsPerPublisher
(
   IN xmldata xml
)
RETURNS
(
   currency string,
   publisher_id string,
   publisher_url string,
   bonus_count_cancelled_count long,
   bonus_count_confirmed_count long,
   bonus_count_open_count long,
   bonus_network_fee_cancelled_value double,
   bonus_network_fee_confirmed_value double,
   bonus_network_fee_open_value double,
   bonus_publisher_commission_cancelled_value double,
   bonus_publisher_commission_confirmed_value double,
   bonus_publisher_commission_open_value double,
   click_outs_total_count_cancelled_count long,
   click_outs_total_count_confirmed_count long,
   click_outs_total_count_open_count long,
   click_outs_total_net_price_cancelled_value double,
   click_outs_total_net_price_confirmed_value double,
   click_outs_total_net_price_open_value double,
   click_outs_total_network_fee_cancelled_value double,
   click_outs_total_network_fee_confirmed_value double,
   click_outs_total_network_fee_open_value double,
   click_outs_total_publisher_commission_cancelled_value double,
   click_outs_total_publisher_commission_confirmed_value double,
   click_outs_total_publisher_commission_open_value double,
   clicks_gross_count long,
   clicks_net_count long,
   clicks_network_fee double,
   clicks_publisher_commission double,
   leads_total_count_cancelled_count long,
   leads_total_count_confirmed_count long,
   leads_total_count_open_count long,
   leads_total_net_price_cancelled_value double,
   leads_total_net_price_confirmed_value double,
   leads_total_net_price_open_value double,
   leads_total_network_fee_cancelled_value double,
   leads_total_network_fee_confirmed_value double,
   leads_total_network_fee_open_value double,
   leads_total_publisher_commission_cancelled_value double,
   leads_total_publisher_commission_confirmed_value double,
   leads_total_publisher_commission_open_value double,
   net_price_summary_cancelled_value double,
   net_price_summary_confirmed_value double,
   net_price_summary_open_value double,
   network_fee_summary_cancelled_value double,
   network_fee_summary_confirmed_value double,
   network_fee_summary_open_value double,
   publisher_commission_summary_cancelled_value double,
   publisher_commission_summary_confirmed_value double,
   publisher_commission_summary_open_value double,
   sales_total_count_cancelled_count long,
   sales_total_count_confirmed_count long,
   sales_total_count_open_count long,
   sales_total_net_price_cancelled_value string,
   sales_total_net_price_confirmed_value double,
   sales_total_net_price_open_value double,
   sales_total_network_fee_cancelled_value double,
   sales_total_network_fee_confirmed_value double,
   sales_total_network_fee_open_value double,
   sales_total_publisher_commission_cancelled_value double,
   sales_total_publisher_commission_confirmed_value double,
   sales_total_publisher_commission_open_value double,
   Views_GrossCount long,
   Views_NetCount long,
   Views_NetworkFee double,
   Views_PublisherCommission double,
   TotalCount integer
)
AS BEGIN
SELECT
xml_table.currency,
xml_table.publisher_id,
xml_table.publisher_url,
xml_table.bonus_count_cancelled_count,
xml_table.bonus_count_confirmed_count,
xml_table.bonus_count_open_count,
xml_table.bonus_network_fee_cancelled_value,
xml_table.bonus_network_fee_confirmed_value,
xml_table.bonus_network_fee_open_value,
xml_table.bonus_publisher_commission_cancelled_value,
xml_table.bonus_publisher_commission_confirmed_value,
xml_table.bonus_publisher_commission_open_value,
xml_table.click_outs_total_count_cancelled_count,
xml_table.click_outs_total_count_confirmed_count,
xml_table.click_outs_total_count_open_count,
xml_table.click_outs_total_net_price_cancelled_value,
xml_table.click_outs_total_net_price_confirmed_value,
xml_table.click_outs_total_net_price_open_value,
xml_table.click_outs_total_network_fee_cancelled_value,
xml_table.click_outs_total_network_fee_confirmed_value,
xml_table.click_outs_total_network_fee_open_value,
xml_table.click_outs_total_publisher_commission_cancelled_value,
xml_table.click_outs_total_publisher_commission_confirmed_value,
xml_table.click_outs_total_publisher_commission_open_value,
xml_table.clicks_gross_count,
xml_table.clicks_net_count,
xml_table.clicks_network_fee,
xml_table.clicks_publisher_commission,
xml_table.leads_total_count_cancelled_count,
xml_table.leads_total_count_confirmed_count,
xml_table.leads_total_count_open_count,
xml_table.leads_total_net_price_cancelled_value,
xml_table.leads_total_net_price_confirmed_value,
xml_table.leads_total_net_price_open_value,
xml_table.leads_total_network_fee_cancelled_value,
xml_table.leads_total_network_fee_confirmed_value,
xml_table.leads_total_network_fee_open_value,
xml_table.leads_total_publisher_commission_cancelled_value,
xml_table.leads_total_publisher_commission_confirmed_value,
xml_table.leads_total_publisher_commission_open_value,
xml_table.net_price_summary_cancelled_value,
xml_table.net_price_summary_confirmed_value,
xml_table.net_price_summary_open_value,
xml_table.network_fee_summary_cancelled_value,
xml_table.network_fee_summary_confirmed_value,
xml_table.network_fee_summary_open_value,
xml_table.publisher_commission_summary_cancelled_value,
xml_table.publisher_commission_summary_confirmed_value,
xml_table.publisher_commission_summary_open_value,
xml_table.sales_total_count_cancelled_count,
xml_table.sales_total_count_confirmed_count,
xml_table.sales_total_count_open_count,
xml_table.sales_total_net_price_cancelled_value,
xml_table.sales_total_net_price_confirmed_value,
xml_table.sales_total_net_price_open_value,
xml_table.sales_total_network_fee_cancelled_value,
xml_table.sales_total_network_fee_confirmed_value,
xml_table.sales_total_network_fee_open_value,
xml_table.sales_total_publisher_commission_cancelled_value,
xml_table.sales_total_publisher_commission_confirmed_value,
xml_table.sales_total_publisher_commission_open_value,
xml_table.Views_GrossCount,
xml_table.Views_NetCount,
xml_table.Views_NetworkFee,
xml_table.Views_PublisherCommission,
xml_table.TotalCount
FROM XMLTABLE
(
   XMLNAMESPACES(DEFAULT 'http://affilinet.framework.esbfa/advertiserservices/statistics/messages', 'http://affilinet.framework.esbfa/advertiserservices/statistics/types' AS a, 'http://www.w3.org/2001/XMLSchema-instance' AS i),
   '//GetStatisticsPerPublisherResponse/PublisherStatisticsRecordCollection/a:PublisherStatisticsRecord' PASSING xmldata COLUMNS currency STRING PATH 'a:Currency',
   publisher_id STRING PATH 'a:PublisherId',
   publisher_url STRING PATH 'a:PublisherURL',
   bonus_count_cancelled_count LONG PATH 'a:Bonus/a:Count/a:CancelledCount',
   bonus_count_confirmed_count LONG PATH 'a:Bonus/a:Count/a:ConfirmedCount',
   bonus_count_open_count LONG PATH 'a:Bonus/a:Count/a:OpenCount',
   bonus_network_fee_cancelled_value DOUBLE PATH 'a:Bonus/a:NetworkFee/a:CancelledValue',
   bonus_network_fee_confirmed_value DOUBLE PATH 'a:Bonus/a:NetworkFee/a:ConfirmedValue',
   bonus_network_fee_open_value DOUBLE PATH 'a:Bonus/a:NetworkFee/a:OpenValue',
   bonus_publisher_commission_cancelled_value DOUBLE PATH 'a:Bonus/a:PublisherCommission/a:CancelledValue',
   bonus_publisher_commission_confirmed_value DOUBLE PATH 'a:Bonus/a:PublisherCommission/a:ConfirmedValue',
   bonus_publisher_commission_open_value DOUBLE PATH 'a:Bonus/a:PublisherCommission/a:OpenValue',
   click_outs_total_count_cancelled_count LONG PATH 'a:ClickOuts/a:TotalCount/a:CancelledCount',
   click_outs_total_count_confirmed_count LONG PATH 'a:ClickOuts/a:TotalCount/a:ConfirmedCount',
   click_outs_total_count_open_count LONG PATH 'a:ClickOuts/a:TotalCount/a:OpenCount',
   click_outs_total_net_price_cancelled_value DOUBLE PATH 'a:ClickOuts/a:TotalNetPrice/a:CancelledValue',
   click_outs_total_net_price_confirmed_value DOUBLE PATH 'a:ClickOuts/a:TotalNetPrice/a:ConfirmedValue',
   click_outs_total_net_price_open_value DOUBLE PATH 'a:ClickOuts/a:TotalNetPrice/a:OpenValue',
   click_outs_total_network_fee_cancelled_value DOUBLE PATH 'a:ClickOuts/a:TotalNetworkFee/a:CancelledValue',
   click_outs_total_network_fee_confirmed_value DOUBLE PATH 'a:ClickOuts/a:TotalNetworkFee/a:ConfirmedValue',
   click_outs_total_network_fee_open_value DOUBLE PATH 'a:ClickOuts/a:TotalNetworkFee/a:OpenValue',
   click_outs_total_publisher_commission_cancelled_value DOUBLE PATH 'a:ClickOuts/a:TotalPublisherCommission/a:CancelledValue',
   click_outs_total_publisher_commission_confirmed_value DOUBLE PATH 'a:ClickOuts/a:TotalPublisherCommission/a:ConfirmedValue',
   click_outs_total_publisher_commission_open_value DOUBLE PATH 'a:ClickOuts/a:TotalPublisherCommission/a:OpenValue',
   clicks_gross_count LONG PATH 'a:Clicks/a:GrossCount',
   clicks_net_count LONG PATH 'a:Clicks/a:NetCount',
   clicks_network_fee DOUBLE PATH 'a:Clicks/a:NetworkFee',
   clicks_publisher_commission DOUBLE PATH 'a:Clicks/a:PublisherCommission',
   leads_total_count_cancelled_count LONG PATH 'a:Leads/a:TotalCount/a:CancelledCount',
   leads_total_count_confirmed_count LONG PATH 'a:Leads/a:TotalCount/a:ConfirmedCount',
   leads_total_count_open_count LONG PATH 'a:Leads/a:TotalCount/a:OpenCount',
   leads_total_net_price_cancelled_value DOUBLE PATH 'a:Leads/a:TotalNetPrice/a:CancelledValue',
   leads_total_net_price_confirmed_value DOUBLE PATH 'a:Leads/a:TotalNetPrice/a:ConfirmedValue',
   leads_total_net_price_open_value DOUBLE PATH 'a:Leads/a:TotalNetPrice/a:OpenValue',
   leads_total_network_fee_cancelled_value DOUBLE PATH 'a:Leads/a:TotalNetworkFee/a:CancelledValue',
   leads_total_network_fee_confirmed_value DOUBLE PATH 'a:Leads/a:TotalNetworkFee/a:ConfirmedValue',
   leads_total_network_fee_open_value DOUBLE PATH 'a:Leads/a:TotalNetworkFee/a:OpenValue',
   leads_total_publisher_commission_cancelled_value DOUBLE PATH 'a:Leads/a:TotalPublisherCommission/a:CancelledValue',
   leads_total_publisher_commission_confirmed_value DOUBLE PATH 'a:Leads/a:TotalPublisherCommission/a:ConfirmedValue',
   leads_total_publisher_commission_open_value DOUBLE PATH 'a:Leads/a:TotalPublisherCommission/a:OpenValue',
   net_price_summary_cancelled_value DOUBLE PATH 'a:NetPriceSummary/a:CancelledValue',
   net_price_summary_confirmed_value DOUBLE PATH 'a:NetPriceSummary/a:ConfirmedValue',
   net_price_summary_open_value DOUBLE PATH 'a:NetPriceSummary/a:OpenValue',
   network_fee_summary_cancelled_value DOUBLE PATH 'a:NetworkFeeSummary/a:CancelledValue',
   network_fee_summary_confirmed_value DOUBLE PATH 'a:NetworkFeeSummary/a:ConfirmedValue',
   network_fee_summary_open_value DOUBLE PATH 'a:NetworkFeeSummary/a:OpenValue',
   publisher_commission_summary_cancelled_value DOUBLE PATH 'a:PublisherCommissionSummary/a:CancelledValue',
   publisher_commission_summary_confirmed_value DOUBLE PATH 'a:PublisherCommissionSummary/a:ConfirmedValue',
   publisher_commission_summary_open_value DOUBLE PATH 'a:PublisherCommissionSummary/a:OpenValue',
   sales_total_count_cancelled_count LONG PATH 'a:Sales/a:TotalCount/a:CancelledCount',
   sales_total_count_confirmed_count LONG PATH 'a:Sales/a:TotalCount/a:ConfirmedCount',
   sales_total_count_open_count LONG PATH 'a:Sales/a:TotalCount/a:OpenCount',
   sales_total_net_price_cancelled_value STRING PATH 'a:Sales/a:TotalNetPrice/a:CancelledValue',
   sales_total_net_price_confirmed_value DOUBLE PATH 'a:Sales/a:TotalNetPrice/a:ConfirmedValue',
   sales_total_net_price_open_value DOUBLE PATH 'a:Sales/a:TotalNetPrice/a:OpenValue',
   sales_total_network_fee_cancelled_value DOUBLE PATH 'a:Sales/a:TotalNetworkFee/a:CancelledValue',
   sales_total_network_fee_confirmed_value DOUBLE PATH 'a:Sales/a:TotalNetworkFee/a:ConfirmedValue',
   sales_total_network_fee_open_value DOUBLE PATH 'a:Sales/a:TotalNetworkFee/a:OpenValue',
   sales_total_publisher_commission_cancelled_value DOUBLE PATH 'a:Sales/a:TotalPublisherCommission/a:CancelledValue',
   sales_total_publisher_commission_confirmed_value DOUBLE PATH 'a:Sales/a:TotalPublisherCommission/a:ConfirmedValue',
   sales_total_publisher_commission_open_value DOUBLE PATH 'a:Sales/a:TotalPublisherCommission/a:OpenValue',
   Views_GrossCount LONG PATH 'a:Views/a:GrossCount',
   Views_NetCount LONG PATH 'a:Views/a:NetCount',
   Views_NetworkFee DOUBLE PATH 'a:Views/a:NetworkFee',
   Views_PublisherCommission DOUBLE PATH 'a:Views/a:PublisherCommission',
   TotalCount INTEGER PATH '../../../GetStatisticsPerPublisherResponse/TotalCount'
)
AS xml_table;
END"	READY
196,609	2015-08-10 15:23:15		desk_com_connector.internal_integer_to_Time2	"create virtual procedure desk_com_connector.internal_integer_to_Time2 ( IN in_seconds integer ) returns ( Time_from_seconds_int string ) as
BEGIN
    select
            ""result"" as Time_from_seconds_int
        from
            OBJECTTABLE ( LANGUAGE 'javascript' 'var sec = par1;
						var min = java.util.concurrent.TimeUnit.SECONDS.toMinutes(sec);
						var hours = java.util.concurrent.TimeUnit.MINUTES.toHours(min);
						var remainMinute = min - java.util.concurrent.TimeUnit.HOURS.toMinutes(hours);
						var remainSeconds = sec - java.util.concurrent.TimeUnit.MINUTES.toSeconds(min);

						var result =  hours + "":"" + remainMinute+"":""+  remainSeconds;
						result.toString();
						' PASSING in_seconds AS ""par1"" COLUMNS ""result"" string 'dv_row' ) as g ;
end"	READY
196,610	2015-08-10 15:23:16		desk_com_connector.internal_ts_to_unixtime	"CREATE virtual procedure desk_com_connector.internal_ts_to_unixtime (
    in in_strsrc timestamp
) returns (
    unixtimestamp long
) as
begin
    /*    declare string strsrc = '2013-10-14T08:26:51Z' ;*/
    select
            TIMESTAMPDIFF (
                SQL_TSI_SECOND
                ,'1970-01-01 00:00:00.0'
				, in_strsrc
            ) -3600 ;
end"	READY
196,611	2015-08-10 15:23:16		desk_com_connector.get_list_Facebook_feeds_Likes	CREATE virtual procedure desk_com_connector.get_list_Facebook_feeds_Likes (
    in in_facebook_feed_id string
    ,in in_facebook_post_id string
) RETURNS (
    "idColumn" integer
    ,"facebook_id" string
    ,"liked_by_page" string
    ,"like_count" string
) as
begin
    SELECT
            "xml_table.idColumn"
            ,"xml_table.facebook_id"
            ,"xml_table.liked_by_page"
            ,"xml_table.like_count"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'facebook_feeds/' || in_facebook_feed_id || '/facebook_posts/' || in_facebook_post_id || '/likes'
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"facebook_id" STRING PATH 'facebook_id'
                ,"liked_by_page" STRING PATH 'liked_by_page'
                ,"like_count" STRING PATH 'like_count'
            ) "xml_table" ;
end	READY
131,208	2015-06-25 21:22:30		raw.desk_com_update_list_cases_inc_dwh	CREATE VIRTUAL PROCEDURE raw.desk_com_update_list_cases_inc_dwh(
) 
AS 
BEGIN
EXEC desk_com_connector.get_list_cases (
    in_since_id => (
        select
                max (id)
            from
                dwh.desk_raw_cases
    )
    ,dwh_table => 'dwh.desk_raw_cases'
);
END	READY
196,613	2015-08-10 15:23:17		desk_com_connector.show_article	CREATE virtual procedure desk_com_connector.show_article (
    in in_article_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"subject" string
    ,"body" string
    ,"body_email" string
    ,"body_email_auto" string
    ,"body_chat" string
    ,"body_twitter" string
    ,"body_qna" string
    ,"body_phone" string
    ,"body_facebook" string
    ,"quickcode" string
    ,"publish_at" string
    ,"updated_at" string
    ,"created_at" string
    ,"public_url" string
    ,"body_chat_auto" string
    ,"body_web_callback" string
    ,"body_web_callback_auto" string
    ,"body_twitter_auto" string
    ,"body_qna_auto" string
    ,"body_phone_auto" string
    ,"rating" string
    ,"rating_count" string
    ,"rating_score" string
    ,"keywords" string
    ,"position" string
    ,"in_support_center" string
    ,"internal_notes" string
    ,"total_entries" string
    ,"page" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_article_id is null
        )
        or (
            in_article_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.subject"
            ,"xml_table.body"
            ,"xml_table.body_email"
            ,"xml_table.body_email_auto"
            ,"xml_table.body_chat"
            ,"xml_table.body_twitter"
            ,"xml_table.body_qna"
            ,"xml_table.body_phone"
            ,"xml_table.body_facebook"
            ,"xml_table.quickcode"
            ,"xml_table.publish_at"
            ,"xml_table.updated_at"
            ,"xml_table.created_at"
            ,"xml_table.public_url"
            ,"xml_table.body_chat_auto"
            ,"xml_table.body_web_callback"
            ,"xml_table.body_web_callback_auto"
            ,"xml_table.body_twitter_auto"
            ,"xml_table.body_qna_auto"
            ,"xml_table.body_phone_auto"
            ,"xml_table.rating"
            ,"xml_table.rating_count"
            ,"xml_table.rating_score"
            ,"xml_table.keywords"
            ,"xml_table.position"
            ,"xml_table.in_support_center"
            ,"xml_table.internal_notes"
            ,"xml_table.total_entries"
            ,"xml_table.page"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'articles' || '/' || in_article_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"subject" STRING PATH 'subject'
                ,"body" STRING PATH 'body'
                ,"body_email" STRING PATH 'body_email'
                ,"body_email_auto" STRING PATH 'body_email_auto'
                ,"body_chat" STRING PATH 'body_chat'
                ,"body_twitter" STRING PATH 'body_twitter'
                ,"body_qna" STRING PATH 'body_qna'
                ,"body_phone" STRING PATH 'body_phone'
                ,"body_facebook" STRING PATH 'body_facebook'
                ,"quickcode" STRING PATH 'quickcode'
                ,"publish_at" STRING PATH 'publish_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"created_at" STRING PATH 'created_at'
                ,"public_url" STRING PATH 'public_url'
                ,"body_chat_auto" STRING PATH 'body_chat_auto'
                ,"body_web_callback" STRING PATH 'body_web_callback'
                ,"body_web_callback_auto" STRING PATH 'body_web_callback_auto'
                ,"body_twitter_auto" STRING PATH 'body_twitter_auto'
                ,"body_qna_auto" STRING PATH 'body_qna_auto'
                ,"body_phone_auto" STRING PATH 'body_phone_auto'
                ,"rating" STRING PATH 'rating'
                ,"rating_count" STRING PATH 'rating_count'
                ,"rating_score" STRING PATH 'rating_score'
                ,"keywords" STRING PATH 'keywords'
                ,"position" STRING PATH 'position'
                ,"in_support_center" STRING PATH 'in_support_center'
                ,"internal_notes" STRING PATH 'internal_notes'
                ,"total_entries" STRING PATH '../../total_entries'
                ,"page" STRING PATH '../../page'
            ) "xml_table" ;
end	READY
196,612	2015-08-10 15:23:17		desk_com_connector.internal_integer_to_Time	CREATE virtual procedure desk_com_connector.internal_integer_to_Time ( IN in_seconds integer ) returns ( Time_from_seconds_int string ) as
BEGIN
    select
            x."hours" || ':' || x."minutes" || ':' || x."seconds" as Time_from_seconds_int
        from
            ( OBJECTTABLE ( language 'javascript' ' 
                             var myDate = new Date(seconds * 1000 );
                             var thedate = {};
                             thedate["hours"] = myDate.getUTCHours();
                            thedate["minutes"] = myDate.getUTCMinutes();
                            thedate["seconds"] = myDate.getUTCSeconds();
                           thedate
                   ' PASSING "in_seconds" as "seconds" COLUMNS "hours" integer 'dv_row.hours', "minutes" integer 'dv_row.minutes', "seconds" integer 'dv_row.seconds' ) as "x" ) ;
END	READY
196,615	2015-08-10 15:23:18		desk_com_connector.get_list_cases	CREATE virtual procedure desk_com_connector.get_list_cases ( IN in_since_id integer, IN dwh_table string ) RETURNS ( recordsprocessed string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare long unixtimestamp = 0 ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'cases?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE string VARIABLES.dwh_schema = ( select
            nameindv
        from
            ( exec getCurrentDWH ( ) ) a ) ;
    DECLARE string VARIABLES.vdb_name = 'datavirtuality' ;
    DECLARE string VARIABLES.deltatable = LCASE ( replace ( dwh_table, '"', '' ) || 'delta' ) ;
    DECLARE string VARIABLES.locktable = LCASE ( replace ( dwh_table, '"', '' ) || 'lock' ) ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE TabTmpCount ( c long ) ;
    IF ( VARIABLES.dwh_schema IS NULL )
    BEGIN
        ERROR 'DWH schema name cannot be NULL' ;
    END
    IF ( EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( VARIABLES.locktable ) ) )
    BEGIN
        ERROR 'Another "get_list_cases" incremental update is already running on the provided DWH table. Please, wait until the concurrent update is completed. If the server has been suddenly shut down when a batch udpate was running or an unexpected error occurred during a previous batch execution, it is possible that the lock table has not been correctly dropped. Only in this case, please manually delete the lock table from the DV Server running the command DROP TABLE ' || VARIABLES.locktable ;
    END
    EXECUTE IMMEDIATE 'CREATE TABLE ' || VARIABLES.locktable || '(a integer)' WITHOUT RETURN ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "blurb" string, "priority" string, "locked_until" string, "label_ids" string, "active_at" timestamp, "changed_at" timestamp, "created_at" timestamp, "updated_at" timestamp, "first_opened_at" timestamp, "opened_at" timestamp, "first_resolved_at" timestamp, "resolved_at" timestamp, "status" string, "active_notes_count" string, "active_attachments_count" string, "has_pending_interactions" string, "has_failed_interactions" string, "description" string, "language" string, "received_at" timestamp, "type" string, "labels" string, "subject" string, "custom_fields" string, "message_href" string, "customer_href" string, "labels_href" string, "userid" string, "assigned_group" string, "locked_by" string, "history_href" string, "case_links_href" string, "macro_preview_href" string, "replies_href" string, "replies__count" integer, "notes_href" string, "notes_count" integer, "attachements_href" string, "attachements_count" integer ) ;
    IF ( NOT EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( replace ( dwh_table, '"', '' ) ) ) )
    BEGIN
        EXECUTE IMMEDIATE 'SELECT * INTO ' || dwh_table || ' FROM  tmpTable LIMIT 0' WITHOUT RETURN ;
    END
    IF ( EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( VARIABLES.deltatable ) ) )
    BEGIN
        EXECUTE IMMEDIATE 'DROP TABLE ' || deltatable WITHOUT RETURN ;
    END
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'cases?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'cases?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
        totalrecords = ( SELECT
                "xml_table.total_entries"
            FROM
                ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ) /* - cast ( records_processed as integer ) */
        ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer )
        , 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO'
        , "context" => 'org.teiid.PROCESSOR'
        , "msg" => '[desk_com_connector.get_list_cases_inc] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = '' ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id
                , '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id
                    , '' ) ;
                end
                else
                begin
                    endpointstring = 'cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO'
            , "context" => 'org.teiid.PROCESSOR'
            , "msg" => '[desk_com_connector.get_list_cases] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , substring ( replace ( "xml_table.blurb", unescape ( '\0' ), '' ), 1, 4000 ) as "blurb"
                        , "xml_table.priority"
                        , "xml_table.locked_until"
                        , "xml_table.label_ids"
                        , parsetimestamp ( NULLIF ( "xml_table.active_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "active_at"
                        , parsetimestamp ( NULLIF ( "xml_table.changed_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "changed_at"
                        , parsetimestamp ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , parsetimestamp ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , parsetimestamp ( NULLIF ( "xml_table.first_opened_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "first_opened_at"
                        , parsetimestamp ( NULLIF ( "xml_table.opened_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "opened_at"
                        , parsetimestamp ( NULLIF ( "xml_table.first_resolved_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "first_resolved_at"
                        , parsetimestamp ( NULLIF ( "xml_table.resolved_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "resolved_at"
                        , "xml_table.status"
                        , "xml_table.active_notes_count"
                        , "xml_table.active_attachments_count"
                        , "xml_table.has_pending_interactions"
                        , "xml_table.has_failed_interactions"
                        , "xml_table.description"
                        , "xml_table.language"
                        , parsetimestamp ( NULLIF ( "xml_table.received_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "received_at"
                        , "xml_table.type"
                        , "xml_table.labels"
                        , substring ( "xml_table.subject", 1, 4000 ) as subject
                        , "xml_table.custom_fields"
                        , "xml_table.message_href"
                        , nvl ( substring ( "xml_table.customer_href", 19 ), 0 ) as customerid
                        , "xml_table.labels_href"
                        , nvl ( substring ( "xml_table.assigned_user_href", 15 ), 0 ) as userid
                        , "xml_table.assigned_group"
                        , "xml_table.locked_by"
                        , "xml_table.history_href"
                        , "xml_table.case_links_href"
                        , "xml_table.macro_preview_href"
                        , "xml_table.replies_href"
                        , "xml_table.replies__count"
                        , "xml_table.notes_href"
                        , "xml_table.notes_count"
                        , "xml_table.attachements_href"
                        , "xml_table.attachements_count"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" STRING PATH '../../total_entries', "id" INTEGER PATH 'id', "blurb" STRING PATH 'blurb', "priority" STRING PATH 'priority', "locked_until" STRING PATH 'locked_until', "label_ids" STRING PATH 'string-join(label_ids/text(),'', '')', "active_at" STRING PATH 'active_at', "changed_at" STRING PATH 'changed_at', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "first_opened_at" STRING PATH 'first_opened_at', "opened_at" STRING PATH 'opened_at', "first_resolved_at" STRING PATH 'first_resolved_at', "resolved_at" STRING PATH 'resolved_at', "status" STRING PATH 'status', "active_notes_count" STRING PATH 'active_notes_count', "active_attachments_count" STRING PATH 'active_attachments_count', "has_pending_interactions" STRING PATH 'has_pending_interactions', "has_failed_interactions" STRING PATH 'has_failed_interactions', "description" STRING PATH 'description', "language" STRING PATH 'language', "received_at" STRING PATH 'received_at', "type" STRING PATH 'type', "labels" STRING PATH 'string-join(labels/text(),'', '')', "subject" STRING PATH 'subject', "custom_fields" STRING PATH 'custom_fields', "message_href" STRING PATH '_links/message/href', "customer_href" STRING PATH '_links/customer/href', "labels_href" STRING PATH '_links/labels/href', "assigned_user_href" STRING PATH '_links/assigned_user/href', "assigned_group" STRING PATH '_links/assigned_group', "locked_by" STRING PATH '_links/locked_by', "history_href" STRING PATH '_links/history/href', "case_links_href" STRING PATH '_links/case_links/href', "macro_preview_href" STRING PATH '_links/macro_preview/href', "replies_href" STRING PATH '_links/replies/href', "replies__count" integer PATH '_links/replies/count', "notes_href" STRING PATH '_links/notes/href', "notes_count" integer PATH '_links/notes/count', "attachements_href" STRING PATH '_links/attachments/href', "attachements_count" integer PATH '_links/attachments/count' ) "xml_table" ;
            EXECUTE IMMEDIATE 'SELECT * INTO ' || VARIABLES.deltatable || ' FROM tmpTable' WITHOUT RETURN ;
            DELETE
                FROM
                    tmpTable ;
            /*---------------------------------------- checking duplicates*/
            /*      EXECUTE IMMEDIATE 'DELETE FROM ' || dwh_table || '  WHERE id IN (SELECT id as a FROM ' || VARIABLES.deltatable || ')' WITHOUT RETURN ;*/
            /*----------------------------------------checking duplicates*/
            EXECUTE IMMEDIATE 'INSERT INTO ' || dwh_table || ' SELECT * FROM ' || deltatable WITHOUT RETURN ;
            EXECUTE IMMEDIATE 'DROP TABLE ' || deltatable WITHOUT RETURN ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM ' || dwh_table WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_cases] Totalrecords from get_list_cases are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                DELETE
                    FROM
                        TabTmpCount ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpCount SELECT count(*) FROM ' || dwh_table WITHOUT RETURN ;
                records_processed = select
                        c
                    from
                        TabTmpCount ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_cases] Totalrecords from get_list_cases are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
    end
    EXECUTE IMMEDIATE 'DROP TABLE ' || VARIABLES.locktable WITHOUT RETURN ;
    select
            '[desk_com_connector.get_list_cases]  Processed records are ' || records_processed || '. Content inserted to ' || dwh_table as recordsprocessed ;
end	READY
196,616	2015-08-10 15:23:19		desk_com_connector.show_case	CREATE virtual procedure desk_com_connector.show_case (
    in in_case_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"blurb" string
    ,"priority" string
    ,"locked_until" string
    ,"label_ids" string
    ,"active_at" string
    ,"changed_at" string
    ,"created_at" string
    ,"updated_at" string
    ,"first_opened_at" string
    ,"opened_at" string
    ,"first_resolved_at" string
    ,"resolved_at" string
    ,"status" string
    ,"active_notes_count" string
    ,"active_attachments_count" string
    ,"has_pending_interactions" string
    ,"has_failed_interactions" string
    ,"description" string
    ,"language" string
    ,"received_at" string
    ,"type" string
    ,"labels" string
    ,"subject" string
    ,"custom_fields" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_case_id is null
        )
        or (
            in_case_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.blurb"
            ,"xml_table.priority"
            ,"xml_table.locked_until"
            ,"xml_table.label_ids"
            ,"xml_table.active_at"
            ,"xml_table.changed_at"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.first_opened_at"
            ,"xml_table.opened_at"
            ,"xml_table.first_resolved_at"
            ,"xml_table.resolved_at"
            ,"xml_table.status"
            ,"xml_table.active_notes_count"
            ,"xml_table.active_attachments_count"
            ,"xml_table.has_pending_interactions"
            ,"xml_table.has_failed_interactions"
            ,"xml_table.description"
            ,"xml_table.language"
            ,"xml_table.received_at"
            ,"xml_table.type"
            ,"xml_table.labels"
            ,"xml_table.subject"
            ,"xml_table.custom_fields"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'cases/' || in_case_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"blurb" STRING PATH 'blurb'
                ,"priority" STRING PATH 'priority'
                ,"locked_until" STRING PATH 'locked_until'
                ,"label_ids" STRING PATH 'label_ids'
                ,"active_at" STRING PATH 'active_at'
                ,"changed_at" STRING PATH 'changed_at'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"first_opened_at" STRING PATH 'first_opened_at'
                ,"opened_at" STRING PATH 'opened_at'
                ,"first_resolved_at" STRING PATH 'first_resolved_at'
                ,"resolved_at" STRING PATH 'resolved_at'
                ,"status" STRING PATH 'status'
                ,"active_notes_count" STRING PATH 'active_notes_count'
                ,"active_attachments_count" STRING PATH 'active_attachments_count'
                ,"has_pending_interactions" STRING PATH 'has_pending_interactions'
                ,"has_failed_interactions" STRING PATH 'has_failed_interactions'
                ,"description" STRING PATH 'description'
                ,"language" STRING PATH 'language'
                ,"received_at" STRING PATH 'received_at'
                ,"type" STRING PATH 'type'
                ,"labels" STRING PATH 'labels'
                ,"subject" STRING PATH 'subject'
                ,"custom_fields" STRING PATH 'custom_fields'
            ) "xml_table" ;
end	READY
196,617	2015-08-10 15:23:19		desk_com_connector.show_case_message	CREATE virtual procedure desk_com_connector.show_case_message (
    in in_case_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"created_at" string
    ,"updated_at" string
    ,"erased_at" string
    ,"hidden_by" string
    ,"hidden_at" string
    ,"sent_at" string
    ,"body" string
    ,"from" string
    ,"to" string
    ,"cc" string
    ,"bcc" string
    ,"client_type" string
    ,"direction" string
    ,"status" string
    ,"subject" string
    ,"hidden" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_case_id is null
        )
        or (
            in_case_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.erased_at"
            ,"xml_table.hidden_by"
            ,"xml_table.hidden_at"
            ,"xml_table.sent_at"
            ,"xml_table.body"
            ,"xml_table.from"
            ,"xml_table.to"
            ,"xml_table.cc"
            ,"xml_table.bcc"
            ,"xml_table.client_type"
            ,"xml_table.direction"
            ,"xml_table.status"
            ,"xml_table.subject"
            ,"xml_table.hidden"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'cases/' || in_case_id || '/message'
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"erased_at" STRING PATH 'erased_at'
                ,"hidden_by" STRING PATH 'hidden_by'
                ,"hidden_at" STRING PATH 'hidden_at'
                ,"sent_at" STRING PATH 'sent_at'
                ,"body" STRING PATH 'body'
                ,"from" STRING PATH 'from'
                ,"to" STRING PATH 'to'
                ,"cc" STRING PATH 'cc'
                ,"bcc" STRING PATH 'bcc'
                ,"client_type" STRING PATH 'client_type'
                ,"direction" STRING PATH 'direction'
                ,"status" STRING PATH 'status'
                ,"subject" STRING PATH 'subject'
                ,"hidden" STRING PATH 'hidden'
            ) "xml_table" ;
end	READY
1	2015-04-24 18:06:24		affilinet_adv.wssec_soap_auth	"CREATE VIRTUAL PROCEDURE affilinet_adv.wssec_soap_auth() RETURNS (wssec_header string) AS
BEGIN
INSERT into #cre select * from ( call ""affilinet_adv.internal_getCredentials""(
    ""datasourceName"" => 'affilinet_src',
    ""username"" => 'USERNAME',
    ""password"" => 'PASSWORD'
) )a;

DECLARE string username = select username from #cre; 
DECLARE string password = select password from #cre; 
SELECT (('<SOAP-ENV:Header>
    <ns2:Security SOAP-ENV:mustUnderstand=""1"">
      <ns2:UsernameToken>
        <ns2:Username>' || username ||'</ns2:Username>
        <ns2:Password>' || password ||'</ns2:Password>
        <ns3:Created>' || FORMATTIMESTAMP(now(), 'yyyy-MM-dd''T''HH:mm:ss''Z''')) || '</ns3:Created>
      </ns2:UsernameToken>
    </ns2:Security>
  </SOAP-ENV:Header>');
END"	READY
196,618	2015-08-10 15:23:20		desk_com_connector.get_list_case_replies	CREATE virtual procedure desk_com_connector.get_list_case_replies ( in in_case_id string, IN in_since_id integer ) RETURNS ( "id" integer, "created_at" string, "updated_at" timestamp, "erased_at" string, "hidden_by" string, "hidden_at" string, "sent_at" string, "body" string, "from" string, "to" string, "cc" string, "bcc" string, "client_type" string, "direction" string, "status" string, "subject" string, "hidden" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_case_id is null )
    or ( in_case_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare boolean page_limit_exceeded = false ;
    declare integer PageSize = 100 ;
    declare string endpointstring = 'cases/' || in_case_id || '/replies?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "created_at" string, "updated_at" timestamp, "erased_at" string, "hidden_by" string, "hidden_at" string, "sent_at" string, "body" string, "from" string, "to" string, "cc" string, "bcc" string, "client_type" string, "direction" string, "status" string, "subject" string, "hidden" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'cases/' || in_case_id || '/replies?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'cases/' || in_case_id || '/replies?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_replies] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'cases/' || in_case_id || '/replies?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'cases/' || in_case_id || '/replies?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'cases/' || in_case_id || '/replies?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_replies] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.created_at"
                        , PARSETIMESTAMP ( "xml_table.updated_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.erased_at"
                        , "xml_table.hidden_by"
                        , "xml_table.hidden_at"
                        , "xml_table.sent_at"
                        , substring ( "xml_table.body", 1, 4000 ) as "body"
                        , "xml_table.from"
                        , "xml_table.to"
                        , "xml_table.cc"
                        , "xml_table.bcc"
                        , "xml_table.client_type"
                        , "xml_table.direction"
                        , "xml_table.status"
                        , substring ( "xml_table.subject", 1, 4000 ) as subject
                        , "xml_table.hidden"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "erased_at" STRING PATH 'erased_at', "hidden_by" STRING PATH 'hidden_by', "hidden_at" STRING PATH 'hidden_at', "sent_at" STRING PATH 'sent_at', "body" STRING PATH 'body', "from" STRING PATH 'from', "to" STRING PATH 'to', "cc" STRING PATH 'cc', "bcc" STRING PATH 'bcc', "client_type" STRING PATH 'client_type', "direction" STRING PATH 'direction', "status" STRING PATH 'status', "subject" STRING PATH 'subject', "hidden" STRING PATH 'hidden', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_replies] Totalrecords from get_list_case_replies are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_replies] Totalrecords are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,619	2015-08-10 15:23:21		desk_com_connector.get_list_case_attachments	CREATE virtual procedure desk_com_connector.get_list_case_attachments ( in in_case_id string, IN in_since_id integer ) RETURNS ( "id" integer, "created_at" timestamp, "updated_at" timestamp, "erased_at" timestamp, "size" string, "url" string, "file_name" string, "content_type" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_case_id is null )
    or ( in_case_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'cases/' || in_case_id || '/attachments?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE TabTmpCount ( c long ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "created_at" timestamp, "updated_at" timestamp, "erased_at" timestamp, "size" string, "url" string, "file_name" string, "content_type" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'cases/' || in_case_id || '/attachments?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'cases/' || in_case_id || '/attachments?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_attachments] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'cases/' || in_case_id || '/attachments?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'cases/' || in_case_id || '/attachments?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'cases/' || in_case_id || '/attachments?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_attachments] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , PARSETIMESTAMP ( "xml_table.created_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( "xml_table.updated_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , PARSETIMESTAMP ( "xml_table.erased_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "erased_at"
                        , "xml_table.size"
                        , "xml_table.url"
                        , "xml_table.file_name"
                        , "xml_table.content_type"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "erased_at" STRING PATH 'erased_at', "size" STRING PATH 'size', "url" STRING PATH 'url', "file_name" STRING PATH 'file_name', "content_type" STRING PATH 'content_type', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_attachments] Totalrecords from get_list_case_attachments are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_attachments] Totalrecords from get_list_case_attachments are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
15	2015-04-24 18:17:53		views.dv_cleanOldMatTables	"create virtual procedure views.dv_cleanOldMatTables() as
/*Run this to delete all old mat_tables*/
BEGIN
	LOOP ON (
		SELECT 
			'DROP TABLE dwh.' || a.TableName as full_path
		FROM (
			SELECT 
				""t.Name"" as ""TableName"", 
				""mt.accessState"", 
				SUBSTRING(""t.Name"",0,LOCATE('_st',""t.Name"")-1) as ""TablePrefix"", 
				CAST(SUBSTRING(""t.Name"",11,LOCATE('_st',""t.Name"")-11) as integer) as ""TableNumberInfix"",
				CAST(SUBSTRING(""t.Name"",LOCATE('_st',""t.Name"")+3) as integer) as ""MatTableStage"", 
				RANK() OVER (PARTITION BY SUBSTRING(""t.Name"",0,LOCATE('_st',""t.Name"")-1) ORDER BY CAST(SUBSTRING(""t.Name"",LOCATE('_st',""t.Name"")+3) as integer) DESC) as ""StagePriority""
			FROM ""SYS.Tables"" t 
			INNER JOIN ""SYSADMIN.MaterializedTable"" mt ON (""mt.name"" = ""t.name"")
			WHERE ""t.SchemaName"" = 'dwh' 
			AND ""mt.accessState"" = 'READY'
			ORDER BY CAST(SUBSTRING(""t.Name"",11,LOCATE('_st',""t.Name"")-11) as integer)
		) as a
		WHERE ""a.StagePriority"" > 1
	) as dwh_tables

	BEGIN
		EXECUTE IMMEDIATE dwh_tables.full_path;
	END
END"	READY
16	2015-04-24 18:17:53		views.work_hours_between	"CREATE VIRTUAL PROCEDURE views.work_hours_between(IN startdate timestamp,IN enddate timestamp) returns (xdate integer)
as
BEGIN

                                                   
EXECUTE IMMEDIATE
'select CAST(CAST(TIMESTAMPDIFF(SQL_TSI_MINUTE, ' || startdate ||   ', '|| enddate || ') AS DECIMAL) / 60 - CASE WHEN MIN(c.working_days) = 0 THEN 24*2 ELSE 0 END AS INTEGER) hours
FROM dwh.calendar c 
WHERE CAST(LEFT(' || startdate || ',10) AS DATE) <= c.date and c.date <= CAST(LEFT(' || enddate || ',10) AS DATE)'
;


END"	READY
196,620	2015-08-10 15:23:21		desk_com_connector.show_case_attachment	CREATE virtual procedure desk_com_connector.show_case_attachment (
    in in_case_id string
    ,in in_attachment_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"created_at" string
    ,"updated_at" string
    ,"erased_at" string
    ,"size" string
    ,"url" string
    ,"file_name" string
    ,"content_type" string
    ,"total_entries" string
    ,"page" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_case_id is null
        )
        or (
            in_case_id = ''
        )
        or (
            in_attachment_id is null
        )
        or (
            in_attachment_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.erased_at"
            ,"xml_table.size"
            ,"xml_table.url"
            ,"xml_table.file_name"
            ,"xml_table.content_type"
            ,"xml_table.total_entries"
            ,"xml_table.page"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'cases/' || in_case_id || '/attachments/' || in_attachment_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"erased_at" STRING PATH 'erased_at'
                ,"size" STRING PATH 'size'
                ,"url" STRING PATH 'url'
                ,"file_name" STRING PATH 'file_name'
                ,"content_type" STRING PATH 'content_type'
                ,"total_entries" STRING PATH '../../total_entries'
                ,"page" STRING PATH '../../page'
            ) "xml_table" ;
end	READY
196,621	2015-08-10 15:23:22		desk_com_connector.get_list_case_feed	CREATE virtual procedure desk_com_connector.get_list_case_feed ( in in_case_id string, IN in_since_id integer ) RETURNS ( "id" integer, "created_at" timestamp, "updated_at" timestamp, "sent_at" timestamp, "erased_at" timestamp, "hidden_by" string, "hidden_at" string, "body" string, "from" string, "to" string, "cc" string, "bcc" string, "client_type" string, "direction" string, "status" string, "subject" string, "hidden" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_case_id is null )
    or ( in_case_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'cases/' || in_case_id || '/feed?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "created_at" timestamp, "updated_at" timestamp, "sent_at" timestamp, "erased_at" timestamp, "hidden_by" string, "hidden_at" string, "body" string, "from" string, "to" string, "cc" string, "bcc" string, "client_type" string, "direction" string, "status" string, "subject" string, "hidden" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'cases/' || in_case_id || '/feedsort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'cases/' || in_case_id || '/feed?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_feed] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'cases/' || in_case_id || '/feed?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'cases/' || in_case_id || '/feed?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'cases/' || in_case_id || '/feed?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_feed] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , PARSETIMESTAMP ( "xml_table.sent_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "sent_at"
                        , PARSETIMESTAMP ( "xml_table.erased_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "erased_at"
                        , "xml_table.hidden_by"
                        , "xml_table.hidden_at"
                        , substring ( "xml_table.body", 1, 4000 ) as "body"
                        , "xml_table.from"
                        , "xml_table.to"
                        , "xml_table.cc"
                        , "xml_table.bcc"
                        , "xml_table.client_type"
                        , "xml_table.direction"
                        , "xml_table.status"
                        , substring ( "xml_table.subject", 1, 4000 ) as "subject"
                        , "xml_table.hidden"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "sent_at" STRING PATH 'sent_at', "erased_at" STRING PATH 'erased_at', "hidden_by" STRING PATH 'hidden_by', "hidden_at" STRING PATH 'hidden_at', "body" STRING PATH 'body', "from" STRING PATH 'from', "to" STRING PATH 'to', "cc" STRING PATH 'cc', "bcc" STRING PATH 'bcc', "client_type" STRING PATH 'client_type', "direction" STRING PATH 'direction', "status" STRING PATH 'status', "subject" STRING PATH 'subject', "hidden" STRING PATH 'hidden', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_feed] Totalrecords from get_list_case_feed are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_feed] Totalrecords are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,614	2015-08-10 15:23:18		desk_com_connector.show_translations_article	CREATE virtual procedure desk_com_connector.show_translations_article (
    in in_article_id string
    ,in in_locale string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"locale" string
    ,"publish_at" string
    ,"created_at" string
    ,"updated_at" string
    ,"outdated" string
    ,"subject" string
    ,"body" string
    ,"body_email" string
    ,"body_email_auto" string
    ,"body_chat" string
    ,"body_chat_auto" string
    ,"body_web_callback" string
    ,"body_web_callback_auto" string
    ,"body_twitter" string
    ,"body_twitter_auto" string
    ,"body_qna" string
    ,"body_qna_auto" string
    ,"body_phone" string
    ,"body_phone_auto" string
    ,"body_facebook" string
    ,"body_facebook_auto" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_article_id is null
        )
        or (
            in_article_id = ''
        )
        or (
            in_locale is null
        )
        or (
            in_locale = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.locale"
            ,"xml_table.publish_at"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.outdated"
            ,"xml_table.subject"
            ,"xml_table.body"
            ,"xml_table.body_email"
            ,"xml_table.body_email_auto"
            ,"xml_table.body_chat"
            ,"xml_table.body_chat_auto"
            ,"xml_table.body_web_callback"
            ,"xml_table.body_web_callback_auto"
            ,"xml_table.body_twitter"
            ,"xml_table.body_twitter_auto"
            ,"xml_table.body_qna"
            ,"xml_table.body_qna_auto"
            ,"xml_table.body_phone"
            ,"xml_table.body_phone_auto"
            ,"xml_table.body_facebook"
            ,"xml_table.body_facebook_auto"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'articles/' || in_article_id || '/translations/' || in_locale
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"locale" STRING PATH 'locale'
                ,"publish_at" STRING PATH 'publish_at'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"outdated" STRING PATH 'outdated'
                ,"subject" STRING PATH 'subject'
                ,"body" STRING PATH 'body'
                ,"body_email" STRING PATH 'body_email'
                ,"body_email_auto" STRING PATH 'body_email_auto'
                ,"body_chat" STRING PATH 'body_chat'
                ,"body_chat_auto" STRING PATH 'body_chat_auto'
                ,"body_web_callback" STRING PATH 'body_web_callback'
                ,"body_web_callback_auto" STRING PATH 'body_web_callback_auto'
                ,"body_twitter" STRING PATH 'body_twitter'
                ,"body_twitter_auto" STRING PATH 'body_twitter_auto'
                ,"body_qna" STRING PATH 'body_qna'
                ,"body_qna_auto" STRING PATH 'body_qna_auto'
                ,"body_phone" STRING PATH 'body_phone'
                ,"body_phone_auto" STRING PATH 'body_phone_auto'
                ,"body_facebook" STRING PATH 'body_facebook'
                ,"body_facebook_auto" STRING PATH 'body_facebook_auto'
            ) "xml_table" ;
end	READY
196,630	2015-08-10 15:23:26		desk_com_connector.get_list_groups	CREATE virtual procedure desk_com_connector.get_list_groups ( IN in_since_id integer ) RETURNS ( "id" integer, "name" string, "total_entries" string, "page" string, users_href string, filters_href string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 1000 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'groups?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "total_entries" string, "page" string, users_href string, filters_href string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'groups?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'groups?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_groups] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_groups] totalrecords2: ' || totalrecords2 || ' records_processed2: ' || records_processed2 || '
             endpointstring: ' || endpointstring ) ;
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'groups?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'groups?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'groups?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_groups] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                        , "xml_table.users_href"
                        , "xml_table.filters_href"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "name" STRING PATH 'name', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page', "users_href" STRING PATH '_links/users/href', "filters_href" STRING PATH '_links/filters/href' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_groups] Totalrecords from get_list_groups are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_groups] Totalrecords from get_list_groups are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,631	2015-08-10 15:23:26		desk_com_connector.show_group	CREATE virtual procedure desk_com_connector.show_group (
    in in_group_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'groups/' || in_group_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
            ) "xml_table" ;
end	READY
196,632	2015-08-10 15:23:27		desk_com_connector.get_list_group_permissions	CREATE virtual procedure desk_com_connector.get_list_group_permissions ( IN in_since_id integer, in in_group_id string ) RETURNS ( "name" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_group_id is null )
    or ( in_group_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'groups/' || in_group_id || '/permissions?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "name" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'groups/' || in_group_id || '/permissions?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'groups/' || in_group_id || '/permissions?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_permissions] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'groups/' || in_group_id || '/permissions?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'groups/' || in_group_id || '/permissions?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'groups/' || in_group_id || '/permissions?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_permissions] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.name"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "name" STRING PATH 'name', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_permissions] Totalrecords from get_list_group_permissions are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_permissions] Totalrecords from get_list_group_permissions are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,633	2015-08-10 15:23:27		desk_com_connector.show_mailbox_inbound	CREATE virtual procedure desk_com_connector.show_mailbox_inbound (
    in in_mailbox_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
    ,"hostname" string
    ,"email" string
    ,"last_checked_at" string
    ,"created_at" string
    ,"updated_at" string
    ,"inbound_address_filter" string
    ,"outbound_address_filter" string
    ,"last_error" string
    ,"port" string
    ,"enabled" string
    ,"type" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
            ,"xml_table.hostname"
            ,"xml_table.email"
            ,"xml_table.last_checked_at"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.inbound_address_filter"
            ,"xml_table.outbound_address_filter"
            ,"xml_table.last_error"
            ,"xml_table.port"
            ,"xml_table.enabled"
            ,"xml_table.type"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'mailboxes/inbound/' || in_mailbox_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
                ,"hostname" STRING PATH 'hostname'
                ,"email" STRING PATH 'email'
                ,"last_checked_at" STRING PATH 'last_checked_at'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"inbound_address_filter" STRING PATH 'inbound_address_filter'
                ,"outbound_address_filter" STRING PATH 'outbound_address_filter'
                ,"last_error" STRING PATH 'last_error'
                ,"port" STRING PATH 'port'
                ,"enabled" STRING PATH 'enabled'
                ,"type" STRING PATH 'type'
            ) "xml_table" ;
end	READY
196,634	2015-08-10 15:23:28		desk_com_connector.show_integration_url	CREATE virtual procedure desk_com_connector.show_integration_url (
    in in_url_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
    ,"rendered" string
    ,"created_at" string
    ,"updated_at" string
    ,"description" string
    ,"enabled" string
    ,"markup" string
    ,"open_location" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_url_id is null
        )
        or (
            in_url_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
            ,"xml_table.rendered"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.description"
            ,"xml_table.enabled"
            ,"xml_table.markup"
            ,"xml_table.open_location"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'integration_urls/' || in_url_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
                ,"rendered" STRING PATH 'rendered'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"description" STRING PATH 'description'
                ,"enabled" STRING PATH 'enabled'
                ,"markup" STRING PATH 'markup'
                ,"open_location" STRING PATH 'open_location'
            ) "xml_table" ;
end	READY
196,635	2015-08-10 15:23:28		desk_com_connector.get_list_labels	CREATE virtual procedure desk_com_connector.get_list_labels ( IN in_since_id integer ) RETURNS ( "id" integer, "name" string, "types" string, "description" string, "enabled" string, "color" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 1000 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'labels?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "types" string, "description" string, "enabled" string, "color" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'labels?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'labels?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_labels] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'labels?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'labels?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'labels?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_labels] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.types"
                        , "xml_table.description"
                        , "xml_table.enabled"
                        , "xml_table.color"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "name" STRING PATH 'name', "types" STRING PATH 'string-join(types/text(),'', '')', "description" STRING PATH 'description', "enabled" STRING PATH 'enabled', "color" STRING PATH 'color', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_labels] Totalrecords from get_list_labels are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_labels] Totalrecords from get_list_labels are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,636	2015-08-10 15:23:29		desk_com_connector.show_label	CREATE virtual procedure desk_com_connector.show_label (
    in in_label_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
    ,"types" string
    ,"description" string
    ,"enabled" string
    ,"color" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
            ,"xml_table.types"
            ,"xml_table.description"
            ,"xml_table.enabled"
            ,"xml_table.color"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'labels/' || in_label_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//types' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH '../id'
                ,"name" STRING PATH '../name'
                ,"types" STRING PATH '.'
                ,"description" STRING PATH '../description'
                ,"enabled" STRING PATH '../enabled'
                ,"color" STRING PATH '../color'
            ) "xml_table" ;
end	READY
196,637	2015-08-10 15:23:29		desk_com_connector.get_list_macros	CREATE virtual procedure desk_com_connector.get_list_macros ( IN in_since_id integer ) RETURNS ( "id" integer, "name" string, "description" string, "position" string, "enabled" string, "folders" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 1000 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'macros?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "description" string, "position" string, "enabled" string, "folders" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'macros?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'macros?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_macros] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'macros?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'macros?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'macros?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_macros] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.description"
                        , "xml_table.position"
                        , "xml_table.enabled"
                        , "xml_table.folders"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "name" STRING PATH 'name', "id" integer PATH 'id', "description" STRING PATH 'description', "position" STRING PATH 'position', "enabled" STRING PATH 'enabled', "folders" STRING PATH 'string-join(folders/text(),'', '')', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_macros] Totalrecords from get_list_macros are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_macros] Totalrecords from get_list_macros are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,622	2015-08-10 15:23:22		desk_com_connector.show_case_history	CREATE virtual procedure desk_com_connector.show_case_history (
    in in_case_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"type" string
    ,"context" string
    ,"created_at" string
    ,"total_entries" string
    ,"page" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.type"
            ,"xml_table.context"
            ,"xml_table.created_at"
            ,"xml_table.total_entries"
            ,"xml_table.page"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'cases/' || in_case_id || '/history'
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"type" STRING PATH 'type'
                ,"context" STRING PATH 'context'
                ,"created_at" STRING PATH 'created_at'
                ,"total_entries" STRING PATH '../../total_entries'
                ,"page" STRING PATH '../../page'
            ) "xml_table" ;
end	READY
196,623	2015-08-10 15:23:23		desk_com_connector.get_list_company_cases	CREATE virtual procedure desk_com_connector.get_list_company_cases ( in in_company_id string, IN in_since_id integer ) RETURNS ( "id" string, "external_id" string, "blurb" string, "priority" string, "locked_until" string, "label_ids" string, "active_at" timestamp, "changed_at" timestamp, "created_at" timestamp, "updated_at" timestamp, "first_opened_at" timestamp, "opened_at" timestamp, "first_resolved_at" timestamp, "resolved_at" timestamp, "status" string, "active_notes_count" string, "active_attachments_count" string, "has_pending_interactions" string, "has_failed_interactions" string, "description" string, "language" string, "received_at" timestamp, "type" string, "labels" string, "subject" string, "custom_fields" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_company_id is null )
    or ( in_company_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'companies/' || in_company_id || '/cases?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" string, "external_id" string, "blurb" string, "priority" string, "locked_until" string, "label_ids" string, "active_at" timestamp, "changed_at" timestamp, "created_at" timestamp, "updated_at" timestamp, "first_opened_at" timestamp, "opened_at" timestamp, "first_resolved_at" timestamp, "resolved_at" timestamp, "status" string, "active_notes_count" string, "active_attachments_count" string, "has_pending_interactions" string, "has_failed_interactions" string, "description" string, "language" string, "received_at" timestamp, "type" string, "labels" string, "subject" string, "custom_fields" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'companies/' || in_company_id || '/cases?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'companies/' || in_company_id || '/cases?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_company_cases] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'companies/' || in_company_id || '/cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'companies/' || in_company_id || '/cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'companies/' || in_company_id || '/cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_company_cases] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.external_id"
                        , substring ( "xml_table.blurb", 1, 4000 ) as blurb
                        , "xml_table.priority"
                        , "xml_table.locked_until"
                        , "xml_table.label_ids"
                        , PARSETIMESTAMP ( "xml_table.active_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "active_at"
                        , PARSETIMESTAMP ( "xml_table.changed_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "changed_at"
                        , PARSETIMESTAMP ( "xml_table.created_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( "xml_table.updated_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , PARSETIMESTAMP ( "xml_table.first_opened_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "first_opened_at"
                        , PARSETIMESTAMP ( "xml_table.opened_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "opened_at"
                        , PARSETIMESTAMP ( "xml_table.first_resolved_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "first_resolved_at"
                        , PARSETIMESTAMP ( "xml_table.resolved_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "resolved_at"
                        , "xml_table.status"
                        , "xml_table.active_notes_count"
                        , "xml_table.active_attachments_count"
                        , "xml_table.has_pending_interactions"
                        , "xml_table.has_failed_interactions"
                        , "xml_table.description"
                        , "xml_table.language"
                        , PARSETIMESTAMP ( "xml_table.received_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "received_at"
                        , "xml_table.type"
                        , "xml_table.labels"
                        , substring ( "xml_table.subject", 1, 4000 ) as subject
                        , "xml_table.custom_fields"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "external_id" STRING PATH 'external_id', "blurb" STRING PATH 'blurb', "priority" STRING PATH 'priority', "locked_until" STRING PATH 'locked_until', "label_ids" STRING PATH 'string-join(label_ids/text(),'', '')', "active_at" STRING PATH 'active_at', "changed_at" STRING PATH 'changed_at', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "first_opened_at" STRING PATH 'first_opened_at', "opened_at" STRING PATH 'opened_at', "first_resolved_at" STRING PATH 'first_resolved_at', "resolved_at" STRING PATH 'resolved_at', "status" STRING PATH 'status', "active_notes_count" STRING PATH 'active_notes_count', "active_attachments_count" STRING PATH 'active_attachments_count', "has_pending_interactions" STRING PATH 'has_pending_interactions', "has_failed_interactions" STRING PATH 'has_failed_interactions', "description" STRING PATH 'description', "language" STRING PATH 'language', "received_at" STRING PATH 'received_at', "type" STRING PATH 'type', "labels" STRING PATH 'string-join(labels/text(),'', '')', "subject" STRING PATH 'subject', "custom_fields" STRING PATH 'custom_fields', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_company_cases] Totalrecords from get_list_company_cases are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_company_cases] Totalrecords are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,624	2015-08-10 15:23:23		desk_com_connector.get_list_company_customers	CREATE virtual procedure desk_com_connector.get_list_company_customers (
    in in_company_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"external_id" string
    ,"locked_until" string
    ,"first_name" string
    ,"last_name" string
    ,"company" string
    ,"title" string
    ,"created_at" string
    ,"updated_at" string
    ,"background" string
    ,"language" string
    ,"access_private_portal" string
    ,"access_company_cases" string
    ,"avatar" string
    ,"uid" string
    ,"custom_fields" string
    ,"email_type" string
    ,"email_value" string
    ,"phone_type" string
    ,"phone_value" string
    ,"addresses_type" string
    ,"addresses_value" string
    ,"total_entries" string
    ,"page" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.external_id"
            ,"xml_table.locked_until"
            ,"xml_table.first_name"
            ,"xml_table.last_name"
            ,"xml_table.company"
            ,"xml_table.title"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.background"
            ,"xml_table.language"
            ,"xml_table.access_private_portal"
            ,"xml_table.access_company_cases"
            ,"xml_table.avatar"
            ,"xml_table.uid"
            ,"xml_table.custom_fields"
            ,"xml_table.email_type"
            ,"xml_table.email_value"
            ,"xml_table.phone_type"
            ,"xml_table.phone_value"
            ,"xml_table.addresses_type"
            ,"xml_table.addresses_value"
            ,"xml_table.total_entries"
            ,"xml_table.page"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'companies/' || in_company_id || '/customers'
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"external_id" STRING PATH 'external_id'
                ,"locked_until" STRING PATH 'locked_until'
                ,"first_name" STRING PATH 'first_name'
                ,"last_name" STRING PATH 'last_name'
                ,"company" STRING PATH 'company'
                ,"title" STRING PATH 'title'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"background" STRING PATH 'background'
                ,"language" STRING PATH 'language'
                ,"access_private_portal" STRING PATH 'access_private_portal'
                ,"access_company_cases" STRING PATH 'access_company_cases'
                ,"avatar" STRING PATH 'avatar'
                ,"uid" STRING PATH 'uid'
                ,"custom_fields" STRING PATH 'custom_fields'
                ,"email_type" STRING PATH 'string-join(emails/type/text(),'', '')'
                ,"email_value" STRING PATH 'string-join(emails/value/text(),'', '')'
                ,"phone_type" STRING PATH 'string-join(phone_numbers/type/text(),'', '')'
                ,"phone_value" STRING PATH 'string-join(phone_numbers/value/text(),'', '')'
                ,"addresses_type" STRING PATH 'string-join(addresses/type/text(),'', '')'
                ,"addresses_value" STRING PATH 'string-join(addresses/value/text(),'', '')'
                ,"total_entries" STRING PATH '../../total_entries'
                ,"page" STRING PATH '../../page'
            ) "xml_table" ;
end	READY
196,625	2015-08-10 15:23:23		desk_com_connector.show_customer	CREATE virtual procedure desk_com_connector.show_customer (
    in in_customer_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"first_name" string
    ,"last_name" string
    ,"company" string
    ,"title" string
    ,"external_id" string
    ,"locked_until" string
    ,"created_at" string
    ,"updated_at" string
    ,"background" string
    ,"language" string
    ,"access_private_portal" string
    ,"access_company_cases" string
    ,"avatar" string
    ,"uid" string
    ,"custom_fields" string
    ,"email_type" string
    ,"email_value" string
    ,"phone_type" string
    ,"phone_value" string
    ,"addresses_type" string
    ,"addresses_value" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.first_name"
            ,"xml_table.last_name"
            ,"xml_table.company"
            ,"xml_table.title"
            ,"xml_table.external_id"
            ,"xml_table.locked_until"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.background"
            ,"xml_table.language"
            ,"xml_table.access_private_portal"
            ,"xml_table.access_company_cases"
            ,"xml_table.avatar"
            ,"xml_table.uid"
            ,"xml_table.custom_fields"
            ,"xml_table.email_type"
            ,"xml_table.email_value"
            ,"xml_table.phone_type"
            ,"xml_table.phone_value"
            ,"xml_table.addresses_type"
            ,"xml_table.addresses_value"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'customers/' || in_customer_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"first_name" STRING PATH 'first_name'
                ,"last_name" STRING PATH 'last_name'
                ,"company" STRING PATH 'company'
                ,"title" STRING PATH 'title'
                ,"external_id" STRING PATH 'external_id'
                ,"locked_until" STRING PATH 'locked_until'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"background" STRING PATH 'background'
                ,"language" STRING PATH 'language'
                ,"access_private_portal" STRING PATH 'access_private_portal'
                ,"access_company_cases" STRING PATH 'access_company_cases'
                ,"avatar" STRING PATH 'avatar'
                ,"uid" STRING PATH 'uid'
                ,"custom_fields" STRING PATH 'custom_fields'
                ,"email_type" STRING PATH 'string-join(emails/type/text(),'', '')'
                ,"email_value" STRING PATH 'string-join(emails/value/text(),'', '')'
                ,"phone_type" STRING PATH 'string-join(phone_numbers/type/text(),'', '')'
                ,"phone_value" STRING PATH 'string-join(phone_numbers/value/text(),'', '')'
                ,"addresses_type" STRING PATH 'string-join(addresses/type/text(),'', '')'
                ,"addresses_value" STRING PATH 'string-join(addresses/value/text(),'', '')'
            ) "xml_table" ;
end	READY
196,626	2015-08-10 15:23:24		desk_com_connector.get_list_customer_cases	CREATE virtual procedure desk_com_connector.get_list_customer_cases ( in in_customer_id string, IN in_since_id integer ) RETURNS ( "id" string, "external_id" string, "blurb" string, "priority" string, "locked_until" string, "active_at" timestamp, "label_ids" string, "changed_at" timestamp, "created_at" timestamp, "updated_at" timestamp, "first_opened_at" timestamp, "opened_at" timestamp, "first_resolved_at" timestamp, "resolved_at" timestamp, "status" string, "active_notes_count" string, "active_attachments_count" string, "has_pending_interactions" string, "has_failed_interactions" string, "description" string, "language" string, "received_at" timestamp, "type" string, "labels" string, "subject" string, "custom_fields" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_customer_id is null )
    or ( in_customer_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'customers/' || in_customer_id || '/cases?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" string, "external_id" string, "blurb" string, "priority" string, "locked_until" string, "active_at" timestamp, "label_ids" string, "changed_at" timestamp, "created_at" timestamp, "updated_at" timestamp, "first_opened_at" timestamp, "opened_at" timestamp, "first_resolved_at" timestamp, "resolved_at" timestamp, "status" string, "active_notes_count" string, "active_attachments_count" string, "has_pending_interactions" string, "has_failed_interactions" string, "description" string, "language" string, "received_at" timestamp, "type" string, "labels" string, "subject" string, "custom_fields" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'customers/' || in_customer_id || '/cases?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'customers/' || in_customer_id || '/cases?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_customer_cases] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'customers/' || in_customer_id || '/cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'customers/' || in_customer_id || '/cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'customers/' || in_customer_id || '/cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_customer_cases] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.external_id"
                        , substring ( "xml_table.blurb", 1, 4000 ) as blurb
                        , "xml_table.priority"
                        , "xml_table.locked_until"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.active_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "active_at"
                        , "xml_table.label_ids"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.changed_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "changed_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.first_opened_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "first_opened_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.opened_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "opened_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.first_resolved_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "first_resolved_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.resolved_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "resolved_at"
                        , "xml_table.status"
                        , "xml_table.active_notes_count"
                        , "xml_table.active_attachments_count"
                        , "xml_table.has_pending_interactions"
                        , "xml_table.has_failed_interactions"
                        , "xml_table.description"
                        , "xml_table.language"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.received_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "received_at"
                        , "xml_table.type"
                        , "xml_table.labels"
                        , substring ( "xml_table.subject", 1, 4000 ) as subject
                        , "xml_table.custom_fields"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "external_id" STRING PATH 'external_id', "blurb" STRING PATH 'blurb', "priority" STRING PATH 'priority', "locked_until" STRING PATH 'locked_until', "active_at" STRING PATH 'active_at', "label_ids" STRING PATH 'string-join(label_ids/text(),'', '')', "changed_at" STRING PATH 'changed_at', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "first_opened_at" STRING PATH 'first_opened_at', "opened_at" STRING PATH 'opened_at', "first_resolved_at" STRING PATH 'first_resolved_at', "resolved_at" STRING PATH 'resolved_at', "status" STRING PATH 'status', "active_notes_count" STRING PATH 'active_notes_count', "active_attachments_count" STRING PATH 'active_attachments_count', "has_pending_interactions" STRING PATH 'has_pending_interactions', "has_failed_interactions" STRING PATH 'has_failed_interactions', "description" STRING PATH 'description', "language" STRING PATH 'language', "received_at" STRING PATH 'received_at', "type" STRING PATH 'type', "labels" STRING PATH 'string-join(labels/text(),'', '')', "subject" STRING PATH 'subject', "custom_fields" STRING PATH 'custom_fields', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_customer_cases] Totalrecords from get_list_customer_cases are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = select
                        count ( * )
                    from
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_customer_cases] Totalrecords are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
14	2015-04-24 18:17:53	TEIID30352 AFFILINET.INVOKE does not exist.	views.affilinet_getLogonToken	"CREATE VIRTUAL PROCEDURE views.affilinet_getLogonToken(IN Username string, IN Password string, IN WebServiceType string) RETURNS (credentialToken string) AS
BEGIN
SELECT r.* FROM TABLE(EXEC affilinet.invoke(EndPoint => 'https://api.affili.net/V2.0/Logon.svc', action => 'http://affilinet.framework.webservices/Svc/ServiceContract1/Logon', binding => 'SOAP11', request => XMLPARSE(CONTENT (((((('
          <svc:LogonRequestMsg xmlns:svc=""http://affilinet.framework.webservices/Svc"" xmlns:typ=""http://affilinet.framework.webservices/types"">
           <typ:Username>' || 'anja.schreiber@outfittery.de') || '</typ:Username>
           <typ:Password>') || 'paulsaffilies') || '</typ:Password>
           <typ:WebServiceType>') || 'Publisher') || '</typ:WebServiceType>
           <typ:DeveloperSettings>
              <typ:SandboxPublisherID>403233</typ:SandboxPublisherID>
           </typ:DeveloperSettings>
       </svc:LogonRequestMsg>')))) AS c, XMLTABLE('//*' PASSING c.result COLUMNS CredentialToken string PATH '.') AS r;
END"	FAILED
196,627	2015-08-10 15:23:24		desk_com_connector.get_list_etags	CREATE virtual procedure desk_com_connector.get_list_etags (
) RETURNS (
    "idColumn" integer
    ,"endpoint" string
    ,"value" string
    ,"total_entries" string
    ,"page" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.endpoint"
            ,"xml_table.value"
            ,"xml_table.total_entries"
            ,"xml_table.page"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'etags?endpoints=users,groups,labels,macros'
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"endpoint" STRING PATH 'endpoint'
                ,"value" STRING PATH 'value'
                ,"total_entries" STRING PATH '../../total_entries'
                ,"page" STRING PATH '../../page'
            ) "xml_table" ;
end	READY
196,628	2015-08-10 15:23:25		desk_com_connector.get_list_filters	CREATE virtual procedure desk_com_connector.get_list_filters ( IN in_since_id integer ) RETURNS ( "id" integer, "name" string, "position" string, "active" string, "routing_enabled" string, "sort_field" string, "sort_direction" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'filters?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "position" string, "active" string, "routing_enabled" string, "sort_field" string, "sort_direction" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'filters?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'filters?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_filters] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'filters?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'filters?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'filters?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_filters] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.position"
                        , "xml_table.active"
                        , "xml_table.routing_enabled"
                        , "xml_table.sort_field"
                        , "xml_table.sort_direction"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "name" STRING PATH 'name', "position" STRING PATH 'position', "active" STRING PATH 'active', "routing_enabled" STRING PATH 'routing_enabled', "sort_field" STRING PATH 'sort_field', "sort_direction" STRING PATH 'sort_direction', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_filters] Totalrecords from get_list_filters are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_filters] Totalrecords from get_list_filters are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
262,144	2015-09-07 13:42:28		raw.cs_desk_populate_stage2	"CREATE virtual procedure raw.cs_desk_populate_stage2 (
    IN stg2_table string
) as
/*********************************************************************************
  Author  :	Murari Goswami                                   
  Date    : 07/09/2015                                        
  Purpose :	Created this procedure to extract all the 
   			reporting details into a delta table and store them in a incremental
   			order into the reporting table.
**********************************************************************************/
begin
    /* Calling the internal DV server validarion process to check and return error in case of failure
       The process will break in case of the validation fails*/
    call ""desk_com_connector.internal_validateServerVersion"" (
    ) ;
    /* Calling the internal DV server validarion process to check and return error in case of failure*/
    DECLARE string VARIABLES.dwh_schema = (
        select
                nameindv
            from
                (
                    exec getCurrentDWH ()) a
    ) ;    
    DECLARE string VARIABLES.vdb_name = 'datavirtuality' ;
    /* Declaring the Delta table Name which will hold 1 day worth of desk data*/
    DECLARE string VARIABLES.deltatable = LCASE (
        replace (
            stg2_table
            ,'""'
            ,''
        ) || '_delta'
    ) ; 
    /*Declaring the job locking table Name that will control the overlapping execution hecne
      all overlapping execution can be restricted. */
    DECLARE string VARIABLES.locktable = LCASE (
        replace (
            stg2_table
            ,'""'
            ,''
        ) || '_joblock'
    ) ;  
    DECLARE date VARIABLES.start_date = (
        select
                TIMESTAMPADD (
                    SQL_TSI_DAY
                    ,1
                    ,max (extraction_start_date)
                )
            from
                ""dwh.desk_case_audit_ctrl""
    ) ; /* Capture the start date of data extraction from the control table. The control table will
    	   in charge of the daily execution. In case of repeat execution it will increment the completion date 
    	   flag and make it ready for next execution.*/
    
    DECLARE date VARIABLES.ctrl_date = (
        select
                max (extraction_start_date)
            from
                ""dwh.desk_case_audit_ctrl""
    ) ;  
    
    /* Set of differne variable declaration to capture different data points within the procedure*/
    DECLARE date VARIABLES.max_delta_date = null ;
    DECLARE date VARIABLES.max_changed_at = null ;
    DECLARE long VARIABLES.Finance = 0;
    DECLARE long VARIABLES.Datenschutz = 0;
    DECLARE long VARIABLES.Lieferung_Ruckversand = 0;
    DECLARE long VARIABLES.Reklamation = 0;
    DECLARE long VARIABLES.Service = 0;
    DECLARE long VARIABLES.Storno_Adresanderung = 0;
    DECLARE long VARIABLES.Emarsys = 0;
    DECLARE long VARIABLES.new_cases = 0 ;
    DECLARE long VARIABLES.closed_cases = 0 ;
    DECLARE long VARIABLES.reopened_case = 0 ;
    DECLARE double VARIABLES.quote_reopened_closed_case = 0 ;
    DECLARE long VARIABLES.t1_response = 0 ;
    DECLARE string VARIABLES.t1_response_format = null ;
    DECLARE long VARIABLES.t1_resolved = 0 ;
    DECLARE string VARIABLES.t1_resolved_format = null ;
    DECLARE long VARIABLES.var_exec_number = (
        select
                max (exec_number)+1
            from
                ""dwh.desk_case_audit_ctrl""
    ) ;
/**************************************************************************************************************/
/* Main programme starts here...*/
    IF (
        VARIABLES.dwh_schema IS NULL
    )
    BEGIN
        ERROR 'DWH schema name cannot be NULL' ;
    END
    IF (
        EXISTS (
            select
                    *
                from
                    SYS.Tables t
                where
                    LCASE (t.VDBName) = LCASE (VARIABLES.vdb_name)
                    and LCASE (t.schemaName) = LCASE (VARIABLES.dwh_schema)
                    and LCASE (
                        (
                            t.schemaName || '.' || t.name
                        )
                    ) = LCASE (VARIABLES.locktable)
        )
    )
    BEGIN
        ERROR 'Another ""cs_desk_populate_stage2"" stage 2 table update is already running on the provided stage 2 table. Please, wait until the concurrent update is completed. If the server has been suddenly shut down when a batch udpate was running or an unexpected error occurred during a previous batch execution, it is possible that the lock table has not been correctly dropped. Only in this case, please manually delete the lock table from the DV Server running the command DROP TABLE ' || VARIABLES.locktable ;
    END
    EXECUTE IMMEDIATE 'CREATE TABLE ' || VARIABLES.locktable || '(text string)' WITHOUT RETURN ;
   
    /* Check to make sure that data extraction are up to date and in case of no further data to extract then raise the error*/
    VARIABLES.max_changed_at = (
        SELECT
                max (
                    cast (
                        changed_at as date
                    )
                )
            from
                ""dwh.desk_raw_cases""
    ) ;
    IF (
        VARIABLES.max_changed_at <= VARIABLES.ctrl_date
    )
    BEGIN
        ERROR 'There are no data loaded after the last extraction done do far ' || '. The last extraction was done for ' ||  
        ctrl_date ;
    END
 /* Preliminary Checks done and ready to proceed to the next step of data population and stage 2 data dump*/
 /* Create delta table for the last 1 day change. This data will be extracted from desk raw cases table*/  
 /* Cleansing of delta table for before processing.*/
 
    delete from  dwh.desk_case_report_delta ;   
 
   /*Populate Delta table with the recent 1 day data from the raw information. Data population Criteria : Changed_At  =  Audit    
    control date && Update_At = Audit Control date (? id not already pulled  with Changed_At criteria)*/
    insert into dwh.desk_case_report_delta
    (select * from dwh.desk_raw_cases
	 where cast (changed_at as date) = 
    (select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
    from dwh.desk_case_audit_ctrl)) ;
    insert into dwh.desk_case_report_delta
    (select * from  dwh.desk_raw_cases
    where (cast (updated_at as date) = 
    (select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
     from  dwh.desk_case_audit_ctrl)
     and id not in (select id from dwh.desk_case_report_delta))) ;
     
    /*Clearing any existing data in the report table for running date.  A step for re run ablity.*/
    execute immediate 'delete from ' || stg2_table || ' where cast (ndate as date)    
    = (select TIMESTAMPADD(SQL_TSI_DAY,1,max(extraction_start_date)) from dwh.desk_case_audit_ctrl)' ;

    /*Insert the date for current processing day into the report table*/
    insert into dwh.desk_case_report (nDate,week_no) values (VARIABLES.start_date,week(VARIABLES.start_date)) ;

    /* Data point calculation for Labels like Finance*/
    VARIABLES.Finance = (select count(distinct id) from dwh.desk_raw_cases
										where cast(created_at as date) = 
										(select  cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
	                       				 from  dwh.desk_case_audit_ctrl)
											and labels like '%Finance%');
	/*Data point calculation for Labels like Datenschutz*/										
    VARIABLES.Datenschutz = (select count(distinct id) from dwh.desk_raw_cases
										where cast(created_at as date) = 
										(select  cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
	                       				 from  dwh.desk_case_audit_ctrl)
											and labels like '%Datenschutz%');
	/*Data point calculation for Labels like Lieferung und Rckversand*/
    VARIABLES.Lieferung_Ruckversand = (select count(distinct id) from dwh.desk_raw_cases
										where cast(created_at as date) = 
										(select  cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
	                       				 from  dwh.desk_case_audit_ctrl)
											and labels like '%Lieferung und Rckversand%');
	/*Data point calculation for Labels like Reklamation*/										
    VARIABLES.Reklamation = (select count(distinct id) from dwh.desk_raw_cases
										where cast(created_at as date) = 
										(select  cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
	                       				 from  dwh.desk_case_audit_ctrl)
											and labels like '%Reklamation%');
    /*Data point calculation for Labels like Service*/
    VARIABLES.Service = (select count(distinct id) from dwh.desk_raw_cases
										where cast(created_at as date) = 
										(select  cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
	                       				 from  dwh.desk_case_audit_ctrl)
											and labels like '%Service%');
    /*Data point calculation for Labels like Storno - Adresnderung Cases*/
    VARIABLES.Storno_Adresanderung = (select count(distinct id) from dwh.desk_raw_cases
										where cast(created_at as date) = 
										(select  cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
	                       				 from  dwh.desk_case_audit_ctrl)
											and labels like '%Storno - Adresnderung Cases%');
    /*Data point calculation for Labels like Emarsys*/
    VARIABLES.Emarsys = (select count(distinct id) from dwh.desk_raw_cases
										where cast(created_at as date) = 
										(select  cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
	                       				 from  dwh.desk_case_audit_ctrl)
											and labels like '%Emarsys%');
	/*Update all respective field values in Stage 2 DESK_CASE_REPORT table*/									
    update dwh.desk_case_report
    set Finance = VARIABLES.Finance, Datenschutz = VARIABLES.Datenschutz, Lieferung_Ruckversand = VARIABLES.Lieferung_Ruckversand,
    				Reklamation=VARIABLES.Reklamation, Service=VARIABLES.Service,
    				Storno_Adresanderung= VARIABLES.Storno_Adresanderung, Emarsys=VARIABLES.Emarsys
    where ndate = (select cast ( TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date))as date)
                    from  dwh.desk_case_audit_ctrl);
	
	/*Calculate and Update Values  for New Case as the ? (Finance, Datenschutz, Lieferung_Ruckversand, Reklamation, Service,   
	 Storno_Adresanderung, Emarsys)*/
	VARIABLES.new_cases = (VARIABLES.Finance+VARIABLES.Datenschutz+VARIABLES.Lieferung_Ruckversand+
							VARIABLES.Reklamation+VARIABLES.Service+VARIABLES.Storno_Adresanderung+VARIABLES.Emarsys);
    update dwh.desk_case_report
    set new_cases = VARIABLES.new_cases
    where ndate = (select cast ( TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date))as date)
                    from  dwh.desk_case_audit_ctrl);
   
    /*Calculate and Update Values  for Reopened Case as opened_date = control date*/
    VARIABLES.reopened_case = (SELECT count (distinct id) FROM dwh.desk_raw_cases
					            where cast (opened_at as date) = 
					            (select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
		                        from dwh.desk_case_audit_ctrl));
    update dwh.desk_case_report
    set reopened_case = VARIABLES.reopened_case
    where ndate = (select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
                    from dwh.desk_case_audit_ctrl);
            
    /*Calculate and Update Values  for closed Case as status = closed &  (Changed At || Updated At ) = Control Date*/
    VARIABLES.closed_cases = (SELECT count (distinct id) FROM dwh.desk_raw_cases
				            	where (nvl(status, 'zzz') = 'closed' 
				            		and 
				            		(cast (changed_at as date) = 
				            							(select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max 																			(extraction_start_date)) as date)
                        		 						from dwh.desk_case_audit_ctrl)
				            			or 
				            	 		cast (updated_at as date) = 
				            							(select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max 																			(extraction_start_date)) as date)
                        								 from dwh.desk_case_audit_ctrl)
				            	)));
	
    update dwh.desk_case_report
    set closed_case = VARIABLES.closed_cases
    where ndate = (select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
                    from dwh.desk_case_audit_ctrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    /*Calculate and Update Values  for Time to 1st Response   Average (Created At  First Opened At)*/
    VARIABLES.t1_response = (SELECT cast(AVG(cast(COALESCE(TIMESTAMPDIFF(SQL_TSI_SECOND,created_at,first_opened_at),0) as long)) 											as long)  
  	                       FROM dwh.desk_raw_cases
  	                       where cast(first_opened_at as date) =
	                        (select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
		                        from dwh.desk_case_audit_ctrl));  
    
    /*Call custom function (sec_2_hrmisec) to convert the time difference from long to hhmiss format*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	VARIABLES.t1_response_format = (call raw.sec_2_hrmisec(VARIABLES.t1_response));  
    update dwh.desk_case_report
  	set t1_response = VARIABLES.t1_response_format
	where ndate = (select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
                 from dwh.desk_case_audit_ctrl);  
  
  /*Calculate and Update Values  for Time to 1st Resolution   Average (Created At  First Resolved At)*/
  VARIABLES.t1_resolved = (SELECT cast(AVG(cast(COALESCE(TIMESTAMPDIFF(SQL_TSI_SECOND,created_at,first_resolved_at),0) as long)) 								as long)  
  	                       FROM dwh.desk_raw_cases
  	                       where cast(first_resolved_at as date) =
	                        (select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
		                        from dwh.desk_case_audit_ctrl));  
		                        
  /*Call custom function (sec_2_hrmisec) to convert the time difference from long to hhmiss format*/
  VARIABLES.t1_resolved_format = (call raw.sec_2_hrmisec(VARIABLES.t1_resolved)); /* This is going to be an insertion*/
  update dwh.desk_case_report
  set t1_resolve = VARIABLES.t1_resolved_format
  where ndate = (select cast (TIMESTAMPADD (SQL_TSI_DAY,1,max (extraction_start_date)) as date)
                 from dwh.desk_case_audit_ctrl);
                 
  /*Update control table with  completion information on the days execution is over and make it ready for next execution*/
  insert into dwh.desk_case_audit_ctrl (extraction_start_date, extraction_end_date,processed_date,exec_number)
  values(VARIABLES.start_date,VARIABLES.start_date,curdate(),VARIABLES.var_exec_number);
  
  /*Drop Job_Lock Table to enable the process for next execution*/
  EXECUTE IMMEDIATE 'DROP TABLE ' || VARIABLES.locktable WITHOUT RETURN ;
end"	READY
17	2015-04-24 18:19:18	TEIID30352 AFFILINET.INVOKE does not exist.	views.affilinet_getDailyPublisherStats	"create virtual procedure views.affilinet_getDailyPublisherStats ( 
in StartDate date,
in EndDate date,
in SubId string,
in ProgramTypes string,
in ValuationType string,
in ProgramId integer
)
returns (    
""Date"" string,
""TotalCommission"" string,
""TotalOpenCommission"" string,
""PayPerClick_Commission"" string,
""PayPerClick_Views"" string,
""PayPerClick_Clicks"" string,
""PayPerSaleLead_OpenCommission"" string,
""PayPerSaleLead_OpenSales"" string,
""PayPerSaleLead_CancelledSales"" string,
""PayPerSaleLead_ConfirmedSales"" string,
""PayPerSaleLead_Commission"" string,
""PayPerSaleLead_Views"" string,
""PayPerSaleLead_Clicks"" string,
""CombinedPrograms_OpenCommission"" string,
""CombinedPrograms_OpenSales"" string,
""CombinedPrograms_CancelledSales"" string,
""CombinedPrograms_ConfirmedSales"" string,
""CombinedPrograms_Commission"" string,
""CombinedPrograms_Views"" string,
""CombinedPrograms_Clicks"" string
)
as
begin
select r.*
 from table( exec affilinet.invoke( 
      EndPoint=>'https://api.affili.net/V2.0/PublisherStatistics.svc',
      action=>'http://affilinet.framework.webservices/Svc/PublisherStatisticsContract/GetDailyStatistics',     
       binding=>'SOAP11',
       request=>xmlparse
       (
          content '
          <svc:GetDailyStatisticsRequest xmlns:svc=""http://affilinet.framework.webservices/Svc"" xmlns:pub=""http://affilinet.framework.webservices/types/PublisherStatistics"">
          <svc:CredentialToken>' || ( call views.affilinet_getLogonToken( ) ) || '</svc:CredentialToken>
          <svc:GetDailyStatisticsRequestMessage>
            <pub:StartDate>' || FORMATDATE( StartDate,  'yyyy-MM-dd' ) || '</pub:StartDate>
            <pub:EndDate>' || FORMATDATE( EndDate,  'yyyy-MM-dd' ) || '</pub:EndDate>
            <pub:SubId>' || SubId ||'</pub:SubId>
            <pub:ProgramTypes>' || ProgramTypes || '</pub:ProgramTypes>
            <pub:ValuationType>' || ValuationType || '</pub:ValuationType>
            <pub:ProgramId>' || ProgramId || '</pub:ProgramId>
            </svc:GetDailyStatisticsRequestMessage>
        </svc:GetDailyStatisticsRequest>
        '
          )
       )
      ) c,
      xmltable( 
      xmlnamespaces( 'http://affilinet.framework.webservices/Svc' as ""svc"", 
      'http://affilinet.framework.webservices/types/PublisherStatistics' as ""a"",
      'http://www.w3.org/2001/XMLSchema-instance' as ""i"" ),
      '//a:DailyStatisticsRecord' PASSING c.result COLUMNS
        ""Date"" string PATH 'a:Date',
        ""TotalCommission"" string PATH 'a:TotalCommission',
        ""TotalOpenCommission"" string PATH 'a:TotalOpenCommission',
        ""PayPerClick_Commission"" string PATH 'a:PayPerClick/a:Commission',
        ""PayPerClick_Views"" string PATH 'a:PayPerClick/a:Views',
        ""PayPerClick_Clicks"" string PATH 'a:PayPerClick/a:Clicks',
        ""PayPerSaleLead_OpenCommission"" string PATH 'a:PayPerSaleLead/a:OpenCommission',
        ""PayPerSaleLead_OpenSales"" string PATH 'a:PayPerSaleLead/a:OpenSales',
        ""PayPerSaleLead_CancelledSales"" string PATH 'a:PayPerSaleLead/a:CancelledSales',
        ""PayPerSaleLead_ConfirmedSales"" string PATH 'a:PayPerSaleLead/a:ConfirmedSales',
        ""PayPerSaleLead_Commission"" string PATH 'a:PayPerSaleLead/a:Commission',
        ""PayPerSaleLead_Views"" string PATH 'a:PayPerSaleLead/a:Views',
        ""PayPerSaleLead_Clicks"" string PATH 'a:PayPerSaleLead/a:Clicks',
        ""CombinedPrograms_OpenCommission"" string PATH 'a:CombinedPrograms/a:OpenCommission',
        ""CombinedPrograms_OpenSales"" string PATH 'a:CombinedPrograms/a:OpenSales',
        ""CombinedPrograms_CancelledSales"" string PATH 'a:CombinedPrograms/a:CancelledSales',
        ""CombinedPrograms_ConfirmedSales"" string PATH 'a:CombinedPrograms/a:ConfirmedSales',
        ""CombinedPrograms_Commission"" string PATH 'a:CombinedPrograms/a:Commission',
        ""CombinedPrograms_Views"" string PATH 'a:CombinedPrograms/a:Views',
        ""CombinedPrograms_Clicks"" string PATH 'a:CombinedPrograms/a:Clicks'
     ) r;
end"	FAILED
32,768	2015-04-24 19:18:33		affilinet_adv.internal_getCredentials	"CREATE virtual procedure affilinet_adv.internal_getCredentials (
    IN datasourceName string
    ,IN username string
    ,IN password string
) RETURNS (
    username string
    ,password string
) AS
BEGIN
    DECLARE string dsParams = (
        SELECT
                modelProperties
            FROM
                ""SYSADMIN.DataSources""
            where
                ""name"" = datasourceName
    ) ;
    DECLARE string i_username = 'USERNAME' ;
    DECLARE string i_password = 'PASSWORD' ;
    IF (
        username IS NOT NULL
    )
    BEGIN
        i_username = username ;
    END
    IF (
        password IS NOT NULL
    )
    BEGIN
        i_password = password ;
    END
    create local temporary table cre (
        username string
        ,password string
    ) ;
    EXECUTE IMMEDIATE 'insert into cre select
cast(username as string), cast( password as string)
from 
   ( 
       OBJECTTABLE ( 
           language    ''javascript'' ''var matches = par1.match(/([^=,]*)=(""(?:\\.|[^""\\]+)*""|[^,""]*)/g);
						var result = {};
						for( i=0;i<matches.length;i++) {
							var key = matches[i].match(/([^=,]*)=(""[^""]*""|[^,""]*)/)[1];
							var value = matches[i].match(/([^=,]*)=(""[^""]*""|[^,""]*)/)[2];
							result[key] = value;
						}
						result''
                       PASSING dsParams AS ""par1""  COLUMNS ""username"" object ''dv_row.' || i_username || ''', ""password"" object ''dv_row.' || i_password || '''
       ) AS x 
   );' without return ;
    select
            *
        from
            cre ;
END"	READY
196,629	2015-08-10 15:23:25		desk_com_connector.show_filter	CREATE virtual procedure desk_com_connector.show_filter (
    in in_filter_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
    ,"sort_field" string
    ,"sort_direction" string
    ,"position" string
    ,"active" string
    ,"routing_enabled" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
            ,"xml_table.sort_field"
            ,"xml_table.sort_direction"
            ,"xml_table.position"
            ,"xml_table.active"
            ,"xml_table.routing_enabled"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'filters/' || in_filter_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
                ,"sort_field" STRING PATH 'sort_field'
                ,"sort_direction" STRING PATH 'sort_direction'
                ,"position" STRING PATH 'position'
                ,"active" STRING PATH 'active'
                ,"routing_enabled" STRING PATH 'routing_enabled'
            ) "xml_table" ;
end	READY
196,641	2015-08-10 15:23:31		desk_com_connector.get_list_site_settings	CREATE virtual procedure desk_com_connector.get_list_site_settings ( IN in_since_id integer ) RETURNS ( "id" integer, "name" string, "value" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'site_settings?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "value" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'site_settings?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'site_settings?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_site_settings] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'site_settings?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'site_settings?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'site_settings?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_site_settings] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.value"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "name" STRING PATH 'name', "value" STRING PATH 'value', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_site_settings] Totalrecords from get_list_site_settings are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_site_settings] Totalrecords from get_list_site_settings are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,638	2015-08-10 15:23:30		desk_com_connector.show_macros	"CREATE virtual procedure desk_com_connector.show_macros (
	in in_macros_id string
) RETURNS (
    ""idColumn"" integer
    ,""id"" string
    ,""name"" string
    ,""description"" string
    ,""position"" string
    ,""enabled"" string
    ,""folders"" string
) as
begin
    call ""desk_com_connector.internal_validateServerVersion"" (
    ) ;
    SELECT
            ""xml_table.idColumn""
            ,""xml_table.id""
            ,""xml_table.name""
            ,""xml_table.description""
            ,""xml_table.position""
            ,""xml_table.enabled""
            ,""xml_table.folders""
        FROM
            (
                exec ""desk_com_ws"".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'macros/'||in_macros_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as ""xsi""
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS ""idColumn"" FOR ORDINALITY
                ,""name"" STRING PATH 'name'
                ,""id"" STRING PATH 'id'
                ,""description"" STRING PATH 'description'
                ,""position"" STRING PATH 'position'
                ,""enabled"" STRING PATH 'enabled'
                ,""folders"" STRING PATH 'string-join(folders/text(),'', '')'
            ) ""xml_table"" ;
end"	READY
196,639	2015-08-10 15:23:30		desk_com_connector.show_macros_action	CREATE virtual procedure desk_com_connector.show_macros_action (
    in in_macros_id string
    ,in in_action_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"type" string
    ,"value" string
    ,"created_at" string
    ,"updated_at" string
    ,"enabled" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.type"
            ,"xml_table.value"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.enabled"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'macros/' || in_macros_id || '/actions/' || in_action_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"type" STRING PATH 'type'
                ,"value" STRING PATH 'value'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"enabled" STRING PATH 'enabled'
            ) "xml_table" ;
end	READY
196,640	2015-08-10 15:23:31		desk_com_connector.show_rule	CREATE virtual procedure desk_com_connector.show_rule (
    in in_rules_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
    ,"description" string
    ,"created_at" string
    ,"updated_at" string
    ,"enabled" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
            ,"xml_table.description"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.enabled"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'rules/' || in_rules_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
                ,"description" STRING PATH 'description'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"enabled" STRING PATH 'enabled'
            ) "xml_table" ;
end	READY
196,667	2015-08-10 15:23:42		desk_com_connector.get_list_mailboxes_inbound	CREATE virtual procedure desk_com_connector.get_list_mailboxes_inbound ( ) RETURNS ( "id" string, "name" string, "hostname" string, "email" string, "last_checked_at" timestamp, "created_at" timestamp, "updated_at" timestamp, "inbound_address_filter" string, "outbound_address_filter" string, "last_error" string, "port" string, "enabled" string, "type" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare string endpointstring = 'mailboxes/inbound' ;
    SELECT
            "xml_table.id"
            , "xml_table.name"
            , "xml_table.hostname"
            , "xml_table.email"
            , PARSETIMESTAMP ( NULLIF ( "xml_table.last_checked_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "last_checked_at"
            , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
            , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
            , "xml_table.inbound_address_filter"
            , "xml_table.outbound_address_filter"
            , "xml_table.last_error"
            , "xml_table.port"
            , "xml_table.enabled"
            , "xml_table.type"
            , "xml_table.total_entries"
            , "xml_table.page"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" STRING PATH 'id', "name" STRING PATH 'name', "hostname" STRING PATH 'hostname', "email" STRING PATH 'email', "last_checked_at" STRING PATH 'last_checked_at', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "inbound_address_filter" STRING PATH 'inbound_address_filter', "outbound_address_filter" STRING PATH 'outbound_address_filter', "last_error" STRING PATH 'last_error', "port" STRING PATH 'port', "enabled" STRING PATH 'enabled', "type" STRING PATH 'type', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
end	READY
65,536	2015-04-30 16:10:39		views.convert_mssql_tstamp	"CREATE VIRTUAL PROCEDURE views.convert_mssql_tstamp(IN tstamp varbinary) RETURNS (itstamp biginteger) AS
BEGIN
SELECT x.itstamp FROM OBJECTTABLE(LANGUAGE 'javascript' 'new java.math.BigInteger(tstamp,16)' PASSING tstamp AS tstamp COLUMNS itstamp biginteger 'dv_row') AS x;
END"	READY
196,668	2015-08-10 15:23:42		desk_com_connector.get_list_mailboxes_outbound	create virtual procedure desk_com_connector.get_list_mailboxes_outbound ( ) RETURNS ( "id" string, "reply_to" string, "hostname" string, "last_error" string, "created_at" timestamp, "updated_at" timestamp, "port" string, "from_name" string, "from_email" string, "enabled" string, "default" string, "type" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare string endpointstring = 'mailboxes/outbound' ;
    SELECT
            "xml_table.id"
            , "xml_table.reply_to"
            , "xml_table.hostname"
            , "xml_table.last_error"
            , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
            , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
            , "xml_table.port"
            , "xml_table.from_name"
            , "xml_table.from_email"
            , "xml_table.enabled"
            , "xml_table.default"
            , "xml_table.type"
            , "xml_table.total_entries"
            , "xml_table.page"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" STRING PATH 'id', "reply_to" STRING PATH 'reply_to', "hostname" STRING PATH 'hostname', "last_error" STRING PATH 'last_error', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "port" STRING PATH 'port', "from_name" STRING PATH 'from_name', "from_email" STRING PATH 'from_email', "enabled" STRING PATH 'enabled', "default" STRING PATH 'default', "type" STRING PATH 'type', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
end	READY
196,669	2015-08-10 15:23:43		desk_com_connector.get_list_rules	CREATE virtual procedure desk_com_connector.get_list_rules ( IN in_since_id integer ) RETURNS ( "id" integer, "name" string, "description" string, "created_at" timestamp, "updated_at" timestamp, "enabled" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'rules?page=' || CurrentPage || '&per_page=' || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "description" string, "created_at" timestamp, "updated_at" timestamp, "enabled" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'rules?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'rules?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_rules] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'rules?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'rules?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'rules?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_rules] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.description"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.enabled"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "name" STRING PATH 'name', "description" STRING PATH 'description', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "enabled" STRING PATH 'enabled', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_rules] Totalrecords from get_list_rules are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_rules] Totalrecords from get_list_rules are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,670	2015-08-10 15:23:43		desk_com_connector.get_list_topics	CREATE virtual procedure desk_com_connector.get_list_topics ( IN in_since_id integer ) RETURNS ( "id" integer, "position" string, "allow_questions" string, "created_at" timestamp, "updated_at" timestamp, "description" string, "in_support_center" string, "name" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'topics?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "position" string, "allow_questions" string, "created_at" timestamp, "updated_at" timestamp, "description" string, "in_support_center" string, "name" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'topics?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'topics?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'topics?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'topics?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'topics?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.position"
                        , "xml_table.allow_questions"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.description"
                        , "xml_table.in_support_center"
                        , "xml_table.name"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "position" STRING PATH 'position', "allow_questions" STRING PATH 'allow_questions', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "description" STRING PATH 'description', "in_support_center" STRING PATH 'in_support_center', "name" STRING PATH 'name', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics] Totalrecords from get_list_topics are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics] Totalrecords from get_list_topics are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,642	2015-08-10 15:23:32		desk_com_connector.show_site_setting	CREATE virtual procedure desk_com_connector.show_site_setting (
    in in_site_setting_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
    ,"value" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
            ,"xml_table.value"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'site_settings/' || in_site_setting_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
                ,"value" STRING PATH 'value'
            ) "xml_table" ;
end	READY
196,643	2015-08-10 15:23:32		desk_com_connector.get_list_site_languages	CREATE virtual procedure desk_com_connector.get_list_site_languages ( ) RETURNS ( "id" string, "name" string, "customer" string, "is_case_default" string, "agent" string, "case" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare string endpointstring = 'site/languages' ;
    SELECT
            "xml_table.id"
            , "xml_table.name"
            , "xml_table.customer"
            , "xml_table.is_case_default"
            , "xml_table.agent"
            , "xml_table.case"
            , "xml_table.total_entries"
            , "xml_table.page"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" STRING PATH 'id', "name" STRING PATH 'name', "customer" STRING PATH 'customer', "is_case_default" STRING PATH 'is_case_default', "agent" STRING PATH 'agent', "case" STRING PATH 'case', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
end	READY
196,644	2015-08-10 15:23:32		desk_com_connector.show_site_language	CREATE virtual procedure desk_com_connector.show_site_language (
    in in_lang_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
    ,"customer" string
    ,"is_case_default" string
    ,"agent" string
    ,"case" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
            ,"xml_table.customer"
            ,"xml_table.is_case_default"
            ,"xml_table.agent"
            ,"xml_table.case"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'site/languages/' || in_lang_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
                ,"customer" STRING PATH 'customer'
                ,"is_case_default" STRING PATH 'is_case_default'
                ,"agent" STRING PATH 'agent'
                ,"case" STRING PATH 'case'
            ) "xml_table" ;
end	READY
196,645	2015-08-10 15:23:33		desk_com_connector.get_list_snippets	CREATE virtual procedure desk_com_connector.get_list_snippets ( ) RETURNS ( "name" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer totalrecords ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare string endpointstring = 'snippets?page=' || CurrentPage || '&per_page=' || PageSize ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "name" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'snippets' ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        while ( i <= querrycount )
        begin
            endpointstring = 'snippets?page=' || i || '&per_page=' || PageSize ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.name"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "name" STRING PATH 'name', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,646	2015-08-10 15:23:33		desk_com_connector.show_topic	CREATE virtual procedure desk_com_connector.show_topic (
    in in_topic_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"position" string
    ,"allow_questions" string
    ,"created_at" string
    ,"updated_at" string
    ,"description" string
    ,"in_support_center" string
    ,"name" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.position"
            ,"xml_table.allow_questions"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.description"
            ,"xml_table.in_support_center"
            ,"xml_table.name"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'topics/' || in_topic_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"position" STRING PATH 'position'
                ,"allow_questions" STRING PATH 'allow_questions'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"description" STRING PATH 'description'
                ,"in_support_center" STRING PATH 'in_support_center'
                ,"name" STRING PATH 'name'
            ) "xml_table" ;
end	READY
196,647	2015-08-10 15:23:33		desk_com_connector.show_topics_translation	CREATE virtual procedure desk_com_connector.show_topics_translation (
    in in_topic_id string
    ,in in_locale string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
    ,"locale" string
    ,"created_at" string
    ,"updated_at" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
            ,"xml_table.locale"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'topics/' || in_topic_id || '/translations/' || in_locale
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
                ,"locale" STRING PATH 'locale'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
            ) "xml_table" ;
end	READY
196,648	2015-08-10 15:23:34		desk_com_connector.show_twitter_user	CREATE virtual procedure desk_com_connector.show_twitter_user (
    in in_twitter_user_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"followers_count" string
    ,"verified" string
    ,"created_at" string
    ,"updated_at" string
    ,"handle" string
    ,"image_url" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.followers_count"
            ,"xml_table.verified"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.handle"
            ,"xml_table.image_url"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'twitter_users/' || in_twitter_user_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"followers_count" STRING PATH 'followers_count'
                ,"verified" STRING PATH 'verified'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"handle" STRING PATH 'handle'
                ,"image_url" STRING PATH 'image_url'
            ) "xml_table" ;
end	READY
196,649	2015-08-10 15:23:34		desk_com_connector.show_user	CREATE virtual procedure desk_com_connector.show_user (
    in in_user_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
    ,"email" string
    ,"created_at" string
    ,"updated_at" string
    ,"current_login_at" string
    ,"last_login_at" string
    ,"level" string
    ,"email_verified" string
    ,"public_name" string
    ,"avatar" string
    ,"available" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
            ,"xml_table.email"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.current_login_at"
            ,"xml_table.last_login_at"
            ,"xml_table.level"
            ,"xml_table.email_verified"
            ,"xml_table.public_name"
            ,"xml_table.avatar"
            ,"xml_table.available"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'users/' || in_user_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
                ,"email" STRING PATH 'email'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"current_login_at" STRING PATH 'current_login_at'
                ,"last_login_at" STRING PATH 'last_login_at'
                ,"level" STRING PATH 'level'
                ,"email_verified" STRING PATH 'email_verified'
                ,"public_name" STRING PATH 'public_name'
                ,"avatar" STRING PATH 'avatar'
                ,"available" STRING PATH 'available'
            ) "xml_table" ;
end	READY
196,650	2015-08-10 15:23:34		desk_com_connector.get_list_users_macros	CREATE virtual procedure desk_com_connector.get_list_users_macros ( IN in_since_id integer, in in_user_id string ) RETURNS ( "id" integer, "name" string, "description" string, "position" string, "enabled" string, "folders" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_user_id is null )
    or ( in_user_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'users/' || in_user_id || '/macros?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "description" string, "position" string, "enabled" string, "folders" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'users/' || in_user_id || '/macros?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'users/' || in_user_id || '/macros?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_macros] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'users/' || in_user_id || '/macros?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'users/' || in_user_id || '/macros?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'users/' || in_user_id || '/macros?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_macros] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.description"
                        , "xml_table.position"
                        , "xml_table.enabled"
                        , "xml_table.folders"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "name" STRING PATH 'name', "description" STRING PATH 'description', "position" STRING PATH 'position', "enabled" STRING PATH 'enabled', "folders" STRING PATH 'string-join(folders/text(),'', '')', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_macros] Totalrecords from get_list_users_macros are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_macros] Totalrecords from get_list_users_macros are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,651	2015-08-10 15:23:35		desk_com_connector.get_list_user_preferences	CREATE virtual procedure desk_com_connector.get_list_user_preferences ( in in_user_id string ) RETURNS ( "id" string, "name" string, "value" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_user_id is null )
    or ( in_user_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer totalrecords ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare string endpointstring = 'users/' || in_user_id || '/preferences?page=' || CurrentPage || '&per_page=' || PageSize ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" string, "name" string, "value" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'users/' || in_user_id || '/preferences' ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        while ( i <= querrycount )
        begin
            endpointstring = 'users/' || in_user_id || '/preferences?page=' || i || '&per_page=' || PageSize ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.value"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" STRING PATH 'id', "name" STRING PATH 'name', "value" STRING PATH 'value', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,652	2015-08-10 15:23:35		desk_com_connector.show_user_preference	create virtual procedure desk_com_connector.show_user_preference (
    in in_user_id string
    ,in in_pref_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"name" string
    ,"value" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.name"
            ,"xml_table.value"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'users/' || in_user_id || '/preferences/' || in_pref_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
                ,"value" STRING PATH 'value'
            ) "xml_table" ;
end	READY
196,653	2015-08-10 15:23:35		desk_com_connector.get_list_user_groups	CREATE virtual procedure desk_com_connector.get_list_user_groups ( IN in_since_id integer, in in_user_id string ) RETURNS ( "id" integer, "name" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_user_id is null )
    or ( in_user_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'users/' || in_user_id || '/groups?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'users/' || in_user_id || '/groups?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'users/' || in_user_id || '/groups?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_user_groups] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'users/' || in_user_id || '/groups?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'users/' || in_user_id || '/groups?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'users/' || in_user_id || '/groups?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_user_groups] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "name" STRING PATH 'name', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_user_groups] Totalrecords from get_list_user_groups are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_user_groups] Totalrecords from get_list_user_groups are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,654	2015-08-10 15:23:36		desk_com_connector.get_list_custom_fields	CREATE virtual procedure desk_com_connector.get_list_custom_fields ( ) RETURNS ( "id" integer, "name" string, "active" string, "label" string, "type" string, "data_type" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer totalrecords ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare string endpointstring = 'custom_fields?page=' || CurrentPage || '&per_page=' || PageSize ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "name" string, "active" string, "label" string, "type" string, "data_type" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'custom_fields' ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        while ( i <= querrycount )
        begin
            endpointstring = 'custom_fields?page=' || i || '&per_page=' || PageSize ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.active"
                        , "xml_table.label"
                        , "xml_table.type"
                        , "xml_table.data_type"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '/root/_embedded/entries/data/type' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH '../../id', "name" STRING PATH '../../name', "active" STRING PATH '../../active', "label" STRING PATH '../../label', "type" STRING PATH '../../type', "data_type" STRING PATH '.', "total_entries" STRING PATH '../../../../total_entries', "page" STRING PATH '../../../../page' ) "xml_table" ;
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,655	2015-08-10 15:23:36		desk_com_connector.show_custom_field	CREATE virtual procedure desk_com_connector.show_custom_field (
    in in_field_id string
) RETURNS (
    "id" string
    ,"name" string
    ,"active" string
    ,"label" string
    ,"type" string
    ,"data_type" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_field_id is null
        )
        or (
            in_field_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'custom_fields/' || in_field_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.name"
            ,"xml_table.active"
            ,"xml_table.label"
            ,"xml_table.type"
            ,"xml_table.data_type"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'/root/data/type' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH '../../id'
                ,"name" STRING PATH '../../name'
                ,"active" STRING PATH '../../active'
                ,"label" STRING PATH '../../label'
                ,"type" STRING PATH '../../type'
                ,"data_type" STRING PATH '.'
            ) "xml_table" ;
end	READY
196,656	2015-08-10 15:23:37		desk_com_connector.get_list_cases_wo_pagination	CREATE virtual procedure desk_com_connector.get_list_cases_wo_pagination (
    in in_pade_num integer
    ,in in_page_size integer
) RETURNS (
    "id" string
    ,"blurb" string
    ,"priority" string
    ,"locked_until" string
    ,"label_ids" string
    ,"active_at" string
    ,"changed_at" string
    ,"created_at" string
    ,"updated_at" string
    ,"first_opened_at" string
    ,"opened_at" string
    ,"first_resolved_at" string
    ,"resolved_at" string
    ,"status" string
    ,"active_notes_count" string
    ,"active_attachments_count" string
    ,"has_pending_interactions" string
    ,"has_failed_interactions" string
    ,"description" string
    ,"language" string
    ,"received_at" string
    ,"type" string
    ,"labels" string
    ,"subject" string
    ,"custom_fields" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.id"
            ,"xml_table.blurb"
            ,"xml_table.priority"
            ,"xml_table.locked_until"
            ,"xml_table.label_ids"
            ,"xml_table.active_at"
            ,"xml_table.changed_at"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.first_opened_at"
            ,"xml_table.opened_at"
            ,"xml_table.first_resolved_at"
            ,"xml_table.resolved_at"
            ,"xml_table.status"
            ,"xml_table.active_notes_count"
            ,"xml_table.active_attachments_count"
            ,"xml_table.has_pending_interactions"
            ,"xml_table.has_failed_interactions"
            ,"xml_table.description"
            ,"xml_table.language"
            ,"xml_table.received_at"
            ,"xml_table.type"
            ,"xml_table.labels"
            ,"xml_table.subject"
            ,"xml_table.custom_fields"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'cases?page=' || in_pade_num || '&per_page=' || in_page_size
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"blurb" STRING PATH 'blurb'
                ,"priority" STRING PATH 'priority'
                ,"locked_until" STRING PATH 'locked_until'
                ,"label_ids" STRING PATH 'string-join(label_ids/text(),'', '')'
                ,"active_at" STRING PATH 'active_at'
                ,"changed_at" STRING PATH 'changed_at'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"first_opened_at" STRING PATH 'first_opened_at'
                ,"opened_at" STRING PATH 'opened_at'
                ,"first_resolved_at" STRING PATH 'first_resolved_at'
                ,"resolved_at" STRING PATH 'resolved_at'
                ,"status" STRING PATH 'status'
                ,"active_notes_count" STRING PATH 'active_notes_count'
                ,"active_attachments_count" STRING PATH 'active_attachments_count'
                ,"has_pending_interactions" STRING PATH 'has_pending_interactions'
                ,"has_failed_interactions" STRING PATH 'has_failed_interactions'
                ,"description" STRING PATH 'description'
                ,"language" STRING PATH 'language'
                ,"received_at" STRING PATH 'received_at'
                ,"type" STRING PATH 'type'
                ,"labels" STRING PATH 'string-join(labels/text(),'', '')'
                ,"subject" STRING PATH 'subject'
                ,"custom_fields" STRING PATH 'custom_fields'
            ) "xml_table" ;
end	READY
196,657	2015-08-10 15:23:37		desk_com_connector.get_list_companies	CREATE virtual procedure desk_com_connector.get_list_companies ( IN in_since_id integer ) RETURNS ( "total_entries" string, "page" string, "id" integer, "name" string, "created_at" timestamp, "updated_at" timestamp, "domains" string, "custom_fields" string, customers_href string, cases_href string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'companies?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "total_entries" string, "page" string, "id" integer, "name" string, "created_at" timestamp, "updated_at" timestamp, "domains" string, "custom_fields" string, customers_href string, cases_href string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'companies?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'companies?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_companies] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'companies?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'companies?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'companies?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_companies] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.total_entries"
                        , "xml_table.page"
                        , "xml_table.id"
                        , "xml_table.name"
                        , PARSETIMESTAMP ( "xml_table.created_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( "xml_table.updated_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.domains"
                        , "xml_table.custom_fields"
                        , "xml_table.customers_href"
                        , "xml_table.cases_href"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page', "id" INTEGER PATH 'id', "name" STRING PATH 'name', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "domains" STRING PATH 'string-join(domains/text(),'', '')', "custom_fields" STRING PATH 'custom_fields', "customers_href" STRING PATH '_links/customers/href', "cases_href" STRING PATH '_links/cases/href' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_companies] Totalrecords from get_list_companies are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_companies] Totalrecords are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,658	2015-08-10 15:23:37		desk_com_connector.get_list_customers	CREATE virtual procedure desk_com_connector.get_list_customers ( IN in_since_id integer ) RETURNS ( "id" integer, "first_name" string, "last_name" string, "company" string, "title" string, "external_id" string, "locked_until" string, "created_at" timestamp, "updated_at" timestamp, "background" string, "language" string, "access_private_portal" string, "access_company_cases" string, "avatar" string, "uid" string, "custom_fields" string, "email_type" string, "email_value" string, "phone_type" string, "phone_value" string, "addresses_type" string, "addresses_value" string, "total_entries" string, "page" string, "locked_by" string, "company_id" string, "facebook_user" string, "twitter_user_id" string, "cases_href" string, "cases_count" integer ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'customers?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "first_name" string, "last_name" string, "company" string, "title" string, "external_id" string, "locked_until" string, "created_at" timestamp, "updated_at" timestamp, "background" string, "language" string, "access_private_portal" string, "access_company_cases" string, "avatar" string, "uid" string, "custom_fields" string, "email_type" string, "email_value" string, "phone_type" string, "phone_value" string, "addresses_type" string, "addresses_value" string, "total_entries" string, "page" string, "locked_by" string, "company_id" string, "facebook_user" string, "twitter_user_id" string, "cases_href" string, "cases_count" integer ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'customers?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'customers?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_customers] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'customers?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'customers?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'customers?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_customers] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.first_name"
                        , "xml_table.last_name"
                        , "xml_table.company"
                        , "xml_table.title"
                        , "xml_table.external_id"
                        , "xml_table.locked_until"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.background"
                        , "xml_table.language"
                        , "xml_table.access_private_portal"
                        , "xml_table.access_company_cases"
                        , "xml_table.avatar"
                        , "xml_table.uid"
                        , "xml_table.custom_fields"
                        , "xml_table.email_type"
                        , "xml_table.email_value"
                        , "xml_table.phone_type"
                        , "xml_table.phone_value"
                        , "xml_table.addresses_type"
                        , "xml_table.addresses_value"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                        , "xml_table.locked_by"
                        , nvl ( substring ( "xml_table.company_id", 19 ), 0 ) as company_id
                        , "xml_table.facebook_user"
                        , nvl ( substring ( "xml_table.twitter_user_id", 23 ), 0 ) as twitter_user_id
                        , "xml_table.cases_href"
                        , "xml_table.cases_count"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "first_name" STRING PATH 'first_name', "last_name" STRING PATH 'last_name', "company" STRING PATH 'company', "title" STRING PATH 'title', "external_id" STRING PATH 'external_id', "locked_until" STRING PATH 'locked_until', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "background" STRING PATH 'background', "language" STRING PATH 'language', "access_private_portal" STRING PATH 'access_private_portal', "access_company_cases" STRING PATH 'access_company_cases', "avatar" STRING PATH 'avatar', "uid" STRING PATH 'uid', "custom_fields" STRING PATH 'custom_fields', "email_type" STRING PATH 'string-join(emails/type/text(),'', '')', "email_value" STRING PATH 'string-join(emails/value/text(),'', '')', "phone_type" STRING PATH 'string-join(phone_numbers/type/text(),'', '')', "phone_value" STRING PATH 'string-join(phone_numbers/value/text(),'', '')', "addresses_type" STRING PATH 'string-join(addresses/type/text(),'', '')', "addresses_value" STRING PATH 'string-join(addresses/value/text(),'', '')', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page', "locked_by" STRING PATH '_links/locked_by', "company_id" STRING PATH '_links/company/href', "facebook_user" STRING PATH '_links/facebook_user', "twitter_user_id" STRING PATH '_links/twitter_user/href', "cases_href" STRING PATH '_links/cases/href', "cases_count" integer PATH '_links/cases/count' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_customers] Totalrecords from get_list_customers are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_customers] Totalrecords from get_list_customers are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
    end
    SELECT
            *
        FROM
            tmpTable ;
end	READY
196,659	2015-08-10 15:23:38		desk_com_connector.get_list_articles	CREATE virtual procedure desk_com_connector.get_list_articles ( IN in_since_id integer, IN dwh_table string ) RETURNS ( "id" integer, "subject" string, "body" string, "body_email" string, "body_email_auto" string, "body_chat" string, "body_twitter" string, "body_qna" string, "body_phone" string, "body_facebook" string, "quickcode" string, "publish_at" timestamp, "updated_at" timestamp, "created_at" timestamp, "public_url" string, "body_chat_auto" string, "body_web_callback" string, "body_web_callback_auto" string, "body_twitter_auto" string, "body_qna_auto" string, "body_phone_auto" string, "rating" string, "rating_count" string, "rating_score" string, "keywords" string, "position" string, "in_support_center" string, "internal_notes" string, "total_entries" string, "page" string, topic_id string, translations_href string, attachements_href string, attachments_count integer, created_by_user_id string, updated_by_user_id string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'articles?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE string VARIABLES.dwh_schema = ( select
            nameindv
        from
            ( exec getCurrentDWH ( ) ) a ) ;
    DECLARE string VARIABLES.vdb_name = 'datavirtuality' ;
    DECLARE string VARIABLES.deltatable = LCASE ( replace ( dwh_table, '"', '' ) || 'delta' ) ;
    DECLARE string VARIABLES.locktable = LCASE ( replace ( dwh_table, '"', '' ) || 'lock' ) ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE TabTmpCount ( c long ) ;
    IF ( VARIABLES.dwh_schema IS NULL )
    BEGIN
        ERROR 'DWH schema name cannot be NULL' ;
    END
    IF ( EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( VARIABLES.locktable ) ) )
    BEGIN
        ERROR 'Another "get_list_articles" incremental update is already running on the provided DWH table. Please, wait until the concurrent update is completed. If the server has been suddenly shut down when a batch udpate was running or an unexpected error occurred during a previous batch execution, it is possible that the lock table has not been correctly dropped. Only in this case, please manually delete the lock table from the DV Server running the command DROP TABLE ' || VARIABLES.locktable ;
    END
    EXECUTE IMMEDIATE 'CREATE TABLE ' || VARIABLES.locktable || '(a integer)' WITHOUT RETURN ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "subject" string, "body" string, "body_email" string, "body_email_auto" string, "body_chat" string, "body_twitter" string, "body_qna" string, "body_phone" string, "body_facebook" string, "quickcode" string, "publish_at" timestamp, "updated_at" timestamp, "created_at" timestamp, "public_url" string, "body_chat_auto" string, "body_web_callback" string, "body_web_callback_auto" string, "body_twitter_auto" string, "body_qna_auto" string, "body_phone_auto" string, "rating" string, "rating_count" string, "rating_score" string, "keywords" string, "position" string, "in_support_center" string, "internal_notes" string, "total_entries" string, "page" string, topic_id string, translations_href string, attachements_href string, attachments_count integer, created_by_user_id string, updated_by_user_id string ) ;
    IF ( NOT EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( replace ( dwh_table, '"', '' ) ) ) )
    BEGIN
        EXECUTE IMMEDIATE 'SELECT * INTO ' || dwh_table || ' FROM  tmpTable LIMIT 0' WITHOUT RETURN ;
    END
    IF ( EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( VARIABLES.deltatable ) ) )
    BEGIN
        EXECUTE IMMEDIATE 'DROP TABLE ' || deltatable WITHOUT RETURN ;
    END
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&in_since_id=' || in_since_id ;
        endpointstring = 'articles?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
        totalrecords = ( SELECT
                "xml_table.total_entries"
            FROM
                ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'articles?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_articles] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'articles?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since___id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'articles?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'articles?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_articles] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , substring ( "xml_table.subject", 1, 4000 ) as subject
                        , substring ( "xml_table.body", 1, 4000 ) as body
                        , "xml_table.body_email"
                        , "xml_table.body_email_auto"
                        , "xml_table.body_chat"
                        , "xml_table.body_twitter"
                        , "xml_table.body_qna"
                        , "xml_table.body_phone"
                        , "xml_table.body_facebook"
                        , "xml_table.quickcode"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.publish_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "publish_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , "xml_table.public_url"
                        , "xml_table.body_chat_auto"
                        , "xml_table.body_web_callback"
                        , "xml_table.body_web_callback_auto"
                        , "xml_table.body_twitter_auto"
                        , "xml_table.body_qna_auto"
                        , "xml_table.body_phone_auto"
                        , "xml_table.rating"
                        , "xml_table.rating_count"
                        , "xml_table.rating_score"
                        , "xml_table.keywords"
                        , "xml_table.position"
                        , "xml_table.in_support_center"
                        , "xml_table.internal_notes"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                        , substring ( "xml_table.topic_id", 16 ) as topic_id
                        , "xml_table.translations_href"
                        , "xml_table.attachements_href"
                        , "xml_table.attachments_count"
                        , substring ( "xml_table.created_by_user_id", 15 ) as created_by_user_id
                        , substring ( "xml_table.updated_by_user_id", 15 ) as updated_by_user_id
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "subject" STRING PATH 'subject', "body" STRING PATH 'body', "body_email" STRING PATH 'body_email', "body_email_auto" STRING PATH 'body_email_auto', "body_chat" STRING PATH 'body_chat', "body_twitter" STRING PATH 'body_twitter', "body_qna" STRING PATH 'body_qna', "body_phone" STRING PATH 'body_phone', "body_facebook" STRING PATH 'body_facebook', "quickcode" STRING PATH 'quickcode', "publish_at" STRING PATH 'publish_at', "updated_at" STRING PATH 'updated_at', "created_at" STRING PATH 'created_at', "public_url" STRING PATH 'public_url', "body_chat_auto" STRING PATH 'body_chat_auto', "body_web_callback" STRING PATH 'body_web_callback', "body_web_callback_auto" STRING PATH 'body_web_callback_auto', "body_twitter_auto" STRING PATH 'body_twitter_auto', "body_qna_auto" STRING PATH 'body_qna_auto', "body_phone_auto" STRING PATH 'body_phone_auto', "rating" STRING PATH 'rating', "rating_count" STRING PATH 'rating_count', "rating_score" STRING PATH 'rating_score', "keywords" STRING PATH 'keywords', "position" STRING PATH 'position', "in_support_center" STRING PATH 'in_support_center', "internal_notes" STRING PATH 'internal_notes', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page', "topic_id" STRING PATH '_links/topic/href', "translations_href" STRING PATH '_links/translations/href', "attachements_href" STRING PATH '_links/attachments/href', "attachments_count" INTEGER PATH '_links/attachments/count', "created_by_user_id" STRING PATH '_links/created_by/href', "updated_by_user_id" STRING PATH '_links/updated_by/href' ) "xml_table" ;
            EXECUTE IMMEDIATE 'SELECT * INTO ' || VARIABLES.deltatable || ' FROM tmpTable' WITHOUT RETURN ;
            DELETE
                FROM
                    tmpTable ;
            /*---------------------------------------- checking duplicates*/
            /*            EXECUTE IMMEDIATE 'DELETE FROM ' || dwh_table || '  WHERE id IN (SELECT id as a FROM ' || VARIABLES.deltatable || ')' WITHOUT RETURN ; */
            /*---------------------------------------- checking duplicates*/
            EXECUTE IMMEDIATE 'INSERT INTO ' || dwh_table || ' SELECT * FROM ' || deltatable WITHOUT RETURN ;
            EXECUTE IMMEDIATE 'DROP TABLE ' || deltatable WITHOUT RETURN ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM ' || dwh_table WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_articles] Totalrecords from get_list_articles are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                DELETE
                    FROM
                        TabTmpCount ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpCount SELECT count(*) FROM ' || dwh_table WITHOUT RETURN ;
                records_processed = select
                        c
                    from
                        TabTmpCount ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_articles] Totalrecords from get_list_articles are ' || totalrecords || '.
        C are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
    end
    EXECUTE IMMEDIATE 'DROP TABLE ' || VARIABLES.locktable WITHOUT RETURN ;
    execute immediate 'select * from ' || dwh_table as "id" integer
    , "subject" string
    , "body" string
    , "body_email" string
    , "body_email_auto" string
    , "body_chat" string
    , "body_twitter" string
    , "body_qna" string
    , "body_phone" string
    , "body_facebook" string
    , "quickcode" string
    , "publish_at" timestamp
    , "updated_at" timestamp
    , "created_at" timestamp
    , "public_url" string
    , "body_chat_auto" string
    , "body_web_callback" string
    , "body_web_callback_auto" string
    , "body_twitter_auto" string
    , "body_qna_auto" string
    , "body_phone_auto" string
    , "rating" string
    , "rating_count" string
    , "rating_score" string
    , "keywords" string
    , "position" string
    , "in_support_center" string
    , "internal_notes" string
    , "total_entries" string
    , "page" string
    , topic_id string
    , translations_href string
    , attachements_href string
    , attachments_count integer
    , created_by_user_id string
    , updated_by_user_id string ;
end	READY
196,672	2015-08-10 15:23:44		desk_com_connector.get_list_translation_article	CREATE virtual procedure desk_com_connector.get_list_translation_article ( IN in_since_id integer, in in_article_id string ) RETURNS ( "id" integer, "subject" string, "body" string, "body_email" string, "body_email_auto" string, "body_chat" string, "body_twitter" string, "body_qna" string, "body_phone" string, "body_facebook" string, "quickcode" string, "publish_at" timestamp, "updated_at" timestamp, "created_at" timestamp, "public_url" string, "body_chat_auto" string, "body_web_callback" string, "body_web_callback_auto" string, "body_twitter_auto" string, "body_qna_auto" string, "body_phone_auto" string, "rating" string, "rating_count" string, "rating_score" string, "keywords" string, "position" string, "in_support_center" string, "internal_notes" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_article_id is null )
    or ( in_article_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "subject" string, "body" string, "body_email" string, "body_email_auto" string, "body_chat" string, "body_twitter" string, "body_qna" string, "body_phone" string, "body_facebook" string, "quickcode" string, "publish_at" timestamp, "updated_at" timestamp, "created_at" timestamp, "public_url" string, "body_chat_auto" string, "body_web_callback" string, "body_web_callback_auto" string, "body_twitter_auto" string, "body_qna_auto" string, "body_phone_auto" string, "rating" string, "rating_count" string, "rating_score" string, "keywords" string, "position" string, "in_support_center" string, "internal_notes" string, "total_entries" string, "page" string ) ;
    declare string endpointstring = 'articles' || '/' || in_article_id || '/translations?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'articles' || '/' || in_article_id || '/translations?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'articles' || '/' || in_article_id || '/translations?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_translation_article] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'articles' || '/' || in_article_id || '/translations?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'articles' || '/' || in_article_id || '/translations?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'articles' || '/' || in_article_id || '/translations?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_translation_article] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , substring ( "xml_table.subject", 1, 4000 ) as subject
                        , substring ( "xml_table.body", 1, 4000 ) as body
                        , "xml_table.body_email"
                        , "xml_table.body_email_auto"
                        , "xml_table.body_chat"
                        , "xml_table.body_twitter"
                        , "xml_table.body_qna"
                        , "xml_table.body_phone"
                        , "xml_table.body_facebook"
                        , "xml_table.quickcode"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.publish_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "publish_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , "xml_table.public_url"
                        , "xml_table.body_chat_auto"
                        , "xml_table.body_web_callback"
                        , "xml_table.body_web_callback_auto"
                        , "xml_table.body_twitter_auto"
                        , "xml_table.body_qna_auto"
                        , "xml_table.body_phone_auto"
                        , "xml_table.rating"
                        , "xml_table.rating_count"
                        , "xml_table.rating_score"
                        , "xml_table.keywords"
                        , "xml_table.position"
                        , "xml_table.in_support_center"
                        , "xml_table.internal_notes"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "subject" STRING PATH 'subject', "body" STRING PATH 'body', "body_email" STRING PATH 'body_email', "body_email_auto" STRING PATH 'body_email_auto', "body_chat" STRING PATH 'body_chat', "body_twitter" STRING PATH 'body_twitter', "body_qna" STRING PATH 'body_qna', "body_phone" STRING PATH 'body_phone', "body_facebook" STRING PATH 'body_facebook', "quickcode" STRING PATH 'quickcode', "publish_at" STRING PATH 'publish_at', "updated_at" STRING PATH 'updated_at', "created_at" STRING PATH 'created_at', "public_url" STRING PATH 'public_url', "body_chat_auto" STRING PATH 'body_chat_auto', "body_web_callback" STRING PATH 'body_web_callback', "body_web_callback_auto" STRING PATH 'body_web_callback_auto', "body_twitter_auto" STRING PATH 'body_twitter_auto', "body_qna_auto" STRING PATH 'body_qna_auto', "body_phone_auto" STRING PATH 'body_phone_auto', "rating" STRING PATH 'rating', "rating_count" STRING PATH 'rating_count', "rating_score" STRING PATH 'rating_score', "keywords" STRING PATH 'keywords', "position" STRING PATH 'position', "in_support_center" STRING PATH 'in_support_center', "internal_notes" STRING PATH 'internal_notes', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_translation_article] Totalrecords from get_list_translation_article are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_translation_article] Totalrecords from get_list_translation_article are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,690	2015-08-10 15:23:52		desk_com_connector.show_case_note	"CREATE virtual procedure desk_com_connector.show_case_note (
    in in_case_id string
    ,in in_note_id string    
) RETURNS (
	""id"" string
    ,""body"" string
    ,""created_at"" string
    ,""updated_at"" string
    ,""erased_at"" string
) as
begin
    call ""desk_com_connector.internal_validateServerVersion"" (
    ) ;
    if (
        (
            in_case_id is null
        )
        or (
            in_case_id = ''
        )
        or (
            in_note_id is null
        )
        or (
            in_note_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;    
    declare integer totalrecords ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare string endpointstring = 'cases/' || in_case_id || '/notes/' || in_note_id || '?page=' || CurrentPage || '&per_page=' || PageSize ;
    totalrecords = SELECT
            ""xml_table.total_entries""
        FROM
            (
                exec ""desk_com_ws"".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'cases/' || in_case_id || '/notes/' || in_note_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as ""xsi""
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS ""total_entries"" INTEGER PATH 'total_entries'
            ) ""xml_table"" ;
    if (
        totalrecords > 0
    )
    begin
        pagescount = cast (
            totalrecords as double
        ) / PageSize ;
        mod_val = pagescount - floor (pagescount) ;
        if (
            mod_val < 0.5
        )
        begin
            querrycount = round (
                cast (
                    pagescount as integer
                )
                ,0
            ) + 1 ;
        end
        else
        begin
            querrycount = round (
                cast (
                    pagescount as integer
                )
                ,0
            ) ;
        end
        CREATE LOCAL TEMPORARY TABLE tbltmp (
            ""id"" string
            ,""body"" string
            ,""created_at"" string
            ,""updated_at"" string
            ,""erased_at"" string
        ) ;
        while (
            i <= querrycount
        )
        begin
            endpointstring = 'cases/' || in_case_id || '/notes/' || in_note_id || '?page=' || i || '&per_page=' || PageSize ;
            INSERT
                INTO tbltmp SELECT
                        ""xml_table.id""
                        ,""xml_table.body""
                        ,""xml_table.created_at""
                        ,""xml_table.updated_at""
                        ,""xml_table.erased_at""
                    FROM
                        (
                            exec ""desk_com_ws"".invokeHTTP (
                                action => 'GET'
                                ,requestContentType => 'application/json'
                                ,endpoint => endpointstring
                            )
                        ) w
                        ,XMLTABLE (
                            XMLNAMESPACES (
                                'http://www.w3.org/2001/XMLSchema-instance' as ""xsi""
                            )
                            ,'//entries' PASSING JSONTOXML (
                                'root'
                                ,to_chars (
                                    w.result
                                    ,'UTF-8'
                                )
                            ) COLUMNS 
                            ""id"" STRING PATH 'id'
                            ,""body"" STRING PATH 'body'
                            ,""created_at"" STRING PATH 'created_at'
                            ,""updated_at"" STRING PATH 'updated_at'
                            ,""erased_at"" STRING PATH 'erased_at'
                        ) ""xml_table"" ;
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end"	READY
196,691	2015-08-10 15:23:53		desk_com_connector.show_case_draft_generic	create virtual procedure desk_com_connector.show_case_draft_generic (
    in in_case_id string
) RETURNS (
    "idColumn" integer
    ,"subject" string
    ,"body" string
    ,"direction" string
    ,"status" string
    ,"to" string
    ,"from" string
    ,"cc" string
    ,"bcc" string
    ,"client_type" string
    ,"created_at" string
    ,"updated_at" string
    ,"hidden_at" string
    ,"hidden" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_case_id is null
        )
        or (
            in_case_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'cases/' || in_case_id || '/draft' ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.subject"
            ,"xml_table.body"
            ,"xml_table.direction"
            ,"xml_table.status"
            ,"xml_table.to"
            ,"xml_table.from"
            ,"xml_table.cc"
            ,"xml_table.bcc"
            ,"xml_table.client_type"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.hidden_at"
            ,"xml_table.hidden"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"subject" STRING PATH 'subject'
                ,"body" STRING PATH 'body'
                ,"direction" STRING PATH 'direction'
                ,"status" STRING PATH 'status'
                ,"to" STRING PATH 'to'
                ,"from" STRING PATH 'from'
                ,"cc" STRING PATH 'cc'
                ,"bcc" STRING PATH 'bcc'
                ,"client_type" STRING PATH 'client_type'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"hidden_at" STRING PATH 'hidden_at'
                ,"hidden" STRING PATH 'hidden'
            ) "xml_table" ;
end	READY
196,660	2015-08-10 15:23:38		desk_com_connector.get_list_facebook_accounts	CREATE virtual procedure desk_com_connector.get_list_facebook_accounts ( IN in_since_id integer ) RETURNS ( "id" integer, "image_url" string, "profile_url" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'facebook_accounts?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "image_url" string, "profile_url" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'facebook_accounts?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'facebook_accounts?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_accounts] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'facebook_accounts?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'facebook_accounts?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'facebook_accounts?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_accounts] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.image_url"
                        , "xml_table.profile_url"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "image_url" STRING PATH 'image_url', "profile_url" STRING PATH 'profile_url', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                PageNum = 1 ;
                page_limit_exceeded = true ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_accounts] Totalrecords from get_list_facebook_accounts are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_accounts] Totalrecords from get_list_facebook_accounts are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,661	2015-08-10 15:23:39		desk_com_connector.get_list_facebook_feeds	CREATE virtual procedure desk_com_connector.get_list_facebook_feeds ( IN in_since_id integer ) RETURNS ( "id" integer, "image_url" string, "profile_url" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'facebook_feeds?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "image_url" string, "profile_url" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'facebook_feeds?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'facebook_feeds?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_feeds] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'facebook_feeds?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'facebook_feeds?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'facebook_feeds?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_feeds] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.image_url"
                        , "xml_table.profile_url"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "image_url" STRING PATH 'image_url', "profile_url" STRING PATH 'profile_url', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            begin
                PageNum = 1 ;
                page_limit_exceeded = true ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_feeds] Totalrecords from get_list_facebook_feeds are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_feeds] Totalrecords from get_list_facebook_feeds are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,662	2015-08-10 15:23:40		desk_com_connector.get_list_facebook_users	CREATE virtual procedure desk_com_connector.get_list_facebook_users ( IN in_since_id integer ) RETURNS ( "id" integer, "image_url" string, "profile_url" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'facebook_users?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "image_url" string, "profile_url" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'facebook_users?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'facebook_users?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_users] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'facebook_users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'facebook_users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'facebook_users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_users] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.image_url"
                        , "xml_table.profile_url"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "image_url" STRING PATH 'image_url', "profile_url" STRING PATH 'profile_url', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            begin
                PageNum = 1 ;
                page_limit_exceeded = true ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_users] Totalrecords from get_list_facebook_users are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_facebook_users] Totalrecords from get_list_facebook_users are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,663	2015-08-10 15:23:40		desk_com_connector.get_list_filter_cases	CREATE virtual procedure desk_com_connector.get_list_filter_cases ( in in_filter_id string, IN in_since_id integer, IN dwh_table string ) RETURNS ( "id" integer, "external_id" string, "blurb" string, "priority" string, "locked_until" string, "label_ids" string, "active_at" timestamp, "changed_at" timestamp, "created_at" timestamp, "updated_at" timestamp, "first_opened_at" timestamp, "opened_at" timestamp, "first_resolved_at" timestamp, "status" string, "active_notes_count" string, "active_attachments_count" string, "has_pending_interactions" string, "has_failed_interactions" string, "resolved_at" timestamp, "description" string, "language" string, "received_at" timestamp, "type" string, "labels" string, "subject" string, "custom_fields" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_filter_id is null )
    or ( in_filter_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'filters/' || in_filter_id || '/cases?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "external_id" string, "blurb" string, "priority" string, "locked_until" string, "label_ids" string, "active_at" timestamp, "changed_at" timestamp, "created_at" timestamp, "updated_at" timestamp, "first_opened_at" timestamp, "opened_at" timestamp, "first_resolved_at" timestamp, "status" string, "active_notes_count" string, "active_attachments_count" string, "has_pending_interactions" string, "has_failed_interactions" string, "resolved_at" timestamp, "description" string, "language" string, "received_at" timestamp, "type" string, "labels" string, "subject" string, "custom_fields" string, "total_entries" string, "page" string ) ;
    DECLARE string VARIABLES.dwh_schema = ( select
            nameindv
        from
            ( exec getCurrentDWH ( ) ) a ) ;
    DECLARE string VARIABLES.vdb_name = 'datavirtuality' ;
    DECLARE string VARIABLES.deltatable = LCASE ( replace ( dwh_table, '"', '' ) || 'delta' ) ;
    DECLARE string VARIABLES.locktable = LCASE ( replace ( dwh_table, '"', '' ) || 'lock' ) ;
    CREATE LOCAL TEMPORARY TABLE TabTmpCount ( c long ) ;
    IF ( VARIABLES.dwh_schema IS NULL )
    BEGIN
        ERROR 'DWH schema name cannot be NULL' ;
    END
    IF ( EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( VARIABLES.locktable ) ) )
    BEGIN
        ERROR 'Another "get_list_filter_cases" incremental update is already running on the provided DWH table. Please, wait until the concurrent update is completed. If the server has been suddenly shut down when a batch udpate was running or an unexpected error occurred during a previous batch execution, it is possible that the lock table has not been correctly dropped. Only in this case, please manually delete the lock table from the DV Server running the command DROP TABLE ' || VARIABLES.locktable ;
    END
    EXECUTE IMMEDIATE 'CREATE TABLE ' || VARIABLES.locktable || '(a integer)' WITHOUT RETURN ;
    IF ( NOT EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( replace ( dwh_table, '"', '' ) ) ) )
    BEGIN
        EXECUTE IMMEDIATE 'SELECT * INTO ' || dwh_table || ' FROM  tmpTable LIMIT 0' WITHOUT RETURN ;
    END
    IF ( EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( VARIABLES.deltatable ) ) )
    BEGIN
        EXECUTE IMMEDIATE 'DROP TABLE ' || deltatable WITHOUT RETURN ;
    END
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'filters/' || in_filter_id || '/cases?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&in_since_id=' || in_since_id ;
        endpointstring = 'filters/' || in_filter_id || '/cases?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
        totalrecords = SELECT
                "xml_table.total_entries"
            FROM
                ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_filter_cases] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = '' ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'filters/' || in_filter_id || '/cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'filters/' || in_filter_id || '/cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'filters/' || in_filter_id || '/cases?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_filter_cases] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.external_id"
                        , substring ( replace ( "xml_table.blurb", unescape ( '\0' ), '' ), 1, 4000 ) as "blurb"
                        , "xml_table.priority"
                        , "xml_table.locked_until"
                        , "xml_table.label_ids"
                        , parsetimestamp ( NULLIF ( "xml_table.active_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "active_at"
                        , parsetimestamp ( NULLIF ( "xml_table.changed_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "changed_at"
                        , parsetimestamp ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , parsetimestamp ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , parsetimestamp ( NULLIF ( "xml_table.first_opened_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "first_opened_at"
                        , parsetimestamp ( NULLIF ( "xml_table.opened_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "opened_at"
                        , parsetimestamp ( NULLIF ( "xml_table.first_resolved_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "first_resolved_at"
                        , "xml_table.status"
                        , "xml_table.active_notes_count"
                        , "xml_table.active_attachments_count"
                        , "xml_table.has_pending_interactions"
                        , "xml_table.has_failed_interactions"
                        , parsetimestamp ( NULLIF ( "xml_table.resolved_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "resolved_at"
                        , "xml_table.description"
                        , "xml_table.language"
                        , parsetimestamp ( NULLIF ( "xml_table.received_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "received_at"
                        , "xml_table.type"
                        , "xml_table.labels"
                        , substring ( "xml_table.subject", 1, 4000 ) as "subject"
                        , "xml_table.custom_fields"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "external_id" STRING PATH 'external_id', "blurb" STRING PATH 'blurb', "priority" STRING PATH 'priority', "locked_until" STRING PATH 'locked_until', "label_ids" STRING PATH 'label_ids', "active_at" STRING PATH 'active_at', "changed_at" STRING PATH 'changed_at', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "first_opened_at" STRING PATH 'first_opened_at', "opened_at" STRING PATH 'opened_at', "first_resolved_at" STRING PATH 'first_resolved_at', "status" STRING PATH 'status', "active_notes_count" STRING PATH 'active_notes_count', "active_attachments_count" STRING PATH 'active_attachments_count', "has_pending_interactions" STRING PATH 'has_pending_interactions', "has_failed_interactions" STRING PATH 'has_failed_interactions', "resolved_at" STRING PATH 'resolved_at', "description" STRING PATH 'description', "language" STRING PATH 'language', "received_at" STRING PATH 'received_at', "type" STRING PATH 'type', "labels" STRING PATH 'labels', "subject" STRING PATH 'subject', "custom_fields" STRING PATH 'custom_fields', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            EXECUTE IMMEDIATE 'SELECT * INTO ' || VARIABLES.deltatable || ' FROM tmpTable' WITHOUT RETURN ;
            DELETE
                FROM
                    tmpTable ;
            EXECUTE IMMEDIATE 'DELETE FROM ' || dwh_table || '  WHERE id IN (SELECT id as a FROM ' || VARIABLES.deltatable || ')' WITHOUT RETURN ;
            EXECUTE IMMEDIATE 'INSERT INTO ' || dwh_table || ' SELECT * FROM ' || deltatable WITHOUT RETURN ;
            EXECUTE IMMEDIATE 'DROP TABLE ' || deltatable WITHOUT RETURN ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM ' || dwh_table WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            DELETE
                FROM
                    TabTmpCount ;
            EXECUTE IMMEDIATE 'INSERT INTO TabTmpCount SELECT count(*) FROM ' || dwh_table WITHOUT RETURN ;
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_filter_cases] Totalrecords from get_list_filter_cases are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                DELETE
                    FROM
                        TabTmpCount ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpCount SELECT count(*) FROM ' || dwh_table WITHOUT RETURN ;
                records_processed = select
                        c
                    from
                        TabTmpCount ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_filter_cases] Totalrecords from get_list_filter_cases are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
    end
    EXECUTE IMMEDIATE 'DROP TABLE ' || VARIABLES.locktable WITHOUT RETURN ;
    execute immediate 'select * from ' || dwh_table as "id" integer
    , "external_id" string
    , "blurb" string
    , "priority" string
    , "locked_until" string
    , "label_ids" string
    , "active_at" timestamp
    , "changed_at" timestamp
    , "created_at" timestamp
    , "updated_at" timestamp
    , "first_opened_at" timestamp
    , "opened_at" timestamp
    , "first_resolved_at" timestamp
    , "status" string
    , "active_notes_count" string
    , "active_attachments_count" string
    , "has_pending_interactions" string
    , "has_failed_interactions" string
    , "resolved_at" timestamp
    , "description" string
    , "language" string
    , "received_at" timestamp
    , "type" string
    , "labels" string
    , "subject" string
    , "custom_fields" string
    , "total_entries" string
    , "page" string ;
end	READY
196,664	2015-08-10 15:23:41		desk_com_connector.get_list_integration_urls	CREATE virtual procedure desk_com_connector.get_list_integration_urls ( IN in_since_id integer ) RETURNS ( "id" integer, "name" string, "rendered" string, "created_at" timestamp, "updated_at" timestamp, "description" string, "enabled" string, "markup" string, "open_location" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'integration_urls?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "rendered" string, "created_at" timestamp, "updated_at" timestamp, "description" string, "enabled" string, "markup" string, "open_location" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'integration_urls?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'integration_urls?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_integration_urls] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'integration_urls?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'integration_urls?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'integration_urls?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_integration_urls] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.rendered"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.description"
                        , "xml_table.enabled"
                        , "xml_table.markup"
                        , "xml_table.open_location"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "name" STRING PATH 'name', "rendered" STRING PATH 'rendered', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "description" STRING PATH 'description', "enabled" STRING PATH 'enabled', "markup" STRING PATH 'markup', "open_location" STRING PATH 'open_location', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_integration_urls] Totalrecords from get_list_integration_urls are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_integration_urls] Totalrecords from get_list_integration_urls are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,665	2015-08-10 15:23:41		desk_com_connector.get_list_jobs	CREATE virtual procedure desk_com_connector.get_list_jobs ( IN in_since_id integer ) RETURNS ( "id" integer, "type" string, "status_message" string, "progress" string, "created_at" timestamp, "completed_at" timestamp, "last_error" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'jobs?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "type" string, "status_message" string, "progress" string, "created_at" timestamp, "completed_at" timestamp, "last_error" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'jobs?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'jobs?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_jobs] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'jobs?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'jobs?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'jobs?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_jobs] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.type"
                        , "xml_table.status_message"
                        , "xml_table.progress"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.completed_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "completed_at"
                        , "xml_table.last_error"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "type" STRING PATH 'type', "status_message" STRING PATH 'status_message', "progress" STRING PATH 'progress', "created_at" STRING PATH 'created_at', "completed_at" STRING PATH 'completed_at', "last_error" STRING PATH 'last_error', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_jobs] Totalrecords from get_list_jobs are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_jobs] Totalrecords from get_list_jobs are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,666	2015-08-10 15:23:42		desk_com_connector.get_list_macros_actions	CREATE virtual procedure desk_com_connector.get_list_macros_actions ( IN in_since_id integer, in in_macros_id string ) RETURNS ( "id" integer, "type" string, "value" string, "created_at" timestamp, "updated_at" timestamp, "enabled" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_macros_id is null )
    or ( in_macros_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'macros/' || in_macros_id || '/actions?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "type" string, "value" string, "created_at" timestamp, "updated_at" timestamp, "enabled" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'macros/' || in_macros_id || '/actions?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'macros/' || in_macros_id || '/actions?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_macros_actions] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'macros/' || in_macros_id || '/actions?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'macros/' || in_macros_id || '/actions?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'macros/' || in_macros_id || '/actions?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_macros_actions] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.type"
                        , "xml_table.value"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.enabled"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "type" STRING PATH 'type', "value" STRING PATH 'value', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "enabled" STRING PATH 'enabled', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_macros_actions] Totalrecords from get_list_macros_actions are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_macros_actions] Totalrecords from get_list_macros_actions are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,671	2015-08-10 15:23:44		desk_com_connector.get_list_topics_translations	CREATE virtual procedure desk_com_connector.get_list_topics_translations ( IN in_since_id integer, in in_topic_id string ) RETURNS ( "id" integer, "name" string, "locale" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_topic_id is null )
    or ( in_topic_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'topics/' || in_topic_id || '/translations?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "locale" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'topics/' || in_topic_id || '/translations?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'topics/' || in_topic_id || '/translations?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics_translations] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'topics/' || in_topic_id || '/translations?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'topics/' || in_topic_id || '/translations?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'topics/' || in_topic_id || '/translations?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics_translations] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.locale"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "name" STRING PATH 'name', "locale" STRING PATH 'locale', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics_translations] Totalrecords from get_list_topics_translations are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics_translations] Totalrecords from get_list_topics_translations are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,673	2015-08-10 15:23:45		desk_com_connector.get_list_twitter_accounts	CREATE virtual procedure desk_com_connector.get_list_twitter_accounts ( IN in_since_id integer ) RETURNS ( "id" integer, "handle" string, "name" string, "profile_image" string, "active" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare long unixtimestamp = 0 ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'twitter_accounts?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "handle" string, "name" string, "profile_image" string, "active" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'twitter_accounts?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'twitter_accounts?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_twitter_accounts] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'twitter_accounts?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'twitter_accounts?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'twitter_accounts?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_twitter_accounts] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.handle"
                        , "xml_table.name"
                        , "xml_table.profile_image"
                        , "xml_table.active"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "handle" STRING PATH 'handle', "name" STRING PATH 'name', "profile_image" STRING PATH 'profile_image', "active" STRING PATH 'active', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_twitter_accounts] Totalrecords from get_list_twitter_accounts are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_twitter_accounts] Totalrecords from get_list_twitter_accounts are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,674	2015-08-10 15:23:45		desk_com_connector.get_list_twitter_users	CREATE virtual procedure desk_com_connector.get_list_twitter_users ( IN in_since_id integer ) RETURNS ( "id" integer, "followers_count" string, "verified" string, "created_at" timestamp, "updated_at" timestamp, "handle" string, "image_url" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'twitter_users?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "followers_count" string, "verified" string, "created_at" timestamp, "updated_at" timestamp, "handle" string, "image_url" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'twitter_users?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'twitter_users?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_twitter_users] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'twitter_users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'twitter_users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'twitter_users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_twitter_users] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.followers_count"
                        , "xml_table.verified"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.handle"
                        , "xml_table.image_url"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "followers_count" STRING PATH 'followers_count', "verified" STRING PATH 'verified', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "handle" STRING PATH 'handle', "image_url" STRING PATH 'image_url', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_customers] Totalrecords from get_list_customers are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_customers] Totalrecords from get_list_customers are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,675	2015-08-10 15:23:46		desk_com_connector.get_list_users	CREATE virtual procedure desk_com_connector.get_list_users ( IN in_since_id integer ) RETURNS ( "id" integer, "name" string, "email" string, "created_at" timestamp, "updated_at" timestamp, "current_login_at" timestamp, "last_login_at" timestamp, "level" string, "email_verified" string, "public_name" string, "avatar" string, "available" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 1000 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'users?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "email" string, "created_at" timestamp, "updated_at" timestamp, "current_login_at" timestamp, "last_login_at" timestamp, "level" string, "email_verified" string, "public_name" string, "avatar" string, "available" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'users?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'users?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.email"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.current_login_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "current_login_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.last_login_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "last_login_at"
                        , "xml_table.level"
                        , "xml_table.email_verified"
                        , "xml_table.public_name"
                        , "xml_table.avatar"
                        , "xml_table.available"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "name" STRING PATH 'name', "email" STRING PATH 'email', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "current_login_at" STRING PATH 'current_login_at', "last_login_at" STRING PATH 'last_login_at', "level" STRING PATH 'level', "email_verified" STRING PATH 'email_verified', "public_name" STRING PATH 'public_name', "avatar" STRING PATH 'avatar', "available" STRING PATH 'available', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users] Totalrecords from get_list_users are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users] Totalrecords from get_list_users are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,676	2015-08-10 15:23:46		desk_com_connector.get_list_user_searches	CREATE virtual procedure desk_com_connector.get_list_user_searches ( IN in_since_id integer, in in_user_id string ) RETURNS ( "id" integer, "name" string, "query" string, "created_at" timestamp, "updated_at" timestamp, "search_object" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_user_id is null )
    or ( in_user_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'users/' || in_user_id || '/searches?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "query" string, "created_at" timestamp, "updated_at" timestamp, "search_object" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'users/' || in_user_id || '/searches?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'users/' || in_user_id || '/searches?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_user_searches] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'users/' || in_user_id || '/searches?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'users/' || in_user_id || '/searches?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'users/' || in_user_id || '/searches?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_user_searches] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.query"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.search_object"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'users/' || in_user_id || '/searches' ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "name" STRING PATH 'name', "query" STRING PATH 'query', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "search_object" STRING PATH 'search_object', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_user_searches] Totalrecords from get_list_user_searches are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_user_searches] Totalrecords from get_list_user_searches are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,677	2015-08-10 15:23:47		desk_com_connector.get_list_users_mobile_devices	CREATE virtual procedure desk_com_connector.get_list_users_mobile_devices ( IN in_since_id integer, in in_user_id string ) RETURNS ( "id" integer, "device_token" string, "type" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_user_id is null )
    or ( in_user_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'users/' || in_user_id || '/mobile_devices?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "device_token" string, "type" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'users/' || in_user_id || '/mobile_devices?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'users/' || in_user_id || '/mobile_devices?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_mobile_devices] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'users/' || in_user_id || '/mobile_devices?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'users/' || in_user_id || '/mobile_devices?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'users/' || in_user_id || '/mobile_devices?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_mobile_devices] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.device_token"
                        , "xml_table.type"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "device_token" STRING PATH 'device_token', "type" STRING PATH 'type', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_mobile_devices] Totalrecords from get_list_users_mobile_devices are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_mobile_devices] Totalrecords from get_list_users_mobile_devices are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,678	2015-08-10 15:23:47		desk_com_connector.get_list_group_users	CREATE virtual procedure desk_com_connector.get_list_group_users ( IN in_since_id integer, in in_group_id string ) RETURNS ( "id" integer, "name" string, "email" string, "created_at" timestamp, "updated_at" timestamp, "current_login_at" timestamp, "last_login_at" timestamp, "level" string, "email_verified" string, "public_name" string, "avatar" string, "available" string, "total_entries" string, "page" string, "preferences_href" string, "searches_href" string, "groups_href" string, "macros_href" string, "filters_href" string, "integration_href" string, "cases_href" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_group_id is null )
    or ( in_group_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 1000 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'groups/' || in_group_id || '/users?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "email" string, "created_at" timestamp, "updated_at" timestamp, "current_login_at" timestamp, "last_login_at" timestamp, "level" string, "email_verified" string, "public_name" string, "avatar" string, "available" string, "total_entries" string, "page" string, "preferences_href" string, "searches_href" string, "groups_href" string, "macros_href" string, "filters_href" string, "integration_href" string, "cases_href" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'groups/' || in_group_id || '/users?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'groups/' || in_group_id || '/users?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_users] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'groups/' || in_group_id || '/users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'groups/' || in_group_id || '/users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'groups/' || in_group_id || '/users?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_users] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.email"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.current_login_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "current_login_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.last_login_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "last_login_at"
                        , "xml_table.level"
                        , "xml_table.email_verified"
                        , "xml_table.public_name"
                        , "xml_table.avatar"
                        , "xml_table.available"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                        , "xml_table.preferences_href"
                        , "xml_table.searches_href"
                        , "xml_table.groups_href"
                        , "xml_table.macros_href"
                        , "xml_table.filters_href"
                        , "xml_table.integration_href"
                        , "xml_table.cases_href"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "name" STRING PATH 'name', "email" STRING PATH 'email', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "current_login_at" STRING PATH 'current_login_at', "last_login_at" STRING PATH 'last_login_at', "level" STRING PATH 'level', "email_verified" STRING PATH 'email_verified', "public_name" STRING PATH 'public_name', "avatar" STRING PATH 'avatar', "available" STRING PATH 'available', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page', "preferences_href" STRING PATH '_links/preferences/href', "searches_href" STRING PATH '_links/searches/href', "groups_href" STRING PATH '_links/groups/href', "macros_href" STRING PATH '_links/macros/href', "filters_href" STRING PATH '_links/filters/href', "integration_href" STRING PATH '_links/integration_urls/href', "cases_href" STRING PATH '_links/case_layout/href' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_users] Totalrecords from get_list_group_users are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_users] Totalrecords from get_list_group_users are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,679	2015-08-10 15:23:48		desk_com_connector.get_list_brands	CREATE virtual procedure desk_com_connector.get_list_brands ( IN in_since_id integer ) RETURNS ( "id" integer, "total_entries" string, "page" string, "name" string, "created_at" timestamp, "updated_at" timestamp ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'brands?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "total_entries" string, "page" string, "name" string, "created_at" timestamp, "updated_at" timestamp ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'brands?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'brands?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brands] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'brands?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'brands?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'brands?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brands] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                        , "xml_table.name"
                        , PARSETIMESTAMP ( "xml_table.created_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( "xml_table.updated_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page', "name" STRING PATH 'name', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brands] Totalrecords from get_list_brands are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brands] Totalrecords are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,680	2015-08-10 15:23:48		desk_com_connector.get_list_case_notes	CREATE virtual procedure desk_com_connector.get_list_case_notes ( in in_case_id string, IN in_since_id integer ) RETURNS ( "id" integer, "body" string, "created_at" timestamp, "updated_at" timestamp, "erased_at" timestamp, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_case_id is null )
    or ( in_case_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'cases/' || in_case_id || '/notes?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "body" string, "created_at" timestamp, "updated_at" timestamp, "erased_at" timestamp, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'cases/' || in_case_id || '/notes?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'cases/' || in_case_id || '/notes?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_notes] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'cases/' || in_case_id || '/notes?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'cases/' || in_case_id || '/notes?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'cases/' || in_case_id || '/notes?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_notes] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , substring ( "xml_table.body", 1, 4000 ) as "body"
                        , PARSETIMESTAMP ( "xml_table.created_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( "xml_table.updated_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , PARSETIMESTAMP ( "xml_table.erased_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "erased_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "body" STRING PATH 'body', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "erased_at" STRING PATH 'erased_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_notes] Totalrecords from get_list_case_notes are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_case_notes] Totalrecords are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,681	2015-08-10 15:23:48		desk_com_connector.get_list_case_Facebook_Likes	CREATE virtual procedure desk_com_connector.get_list_case_Facebook_Likes (
    in in_case_id string
) RETURNS (
    "idColumn" integer
    ,"facebook_id" string
    ,"liked_by_page" string
    ,"like_count" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.facebook_id"
            ,"xml_table.liked_by_page"
            ,"xml_table.like_count"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'cases/' || in_case_id || '/message/likes'
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"facebook_id" STRING PATH 'facebook_id'
                ,"liked_by_page" STRING PATH 'liked_by_page'
                ,"like_count" STRING PATH 'like_count'
            ) "xml_table" ;
end	READY
196,682	2015-08-10 15:23:49		desk_com_connector.get_list_group_filters	CREATE virtual procedure desk_com_connector.get_list_group_filters ( in in_since_id integer, in in_group_id string ) RETURNS ( "name" string, "sort_field" string, "sort_direction" string, "position" string, "active" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_group_id is null )
    or ( in_group_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'groups/' || in_group_id || '/filters?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "name" string, "sort_field" string, "sort_direction" string, "position" string, "active" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'groups/' || in_group_id || '/filters?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'groups/' || in_group_id || '/filters?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_filters] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'groups/' || in_group_id || '/filters?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'groups/' || in_group_id || '/filters?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'groups/' || in_group_id || '/filters?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_filters] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.name"
                        , "xml_table.sort_field"
                        , "xml_table.sort_direction"
                        , "xml_table.position"
                        , "xml_table.active"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "name" STRING PATH 'name', "sort_field" STRING PATH 'sort_field', "sort_direction" STRING PATH 'sort_direction', "position" STRING PATH 'position', "active" STRING PATH 'active', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_filters] Totalrecords from get_list_group_filters are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_group_filters] Totalrecords from get_list_group_filters are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,683	2015-08-10 15:23:49		desk_com_connector.show_mailbox_outbound	CREATE virtual procedure desk_com_connector.show_mailbox_outbound (
    in in_mb_outbound_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"reply_to" string
    ,"hostname" string
    ,"last_error" string
    ,"created_at" string
    ,"updated_at" string
    ,"port" string
    ,"from_name" string
    ,"from_email" string
    ,"enabled" string
    ,"default" string
    ,"type" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.reply_to"
            ,"xml_table.hostname"
            ,"xml_table.last_error"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.port"
            ,"xml_table.from_name"
            ,"xml_table.from_email"
            ,"xml_table.enabled"
            ,"xml_table.default"
            ,"xml_table.type"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'mailboxes/outbound/' || in_mb_outbound_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"reply_to" STRING PATH 'reply_to'
                ,"hostname" STRING PATH 'hostname'
                ,"last_error" STRING PATH 'last_error'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"port" STRING PATH 'port'
                ,"from_name" STRING PATH 'from_name'
                ,"from_email" STRING PATH 'from_email'
                ,"enabled" STRING PATH 'enabled'
                ,"default" STRING PATH 'default'
                ,"type" STRING PATH 'type'
            ) "xml_table" ;
end	READY
196,684	2015-08-10 15:23:50		desk_com_connector.get_list_articles_attachments	CREATE virtual procedure desk_com_connector.get_list_articles_attachments ( in in_article_id string, IN in_since_id integer, IN dwh_table string ) RETURNS ( "id" integer, "file_name" string, "content_type" string, "url" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string, topic_id string, translations_href string, attachements_href string, attachments_count integer, created_by_user_id string, updated_by_user_id string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_article_id is null )
    or ( in_article_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare long unixtimestamp = 0 ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'articles/' || in_article_id || '/attachemnts?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE string VARIABLES.dwh_schema = ( select
            nameindv
        from
            ( exec getCurrentDWH ( ) ) a ) ;
    DECLARE string VARIABLES.vdb_name = 'datavirtuality' ;
    DECLARE string VARIABLES.deltatable = LCASE ( replace ( dwh_table, '"', '' ) || 'delta' ) ;
    DECLARE string VARIABLES.locktable = LCASE ( replace ( dwh_table, '"', '' ) || 'lock' ) ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE TabTmpCount ( c long ) ;
    IF ( VARIABLES.dwh_schema IS NULL )
    BEGIN
        ERROR 'DWH schema name cannot be NULL' ;
    END
    IF ( EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( VARIABLES.locktable ) ) )
    BEGIN
        ERROR 'Another "get_list_articles_attachments" incremental update is already running on the provided DWH table. Please, wait until the concurrent update is completed. If the server has been suddenly shut down when a batch udpate was running or an unexpected error occurred during a previous batch execution, it is possible that the lock table has not been correctly dropped. Only in this case, please manually delete the lock table from the DV Server running the command DROP TABLE ' || VARIABLES.locktable ;
    END
    EXECUTE IMMEDIATE 'CREATE TABLE ' || VARIABLES.locktable || '(a integer)' WITHOUT RETURN ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "file_name" string, "content_type" string, "url" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string, topic_id string, translations_href string, attachements_href string, attachments_count integer, created_by_user_id string, updated_by_user_id string ) ;
    IF ( NOT EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( replace ( dwh_table, '"', '' ) ) ) )
    BEGIN
        EXECUTE IMMEDIATE 'SELECT * INTO ' || dwh_table || ' FROM  tmpTable LIMIT 0' WITHOUT RETURN ;
    END
    IF ( EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( VARIABLES.deltatable ) ) )
    BEGIN
        EXECUTE IMMEDIATE 'DROP TABLE ' || deltatable WITHOUT RETURN ;
    END
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'articles/' || in_article_id || '/attachemnts?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'articles/' || in_article_id || '/attachemnts?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
        totalrecords = ( SELECT
                "xml_table.total_entries"
            FROM
                ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer )
        , 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO'
        , "context" => 'org.teiid.PROCESSOR'
        , "msg" => '[desk_com_connector.get_list_articles_attachments] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'articles/' || in_article_id || '/attachemnts?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since___id
                , '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'articles/' || in_article_id || '/attachemnts?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since___id
                    , '' ) ;
                end
                else
                begin
                    endpointstring = 'articles/' || in_article_id || '/attachemnts?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO'
            , "context" => 'org.teiid.PROCESSOR'
            , "msg" => '[desk_com_connector.get_list_articles_attachments] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.file_name"
                        , "xml_table.content_type"
                        , "xml_table.url"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                        , substring ( "xml_table.topic_id", 16 ) as topic_id
                        , "xml_table.translations_href"
                        , "xml_table.attachements_href"
                        , "xml_table.attachments_count"
                        , substring ( "xml_table.created_by_user_id", 15 ) as created_by_user_id
                        , substring ( "xml_table.updated_by_user_id", 15 ) as updated_by_user_id
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "file_name" STRING PATH 'file_name', "content_type" STRING PATH 'content_type', "url" STRING PATH 'url', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page', "topic_id" STRING PATH '_links/topic/href', "translations_href" STRING PATH '_links/translations/href', "attachements_href" STRING PATH '_links/attachments/href', "attachments_count" INTEGER PATH '_links/attachments/count', "created_by_user_id" STRING PATH '_links/created_by/href', "updated_by_user_id" STRING PATH '_links/updated_by/href' ) "xml_table" ;
            EXECUTE IMMEDIATE 'SELECT * INTO ' || VARIABLES.deltatable || ' FROM tmpTable' WITHOUT RETURN ;
            DELETE
                FROM
                    tmpTable ;
            /*----------------------------------------checking duplicates*/
            /*            EXECUTE IMMEDIATE 'DELETE FROM ' || dwh_table || '  WHERE id IN (SELECT id as a FROM ' || VARIABLES.deltatable || ')' WITHOUT RETURN ;*/
            /*----------------------------------------checking duplicates*/
            EXECUTE IMMEDIATE 'INSERT INTO ' || dwh_table || ' SELECT * FROM ' || deltatable WITHOUT RETURN ;
            EXECUTE IMMEDIATE 'DROP TABLE ' || deltatable WITHOUT RETURN ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM ' || dwh_table WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_articles_attachments] Totalrecords from get_list_articles_attachments are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                DELETE
                    FROM
                        TabTmpCount ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpCount SELECT count(*) FROM ' || dwh_table WITHOUT RETURN ;
                records_processed = select
                        c
                    from
                        TabTmpCount ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_articles_attachments] Totalrecords from get_list_articles_attachments are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
    end
    EXECUTE IMMEDIATE 'DROP TABLE ' || VARIABLES.locktable WITHOUT RETURN ;
    execute immediate 'select * from ' || dwh_table as "id" integer
    , "file_name" string
    , "content_type" string
    , "url" string
    , "created_at" timestamp
    , "updated_at" timestamp
    , "total_entries" string
    , "page" string
    , topic_id string
    , translations_href string
    , attachements_href string
    , attachments_count integer
    , created_by_user_id string
    , updated_by_user_id string ;
end	READY
196,685	2015-08-10 15:23:50		desk_com_connector.show_article_attachment	create virtual procedure desk_com_connector.show_article_attachment (
    in in_article_id string
    ,in in_attachment_id string
) RETURNS (
    "id" string
    ,"file_name" string
    ,"content_type" string
    ,"url" string
    ,"created_at" string
    ,"updated_at" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_article_id is null
        )
        or (
            in_article_id = ''
        )
        or (
            in_attachment_id is null
        )
        or (
            in_attachment_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'articles/' || in_article_id || '/attachemnts/' || in_attachment_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.file_name"
            ,"xml_table.content_type"
            ,"xml_table.url"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"file_name" STRING PATH 'file_name'
                ,"content_type" STRING PATH 'content_type'
                ,"url" STRING PATH 'url'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
            ) "xml_table" ;
end	READY
196,686	2015-08-10 15:23:51		desk_com_connector.show_brand	create virtual procedure desk_com_connector.show_brand (
    in in_brand_id string
) RETURNS (
    "id" string
    ,"total_entries" string
    ,"page" string
    ,"name" string
    ,"created_at" string
    ,"updated_at" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_brand_id is null
        )
        or (
            in_brand_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'brands/' || in_brand_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.total_entries"
            ,"xml_table.page"
            ,"xml_table.name"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"total_entries" STRING PATH '../../total_entries'
                ,"page" STRING PATH '../../page'
                ,"name" STRING PATH 'name'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
            ) "xml_table" ;
end	READY
196,687	2015-08-10 15:23:51		desk_com_connector.get_list_brand_articles	CREATE virtual procedure desk_com_connector.get_list_brand_articles ( in in_brand_id string, IN in_since_id integer ) RETURNS ( "id" integer, "subject" string, "body" string, "body_email" string, "body_email_auto" string, "body_chat" string, "body_chat_auto" string, "body_web_callback" string, "body_web_callback_auto" string, "body_twitter" string, "body_twitter_auto" string, "body_qna" string, "body_qna_auto" string, "body_phone" string, "body_phone_auto" string, "body_facebook" string, "body_facebook_auto" string, "rating" string, "rating_count" string, "rating_score" string, "position" string, "in_support_center" string, "quickcode" string, "internal_notes" string, "publish_at" string, "created_at" string, "updated_at" timestamp, "total_entries" string, "page" string, topic_id string, translations_href string, attachements_href string, attachments_count integer, brands_href string, created_by_user_id string, updated_by_user_id string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_brand_id is null )
    or ( in_brand_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'brands/' || in_brand_id || '/articles?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "subject" string, "body" string, "body_email" string, "body_email_auto" string, "body_chat" string, "body_chat_auto" string, "body_web_callback" string, "body_web_callback_auto" string, "body_twitter" string, "body_twitter_auto" string, "body_qna" string, "body_qna_auto" string, "body_phone" string, "body_phone_auto" string, "body_facebook" string, "body_facebook_auto" string, "rating" string, "rating_count" string, "rating_score" string, "position" string, "in_support_center" string, "quickcode" string, "internal_notes" string, "publish_at" string, "created_at" string, "updated_at" timestamp, "total_entries" string, "page" string, topic_id string, translations_href string, attachements_href string, attachments_count integer, brands_href string, created_by_user_id string, updated_by_user_id string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'brands/' || in_brand_id || '/articles?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'brands/' || in_brand_id || '/articles?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brand_articles] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'brands/' || in_brand_id || '/articles?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'brands/' || in_brand_id || '/articles?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'brands/' || in_brand_id || '/articles?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brand_articles] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , substring ( "xml_table.subject", 1, 4000 ) as subject
                        , substring ( "xml_table.body", 1, 4000 ) as body
                        , "xml_table.body_email"
                        , "xml_table.body_email_auto"
                        , "xml_table.body_chat"
                        , "xml_table.body_chat_auto"
                        , "xml_table.body_web_callback"
                        , "xml_table.body_web_callback_auto"
                        , "xml_table.body_twitter"
                        , "xml_table.body_twitter_auto"
                        , "xml_table.body_qna"
                        , "xml_table.body_qna_auto"
                        , "xml_table.body_phone"
                        , "xml_table.body_phone_auto"
                        , "xml_table.body_facebook"
                        , "xml_table.body_facebook_auto"
                        , "xml_table.rating"
                        , "xml_table.rating_count"
                        , "xml_table.rating_score"
                        , "xml_table.position"
                        , "xml_table.in_support_center"
                        , "xml_table.quickcode"
                        , "xml_table.internal_notes"
                        , PARSETIMESTAMP ( "xml_table.publish_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "publish_at"
                        , PARSETIMESTAMP ( "xml_table.created_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( "xml_table.updated_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                        , substring ( "xml_table.topic_id", 16 ) as topic_id
                        , "xml_table.translations_href"
                        , "xml_table.attachements_href"
                        , "xml_table.attachments_count"
                        , "xml_table.brands_href"
                        , substring ( "xml_table.created_by_user_id", 15 ) as created_by_user_id
                        , substring ( "xml_table.updated_by_user_id", 15 ) as updated_by_user_id
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "subject" STRING PATH 'subject', "body" STRING PATH 'body', "body_email" STRING PATH 'body_email', "body_email_auto" STRING PATH 'body_email_auto', "body_chat" STRING PATH 'body_chat', "body_chat_auto" STRING PATH 'body_chat_auto', "body_web_callback" STRING PATH 'body_web_callback', "body_web_callback_auto" STRING PATH 'body_web_callback_auto', "body_twitter" STRING PATH 'body_twitter', "body_twitter_auto" STRING PATH 'body_twitter_auto', "body_qna" STRING PATH 'body_qna', "body_qna_auto" STRING PATH 'body_qna_auto', "body_phone" STRING PATH 'body_phone', "body_phone_auto" STRING PATH 'body_phone_auto', "body_facebook" STRING PATH 'body_facebook', "body_facebook_auto" STRING PATH 'body_facebook_auto', "rating" STRING PATH 'rating', "rating_count" STRING PATH 'rating_count', "rating_score" STRING PATH 'rating_score', "position" STRING PATH 'position', "in_support_center" STRING PATH 'in_support_center', "quickcode" STRING PATH 'quickcode', "internal_notes" STRING PATH 'internal_notes', "publish_at" STRING PATH 'publish_at', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page', "topic_id" STRING PATH '_links/topic/href', "translations_href" STRING PATH '_links/translations/href', "attachements_href" STRING PATH '_links/attachments/href', "attachments_count" INTEGER PATH '_links/attachments/count', "brands_href" STRING PATH '_links/brands/href', "created_by_user_id" STRING PATH '_links/created_by/href', "updated_by_user_id" STRING PATH '_links/updated_by/href' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brand_articles] Totalrecords from get_list_brand_articles are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brand_articles] Totalrecords are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,688	2015-08-10 15:23:52		desk_com_connector.get_list_brand_topics	CREATE virtual procedure desk_com_connector.get_list_brand_topics ( in in_brand_id string, IN in_since_id integer ) RETURNS ( "id" integer, "name" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_brand_id is null )
    or ( in_brand_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'brands/' || in_brand_id || '/topics?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "name" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'brands/' || in_brand_id || '/topics?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'brands/' || in_brand_id || '/topics?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brand_topics] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                endpointstring = 'brands/' || in_brand_id || '/topics?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'brands/' || in_brand_id || '/topics?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'brands/' || in_brand_id || '/topics?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brand_topics] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , PARSETIMESTAMP ( "xml_table.created_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( "xml_table.updated_at", 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "name" STRING PATH 'name', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            end
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brand_topics] Totalrecords from get_list_brand_topics are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tbltmp ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_brand_topics] Totalrecords are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,689	2015-08-10 15:23:52		desk_com_connector.show_case_reply	CREATE virtual procedure desk_com_connector.show_case_reply (
    in in_case_id string
    ,in in_reply_id string
) RETURNS (
    "idColumn" integer
    ,"id" string
    ,"created_at" string
    ,"updated_at" string
    ,"erased_at" string
    ,"hidden_by" string
    ,"hidden_at" string
    ,"sent_at" string
    ,"body" string
    ,"from" string
    ,"to" string
    ,"cc" string
    ,"bcc" string
    ,"client_type" string
    ,"direction" string
    ,"status" string
    ,"subject" string
    ,"hidden" string
    ,"total_entries" string
    ,"page" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_case_id is null
        )
        or (
            in_case_id = ''
        )
        or (
            in_reply_id is null
        )
        or (
            in_reply_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.id"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.erased_at"
            ,"xml_table.hidden_by"
            ,"xml_table.hidden_at"
            ,"xml_table.sent_at"
            ,"xml_table.body"
            ,"xml_table.from"
            ,"xml_table.to"
            ,"xml_table.cc"
            ,"xml_table.bcc"
            ,"xml_table.client_type"
            ,"xml_table.direction"
            ,"xml_table.status"
            ,"xml_table.subject"
            ,"xml_table.hidden"
            ,"xml_table.total_entries"
            ,"xml_table.page"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'cases/' || in_case_id || '/replies/' || in_reply_id
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"id" STRING PATH 'id'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"erased_at" STRING PATH 'erased_at'
                ,"hidden_by" STRING PATH 'hidden_by'
                ,"hidden_at" STRING PATH 'hidden_at'
                ,"sent_at" STRING PATH 'sent_at'
                ,"body" STRING PATH 'body'
                ,"from" STRING PATH 'from'
                ,"to" STRING PATH 'to'
                ,"cc" STRING PATH 'cc'
                ,"bcc" STRING PATH 'bcc'
                ,"client_type" STRING PATH 'client_type'
                ,"direction" STRING PATH 'direction'
                ,"status" STRING PATH 'status'
                ,"subject" STRING PATH 'subject'
                ,"hidden" STRING PATH 'hidden'
                ,"total_entries" STRING PATH '../../total_entries'
                ,"page" STRING PATH '../../page'
            ) "xml_table" ;
end	READY
196,693	2015-08-10 15:23:53		desk_com_connector.show_company	CREATE virtual procedure desk_com_connector.show_company (
    in in_company_id string
) RETURNS (
    "id" string
    ,"name" string
    ,"created_at" string
    ,"updated_at" string
    ,"domains" string
    ,"custom_fields" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_company_id is null
        )
        or (
            in_company_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'companies/' || in_company_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.name"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
            ,"xml_table.domains"
            ,"xml_table.custom_fields"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"name" STRING PATH 'name'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
                ,"domains" STRING PATH 'string-join(domains/text(),'', '')'
                ,"custom_fields" STRING PATH 'custom_fields'
            ) "xml_table" ;
end	READY
196,694	2015-08-10 15:23:54		desk_com_connector.show_facebook_feed	create virtual procedure desk_com_connector.show_facebook_feed (
    in in_fb_feed_id string
) RETURNS (
    "id" string
    ,"image_url" string
    ,"profile_url" string
    ,"created_at" string
    ,"updated_at" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_fb_feed_id is null
        )
        or (
            in_fb_feed_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'facebook_feeds/' || in_fb_feed_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.image_url"
            ,"xml_table.profile_url"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"image_url" STRING PATH 'image_url'
                ,"profile_url" STRING PATH 'profile_url'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
            ) "xml_table" ;
end	READY
196,692	2015-08-10 15:23:53		desk_com_connector.get_list_cases_facebook_likes	create virtual procedure desk_com_connector.get_list_cases_facebook_likes (
    in in_case_id string
) RETURNS (
    "idColumn" integer
    ,"facebook_id" string
    ,"liked_by_page" string
    ,"like_count" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    declare string endpointstring = 'cases/' || in_case_id || '/message/likes' ;
    if (
        (
            in_case_id is null
        )
        or (
            in_case_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.facebook_id"
            ,"xml_table.liked_by_page"
            ,"xml_table.like_count"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"facebook_id" STRING PATH 'facebook_id'
                ,"liked_by_page" STRING PATH 'liked_by_page'
                ,"like_count" STRING PATH 'like_count'
            ) "xml_table" ;
end	READY
196,695	2015-08-10 15:23:54		desk_com_connector.show_facebook_account	create virtual procedure desk_com_connector.show_facebook_account (
    in in_fb_account_id string
) RETURNS (
    "id" string
    ,"image_url" string
    ,"profile_url" string
    ,"created_at" string
    ,"updated_at" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_fb_account_id is null
        )
        or (
            in_fb_account_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'facebook_accounts/' || in_fb_account_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.image_url"
            ,"xml_table.profile_url"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"image_url" STRING PATH 'image_url'
                ,"profile_url" STRING PATH 'profile_url'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
            ) "xml_table" ;
end	READY
196,696	2015-08-10 15:23:55		desk_com_connector.show_facebook_user	create virtual procedure desk_com_connector.show_facebook_user (
    in in_fb_user_id string
) RETURNS (
    "id" string
    ,"image_url" string
    ,"profile_url" string
    ,"created_at" string
    ,"updated_at" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_fb_user_id is null
        )
        or (
            in_fb_user_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'facebook_users/' || in_fb_user_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.image_url"
            ,"xml_table.profile_url"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"image_url" STRING PATH 'image_url'
                ,"profile_url" STRING PATH 'profile_url'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
            ) "xml_table" ;
end	READY
196,697	2015-08-10 15:23:55		desk_com_connector.get_list_feedbacks	CREATE virtual procedure desk_com_connector.get_list_feedbacks ( IN in_since_id integer ) RETURNS ( "id" integer, "rating" string, "rating_type" string, "additional_feedback" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'feedbacks?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "rating" string, "rating_type" string, "additional_feedback" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'feedbacks?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'feedbacks?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_feedbacks] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'feedbacks?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'feedbacks?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'feedbacks?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_feedbacks] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.rating"
                        , "xml_table.rating_type"
                        , "xml_table.additional_feedback"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" INTEGER PATH 'id', "rating" STRING PATH 'rating', "rating_type" STRING PATH 'rating_type', "additional_feedback" STRING PATH 'additional_feedback', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                PageNum = 1 ;
                page_limit_exceeded = true ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_feedbacks] Totalrecords from get_list_feedbacks are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_feedbacks] Totalrecords from get_list_feedbacks are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,698	2015-08-10 15:23:55		desk_com_connector.show_feedback	create virtual procedure desk_com_connector.show_feedback (
    in in_feedback_id string
) RETURNS (
    "id" string
    ,"rating" string
    ,"rating_type" string
    ,"additional_feedback" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_feedback_id is null
        )
        or (
            in_feedback_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'feedbacks/' || in_feedback_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.rating"
            ,"xml_table.rating_type"
            ,"xml_table.additional_feedback"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"rating" STRING PATH 'rating'
                ,"rating_type" STRING PATH 'rating_type'
                ,"additional_feedback" STRING PATH 'additional_feedback'
            ) "xml_table" ;
end	READY
196,699	2015-08-10 15:23:56		desk_com_connector.show_job	create virtual procedure desk_com_connector.show_job (
    in in_job_id string
) RETURNS (
    "id" string
    ,"type" string
    ,"status_message" string
    ,"progress" string
    ,"created_at" string
    ,"completed_at" string
    ,"last_error" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_job_id is null
        )
        or (
            in_job_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'jobs/' || in_job_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.type"
            ,"xml_table.status_message"
            ,"xml_table.progress"
            ,"xml_table.created_at"
            ,"xml_table.completed_at"
            ,"xml_table.last_error"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => 'jobs'
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"type" STRING PATH 'type'
                ,"status_message" STRING PATH 'status_message'
                ,"progress" STRING PATH 'progress'
                ,"created_at" STRING PATH 'created_at'
                ,"completed_at" STRING PATH 'completed_at'
                ,"last_error" STRING PATH 'last_error'
            ) "xml_table" ;
end	READY
196,700	2015-08-10 15:23:56		desk_com_connector.get_list_snippet_translations	CREATE virtual procedure desk_com_connector.get_list_snippet_translations ( IN in_since_id integer, in in_snippet_id string ) RETURNS ( "id" integer, "locale" string, "text" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_snippet_id is null )
    or ( in_snippet_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 100 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'snippets/' || in_snippet_id || '/translations?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tbltmp ( "id" integer, "locale" string, "text" string, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'snippets/' || in_snippet_id || '/translations?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'snippets/' || in_snippet_id || '/translations?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_snippet_translations] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'snippets/' || in_snippet_id || '/translations?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'snippets/' || in_snippet_id || '/translations?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'snippets/' || in_snippet_id || '/translations?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_snippet_translations] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tbltmp SELECT
                        "xml_table.id"
                        , "xml_table.locale"
                        , "xml_table.text"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "locale" STRING PATH 'locale', "text" STRING PATH 'text', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tbltmp;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            records_processed = SELECT
                    count ( * )
                FROM
                    tbltmp ;
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_snippet_translations] Totalrecords from get_list_snippet_translations are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            i = i + 1 ;
        end
        select
                *
            from
                tbltmp ;
    end
end	READY
196,701	2015-08-10 15:23:57		desk_com_connector.show_snippet_translations	create virtual procedure desk_com_connector.show_snippet_translations (
    in in_snippet_id string
    ,in in_locale string
) RETURNS (
    "id" string
    ,"locale" string
    ,"text" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_snippet_id is null
        )
        or (
            in_snippet_id = ''
        )
        or (
            in_locale is null
        )
        or (
            in_locale = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'snippets/' || in_snippet_id || '/translations/' || in_locale ;
    SELECT
            "xml_table.id"
            ,"xml_table.locale"
            ,"xml_table.text"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"locale" STRING PATH 'locale'
                ,"text" STRING PATH 'text'
            ) "xml_table" ;
end	READY
196,702	2015-08-10 15:23:57		desk_com_connector.show_system_message	create virtual procedure desk_com_connector.show_system_message (
) RETURNS (
    "message" string
    ,"updated_at" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    declare string endpointstring = 'system_message' ;
    SELECT
            "xml_table.message"
            ,"xml_table.updated_at"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "message" STRING PATH 'message'
                ,"updated_at" STRING PATH 'updated_at'
            ) "xml_table" ;
end	READY
196,703	2015-08-10 15:23:58		desk_com_connector.show_twitter_account	create virtual procedure desk_com_connector.show_twitter_account (
    in in_twit_acc_id string
) RETURNS (
    "id" string
    ,"handle" string
    ,"name" string
    ,"profile_image" string
    ,"active" string
    ,"created_at" string
    ,"updated_at" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_twit_acc_id is null
        )
        or (
            in_twit_acc_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'twitter_accounts/' || in_twit_acc_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.handle"
            ,"xml_table.name"
            ,"xml_table.profile_image"
            ,"xml_table.active"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"handle" STRING PATH 'handle'
                ,"name" STRING PATH 'name'
                ,"profile_image" STRING PATH 'profile_image'
                ,"active" STRING PATH 'active'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
            ) "xml_table" ;
end	READY
196,704	2015-08-10 15:23:58		desk_com_connector.show_twitter_account_tweet	create virtual procedure desk_com_connector.show_twitter_account_tweet (
    in in_twit_acc_id string
    ,in in_twit_id string
) RETURNS (
    "id" string
    ,"body" string
    ,"direction" string
    ,"type" string
    ,"status" string
    ,"to" string
    ,"from" string
    ,"created_at" string
    ,"updated_at" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_twit_acc_id is null
        )
        or (
            in_twit_acc_id = ''
        )
        or (
            in_twit_id is null
        )
        or (
            in_twit_id = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'twitter_accounts/' || in_twit_acc_id || '/tweets/' || in_twit_id ;
    SELECT
            "xml_table.id"
            ,"xml_table.body"
            ,"xml_table.direction"
            ,"xml_table.type"
            ,"xml_table.status"
            ,"xml_table.to"
            ,"xml_table.from"
            ,"xml_table.created_at"
            ,"xml_table.updated_at"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//entries' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "id" STRING PATH 'id'
                ,"body" STRING PATH 'body'
                ,"direction" STRING PATH 'direction'
                ,"type" STRING PATH 'type'
                ,"status" STRING PATH 'status'
                ,"to" STRING PATH 'to'
                ,"from" STRING PATH 'from'
                ,"created_at" STRING PATH 'created_at'
                ,"updated_at" STRING PATH 'updated_at'
            ) "xml_table" ;
end	READY
196,705	2015-08-10 15:23:59		desk_com_connector.show_twitter_account_follow	create virtual procedure desk_com_connector.show_twitter_account_follow (
    in in_twit_acc_id string
    ,in in_username string
) RETURNS (
    "idColumn" integer
    ,"handle" string
    ,"can_direct_message" string
) as
begin
    call "desk_com_connector.internal_validateServerVersion" (
    ) ;
    if (
        (
            in_twit_acc_id is null
        )
        or (
            in_twit_acc_id = ''
        )
        or (
            in_username is null
        )
        or (
            in_username = ''
        )
    ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare string endpointstring = 'twitter_accounts/' || in_twit_acc_id || '/follows/' || in_username ;
    SELECT
            "xml_table.idColumn"
            ,"xml_table.handle"
            ,"xml_table.can_direct_message"
        FROM
            (
                exec "desk_com_ws".invokeHTTP (
                    action => 'GET'
                    ,requestContentType => 'application/json'
                    ,endpoint => endpointstring
                )
            ) w
            ,XMLTABLE (
                XMLNAMESPACES (
                    'http://www.w3.org/2001/XMLSchema-instance' as "xsi"
                )
                ,'//root' PASSING JSONTOXML (
                    'root'
                    ,to_chars (
                        w.result
                        ,'UTF-8'
                    )
                ) COLUMNS "idColumn" FOR ORDINALITY
                ,"handle" STRING PATH 'handle'
                ,"can_direct_message" STRING PATH 'can_direct_message'
            ) "xml_table" ;
end	READY
196,706	2015-08-10 15:23:59		desk_com_connector.get_list_users_mobile_devices_settings	CREATE virtual procedure desk_com_connector.get_list_users_mobile_devices_settings ( IN in_since_id integer, in in_user_id string, in in_mobile_device_id string ) RETURNS ( "id" integer, "name" string, "value" string, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_user_id is null )
    or ( in_user_id = '' )
    or ( in_mobile_device_id is null )
    or ( in_mobile_device_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'users/' || in_user_id || '/mobile_devices/' || in_mobile_device_id || '/settings?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "name" string, "value" string, "total_entries" string, "page" string ) ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'users/' || in_user_id || '/mobile_devices/' || in_mobile_device_id || '/settings?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'users/' || in_user_id || '/mobile_devices/' || in_mobile_device_id || '/settings?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_mobile_devices_settings] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'users/' || in_user_id || '/mobile_devices/' || in_mobile_device_id || '/settings?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'users/' || in_user_id || '/mobile_devices/' || in_mobile_device_id || '/settings?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'users/' || in_user_id || '/mobile_devices/' || in_mobile_device_id || '/settings?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_mobile_devices_settings] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , "xml_table.name"
                        , "xml_table.value"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "name" STRING PATH 'name', "value" STRING PATH 'value', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            records_processed = SELECT
                    count ( * )
                FROM
                    tmpTable ;
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_users_mobile_devices_settings] Totalrecords from get_list_users_mobile_devices_settings are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            i = i + 1 ;
            PageNum = PageNum + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,707	2015-08-10 15:24:00		desk_com_connector.get_list_topics_brands	CREATE virtual procedure desk_com_connector.get_list_topics_brands ( IN in_since_id integer, in in_topic_id string ) RETURNS ( "name" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_topic_id is null )
    or ( in_topic_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string endpointstring = 'topics/' || in_topic_id || '/brands?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "name" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'topics/' || in_topic_id || '/brands?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'topics/' || in_topic_id || '/brands?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics_brands] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'topics/' || in_topic_id || '/brands?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'topics/' || in_topic_id || '/brands?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'topics/' || in_topic_id || '/brands?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics_brands] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.name"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "name" STRING PATH 'name', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics_brands] Totalrecords from get_list_topics_brands are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_topics_brands] Totalrecords from get_list_topics_brands are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,708	2015-08-10 15:24:00		desk_com_connector.get_list_twitter_accounts_tweets	CREATE virtual procedure desk_com_connector.get_list_twitter_accounts_tweets ( IN in_since_id integer, in in_twit_acc_id string ) RETURNS ( "id" integer, "body" string, "direction" string, "type" string, "status" string, "to" string, "from" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) as
begin
    call "desk_com_connector.internal_validateServerVersion" ( ) ;
    if ( ( in_twit_acc_id is null )
    or ( in_twit_acc_id = '' ) ) error '
    
    Please, set all parameters in procedure to NOT NULL.' ;
    declare integer PagesCountLimit = 501 ;
    declare integer PageNum = 1 ;
    declare long records_processed = 0 ;
    declare integer records_processed2 = 0 ;
    declare integer totalrecords ;
    declare integer totalrecords2 ;
    declare double pagescount ;
    declare double mod_val ;
    declare integer i = 1 ;
    declare integer querrycount ;
    declare integer CurrentPage = 1 ;
    declare integer PageSize = 50 ;
    declare boolean page_limit_exceeded = false ;
    declare string internal_since_id = 0 ;
    declare string internal_since___id = 0 ;
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMax ( c integer ) ;
    declare string endpointstring = 'twitter_accounts/' || in_twit_acc_id || '/tweets?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' ;
    CREATE LOCAL TEMPORARY TABLE tmpTable ( "id" integer, "body" string, "direction" string, "type" string, "status" string, "to" string, "from" string, "created_at" timestamp, "updated_at" timestamp, "total_entries" string, "page" string ) ;
    totalrecords = SELECT
            "xml_table.total_entries"
        FROM
            ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => 'twitter_accounts/' || in_twit_acc_id || '/tweets?sort_field=created_at&sort_direction=asc&since_id=' || internal_since___id ) ) w
            , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//root' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "total_entries" INTEGER PATH 'total_entries' ) "xml_table" ;
    IF ( in_since_id IS NOT NULL )
    BEGIN
        internal_since_id = '&since_id=' || in_since_id ;
        endpointstring = 'twitter_accounts/' || in_twit_acc_id || '/tweets?page=' || CurrentPage || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
    END
    else internal_since_id = '&since_id=' || 0 ;
    if ( totalrecords > 0 )
    begin
        pagescount = cast ( totalrecords as double ) / PageSize ;
        mod_val = pagescount - floor ( pagescount ) ;
        querrycount = round ( cast ( pagescount as integer ), 0 ) + 1 ;
        exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_twitter_accounts_tweets] Max Pages to get: ' || querrycount ) ;
        while ( i <= querrycount )
        begin
            if ( ( in_since_id is not null )
            and ( i = 1 ) )
            begin
                totalrecords2 = totalrecords ;
                records_processed2 = i * PageSize ;
            end
            else if ( ( in_since_id is not null )
            and ( i > 1 ) )
            begin
                records_processed2 = i * PageSize ;
            end
            IF ( ( NOT page_limit_exceeded )
            and ( ( in_since_id IS NULL )
            or ( in_since_id = 0 ) ) )
            BEGIN
                if ( ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) < PageSize )
                begin
                    PageSize = ( totalrecords - cast ( cast ( records_processed as string ) as integer ) ) ;
                end
                endpointstring = 'twitter_accounts/' || in_twit_acc_id || '/tweets?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                PageNum = PageNum + 1 ;
            END
            else
            begin
                if ( tmpMaxID is null )
                begin
                    endpointstring = 'twitter_accounts/' || in_twit_acc_id || '/tweets?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc' || NVL ( internal_since_id, '' ) ;
                end
                else
                begin
                    endpointstring = 'twitter_accounts/' || in_twit_acc_id || '/tweets?page=' || PageNum || '&per_page=' || PageSize || '&sort_field=created_at&sort_direction=asc&since_id=' || tmpMaxID ;
                end
                PageNum = PageNum + 1 ;
            end
            exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_twitter_accounts_tweets] Executing "' || endpointstring || '"' ) ;
            INSERT
                INTO tmpTable SELECT
                        "xml_table.id"
                        , substring ( "xml_table.body", 1, 4000 ) as body
                        , "xml_table.direction"
                        , "xml_table.type"
                        , "xml_table.status"
                        , "xml_table.to"
                        , "xml_table.from"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.created_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "created_at"
                        , PARSETIMESTAMP ( NULLIF ( "xml_table.updated_at", '' ), 'yyyy-MM-dd''T''hh:mm:ssX' ) as "updated_at"
                        , "xml_table.total_entries"
                        , "xml_table.page"
                    FROM
                        ( exec "desk_com_ws".invokeHTTP ( action => 'GET', requestContentType => 'application/json', endpoint => endpointstring ) ) w
                        , XMLTABLE ( XMLNAMESPACES ( 'http://www.w3.org/2001/XMLSchema-instance' as "xsi" ), '//entries' PASSING JSONTOXML ( 'root', to_chars ( w.result, 'UTF-8' ) ) COLUMNS "id" integer PATH 'id', "body" STRING PATH 'body', "direction" STRING PATH 'direction', "type" STRING PATH 'type', "status" STRING PATH 'status', "to" STRING PATH 'to', "from" STRING PATH 'from', "created_at" STRING PATH 'created_at', "updated_at" STRING PATH 'updated_at', "total_entries" STRING PATH '../../total_entries', "page" STRING PATH '../../page' ) "xml_table" ;
            if ( PageNum = PagesCountLimit )
            BEGIN
                page_limit_exceeded = true ;
                PageNum = 1 ;
                DELETE
                    FROM
                        TabTmpMax ;
                EXECUTE IMMEDIATE 'INSERT INTO TabTmpMax SELECT max ( id ) FROM tmpTable;' WITHOUT RETURN ;
                tmpMaxID = select
                        c
                    from
                        TabTmpMax ;
            END
            IF ( in_since_id IS NOT NULL )
            BEGIN
                if ( ( totalrecords2 - records_processed2 ) < PageSize ) PageSize = totalrecords2 - records_processed2 ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_twitter_accounts_tweets] Totalrecords from get_list_twitter_accounts_tweets are ' || totalrecords || '.
        Processed records are ' || records_processed2 ) ;
            end
            else
            BEGIN
                if ( totalrecords - cast ( cast ( records_processed as string ) as integer ) < PageSize ) PageSize = totalrecords - cast ( cast ( records_processed as string ) as integer ) ;
                records_processed = SELECT
                        count ( * )
                    FROM
                        tmpTable ;
                exec "SYSADMIN.logMsg" ( "level" => 'INFO', "context" => 'org.teiid.PROCESSOR', "msg" => '[desk_com_connector.get_list_twitter_accounts_tweets] Totalrecords from get_list_twitter_accounts_tweets are ' || totalrecords || '.
        Processed records are ' || records_processed ) ;
            end
            i = i + 1 ;
        end
        select
                *
            from
                tmpTable ;
    end
end	READY
196,709	2015-08-10 15:24:26		desk_com_connector.cases_dwh_update	"CREATE virtual procedure desk_com_connector.cases_dwh_update ( IN dwh_table string ) RETURNS ( ""id"" integer, ""blurb"" string, ""priority"" string, ""locked_until"" string, ""label_ids"" string, ""active_at"" timestamp, ""changed_at"" timestamp, ""created_at"" timestamp, ""updated_at"" timestamp, ""first_opened_at"" timestamp, ""opened_at"" timestamp, ""first_resolved_at"" timestamp, ""resolved_at"" timestamp, ""status"" string, ""active_notes_count"" string, ""active_attachments_count"" string, ""has_pending_interactions"" string, ""has_failed_interactions"" string, ""description"" string, ""language"" string, ""received_at"" timestamp, ""type"" string, ""labels"" string, ""subject"" string, ""custom_fields"" string, ""message_href"" string, ""customerid"" string, ""labels_href"" string, ""userid"" string, ""assigned_group"" string, ""locked_by"" string, ""history_href"" string, ""case_links_href"" string, ""macro_preview_href"" string, ""replies_href"" string, ""replies__count"" integer, ""notes_href"" string, ""notes_count"" integer, ""attachements_href"" string, ""attachements_count"" integer ) as
begin
    DECLARE string VARIABLES.dwh_schema = ( select
            nameindv
        from
            ( exec getCurrentDWH ( ) ) a ) ;
    IF ( VARIABLES.dwh_schema IS NULL )
    BEGIN
        ERROR 'DWH schema name cannot be NULL' ;
    END
    DECLARE string VARIABLES.vdb_name = 'datavirtuality' ;
    IF ( NOT EXISTS ( select
            *
        from
            SYS.Tables t
        where
            LCASE ( t.VDBName ) = LCASE ( VARIABLES.vdb_name )
            and LCASE ( t.schemaName ) = LCASE ( VARIABLES.dwh_schema )
            and LCASE ( ( t.schemaName || '.' || t.name ) ) = LCASE ( replace ( dwh_table, '""', '' ) ) ) )
    BEGIN
        error '
        		Please, first execute primary downloading cases procedure to DWH, and set table name equal to parameter dwh_table. ' ;
    END
    DECLARE integer tmpMaxID = null ;
    CREATE LOCAL TEMPORARY TABLE TabTmpMaxID ( c integer ) ;
    EXECUTE IMMEDIATE 'INSERT INTO TabTmpMaxID SELECT max ( id ) FROM ' || dwh_table WITHOUT RETURN ;
    tmpMaxID = select
            c
        from
            TabTmpMaxID ;
    call ""desk_com_connector.get_list_cases"" ( ""in_since_id"" => tmpMaxID, ""dwh_table"" => dwh_table ) WITHOUT RETURN ;
    execute immediate 'select * from ' || dwh_table as ""id"" integer
    , ""blurb"" string
    , ""priority"" string
    , ""locked_until"" string
    , ""label_ids"" string
    , ""active_at"" timestamp
    , ""changed_at"" timestamp
    , ""created_at"" timestamp
    , ""updated_at"" timestamp
    , ""first_opened_at"" timestamp
    , ""opened_at"" timestamp
    , ""first_resolved_at"" timestamp
    , ""resolved_at"" timestamp
    , ""status"" string
    , ""active_notes_count"" string
    , ""active_attachments_count"" string
    , ""has_pending_interactions"" string
    , ""has_failed_interactions"" string
    , ""description"" string
    , ""language"" string
    , ""received_at"" timestamp
    , ""type"" string
    , ""labels"" string
    , ""subject"" string
    , ""custom_fields"" string
    , ""message_href"" string
    , ""customerid"" string
    , ""labels_href"" string
    , ""userid"" string
    , ""assigned_group"" string
    , ""locked_by"" string
    , ""history_href"" string
    , ""case_links_href"" string
    , ""macro_preview_href"" string
    , ""replies_href"" string
    , ""replies__count"" integer
    , ""notes_href"" string
    , ""notes_count"" integer
    , ""attachements_href"" string
    , ""attachements_count"" integer ;
end"	READY
9	2015-04-24 18:08:59		affilinet_adv.GetOrders	"CREATE VIRTUAL PROCEDURE affilinet_adv.GetOrders(
IN program_id				integer,
IN start_date				date,
IN end_date				date,
IN valuation_type			string,
IN transaction_status		string,
IN basket_ids				string,
IN cancellation_reason		string,
IN channel1				integer,
IN channel2				integer,
IN creative_info			string,
IN net_price_max			double,
IN net_price_min			double,
IN order_id				string,
IN publisher_commission_max	double,
IN Publisher_commission_min	double,
IN publisher_ids			string,
IN publisher_segment		integer,
IN rate_mode				string,
IN rate_number				integer,
IN transaction_ids			string,
IN current_page			integer,
IN page_size				integer
)
RETURNS
(
	""auto_order_management_action"" string,
	""auto_order_management_action_date"" timestamp,
	""cancellation_reason"" string,
	""click_date"" timestamp,
	""last_status_change_date"" timestamp,
	""net_price"" double,
	""network_fee"" double,
	""order_id"" string,
	""publisher_commission"" double,
	""publisher_id"" integer,
	""registration_date"" timestamp,
	""transaction_id"" integer,
	""transaction_status"" string,
	""creative_info_creative_number"" integer,
	""creative_info_creative_type"" string,
	""rate_info_is_tiered_rate"" boolean,
	""rate_info_rate_description"" string,
	""rate_info_rate_mode"" string,
	""rate_info_rate_number"" integer,
	""rate_info_rate_value"" double
) 
AS BEGIN
DECLARE string		missing_arguments = '';
DECLARE string 	request_xml_1    ='';
DECLARE string 	request_xml_2    ='';
DECLARE integer	total_rows	= 300;
DECLARE integer	i_current_page		= 1;
DECLARE integer	i_page_size		= 150;

IF( current_page IS NOT NULL  ) 
	BEGIN
		i_current_page = current_page;
	END 
IF( page_size IS NOT NULL  ) 
	BEGIN
		i_page_size = page_size;
	END 
IF( program_id IS NULL  ) 
	BEGIN
		missing_arguments = missing_arguments || 'program_id, ';
	END 
IF( valuation_type IS NULL  ) 
	BEGIN
		missing_arguments = missing_arguments || 'valuation_type, ';
	END 
IF( transaction_status IS NULL  ) 
	BEGIN
		missing_arguments = missing_arguments || 'transaction_status, ';
	END 	
IF( start_date IS NULL  ) 
	BEGIN
		missing_arguments = missing_arguments || 'start_date, ';
	END 
IF( end_date IS NULL  ) 
	BEGIN
		missing_arguments = missing_arguments || 'end_date, ';
	END 
IF( missing_arguments <> ''  ) 
	BEGIN
		ERROR 'Arguments ' || missing_arguments || ' must not be empty';
	END 

request_xml_1 = CASE WHEN basket_ids IS NOT NULL THEN '<mes:BasketIds>' || basket_ids || '</mes:BasketIds>' ELSE '' END
			|| CASE WHEN cancellation_reason IS NOT NULL THEN '<mes:CancellationReason>' || cancellation_reason || '</mes:CancellationReason>' ELSE '' END
			|| CASE WHEN channel1 IS NOT NULL THEN '<mes:Channel1>' || channel1 || '</mes:Channel1>' ELSE '' END
			|| CASE WHEN channel2 IS NOT NULL THEN '<mes:Channel2>' || channel2 || '</mes:Channel2>' ELSE '' END
			|| CASE WHEN creative_info IS NOT NULL THEN '<mes:CreativeInfo>' || creative_info || '</mes:CreativeInfo>' ELSE '' END
			|| '<mes:EndDate>' || end_date || '</mes:EndDate>' 
			|| CASE WHEN net_price_max IS NOT NULL THEN '<mes:NetPriceMax>' || net_price_max || '</mes:NetPriceMax>' ELSE '' END
			|| CASE WHEN net_price_min IS NOT NULL THEN '<mes:NetPriceMin>' || net_price_min || '</mes:NetPriceMin>' ELSE '' END
			|| CASE WHEN order_id IS NOT NULL THEN '<mes:OrderId>' || order_id || '</mes:OrderId>' ELSE '' END
			|| '<mes:Page>';
request_xml_2 =  '</mes:Page>'
			|| '<mes:PageSize>' || i_page_size || '</mes:PageSize>'
			|| '<mes:ProgramId>' || program_id || '</mes:ProgramId>'
			|| CASE WHEN publisher_commission_max IS NOT NULL THEN '<mes:PublisherCommissionMax>' || publisher_commission_max || '</mes:PublisherCommissionMax>' ELSE '' END
			|| CASE WHEN Publisher_commission_min IS NOT NULL THEN '<mes:PublisherCommissionMin>' || Publisher_commission_min || '</mes:PublisherCommissionMin>' ELSE '' END
			|| CASE WHEN publisher_ids IS NOT NULL THEN '<mes:PublisherIds>' || publisher_ids || '</mes:PublisherIds>' ELSE '' END
			|| CASE WHEN publisher_segment IS NOT NULL THEN '<mes:PublisherSegment>' || publisher_segment|| '</mes:PublisherSegment>' ELSE '' END
			|| CASE WHEN rate_mode IS NOT NULL THEN '<mes:RateMode>' || rate_mode || '</mes:RateMode>' ELSE '' END
			|| CASE WHEN rate_number IS NOT NULL THEN '<mes:RateNumber>' || rate_number || '</mes:RateNumber>' ELSE '' END
			|| '<mes:StartDate>' || start_date || '</mes:StartDate>'
			|| CASE WHEN transaction_ids IS NOT NULL THEN '<mes:TransactionIds>' || transaction_ids || '</mes:TransactionIds>' ELSE '' END
			|| '<mes:TransactionStatus>' || transaction_status || '</mes:TransactionStatus>
			   <mes:ValuationType>' || valuation_type || '</mes:ValuationType>';
			   
SELECT * INTO #data 
  FROM (
	   call affilinet_adv.parseGetOrders
	   (
	      (
	       CALL affilinet_adv.OrderManagement( 'GetOrders', request_xml_1 || i_current_page || request_xml_2 )
	      ) 
	   )
) response;
i_current_page = 2;
total_rows=(SELECT ""total_count"" from #data LIMIT 1 );	
WHILE ( i_current_page < ( total_rows / i_page_size ) + 2 )
	BEGIN
		INSERT INTO #data SELECT * 
		 FROM (
			   call affilinet_adv.parseGetOrders
			   (
			      (
			       CALL affilinet_adv.OrderManagement( 'GetOrders', request_xml_1 || i_current_page || request_xml_2 )
			      ) 
			   )
		) response;
		i_current_page = i_current_page + 1;
	END
select * from #data;
END"	READY
10	2015-04-24 18:09:09		affilinet_adv.GetStatisticsPerPublisherQuery	"CREATE VIRTUAL PROCEDURE affilinet_adv.GetStatisticsPerPublisherQuery(
IN program_id			integer,
IN start_date			date,
IN end_date			date,
IN channel1			integer,
IN channel2			integer,
IN creative_number		integer,
IN creative_type		string,
IN PublisherId			integer,
IN PublisherName		string,
IN PublisherSegment		integer,
IN PublisherURL		string,
IN RateQueryCollection	string,
IN ValuationType		string,
IN VolumeMax			integer,
IN VolumeMin			integer,
IN VolumeType			string,
IN VolumeTypeRateNumber	integer,
IN show_details		boolean,
IN current_page		integer,
IN page_size			integer
)
RETURNS
(
 currency string,
 publisher_id string,
 publisher_url string,
 bonus_count_cancelled_count long,
 bonus_count_confirmed_count long,
 bonus_count_open_count long,
 bonus_network_fee_cancelled_value double,
 bonus_network_fee_confirmed_value double,
 bonus_network_fee_open_value double,
 bonus_publisher_commission_cancelled_value double,
 bonus_publisher_commission_confirmed_value double,
 bonus_publisher_commission_open_value double,
 click_outs_total_count_cancelled_count long,
 click_outs_total_count_confirmed_count long,
 click_outs_total_count_open_count long,
 click_outs_total_net_price_cancelled_value double,
 click_outs_total_net_price_confirmed_value double,
 click_outs_total_net_price_open_value double,
 click_outs_total_network_fee_cancelled_value double,
 click_outs_total_network_fee_confirmed_value double,
 click_outs_total_network_fee_open_value double,
 click_outs_total_publisher_commission_cancelled_value double,
 click_outs_total_publisher_commission_confirmed_value double,
 click_outs_total_publisher_commission_open_value double,
 clicks_gross_count long,
 clicks_net_count long,
 clicks_network_fee double,
 clicks_publisher_commission double,
 leads_total_count_cancelled_count long,
 leads_total_count_confirmed_count long,
 leads_total_count_open_count long,
 leads_total_net_price_cancelled_value double,
 leads_total_net_price_confirmed_value double,
 leads_total_net_price_open_value double,
 leads_total_network_fee_cancelled_value double,
 leads_total_network_fee_confirmed_value double,
 leads_total_network_fee_open_value double,
 leads_total_publisher_commission_cancelled_value double,
 leads_total_publisher_commission_confirmed_value double,
 leads_total_publisher_commission_open_value double,
 net_price_summary_cancelled_value double,
 net_price_summary_confirmed_value double,
 net_price_summary_open_value double,
 network_fee_summary_cancelled_value double,
 network_fee_summary_confirmed_value double,
 network_fee_summary_open_value double,
 publisher_commission_summary_cancelled_value double,
 publisher_commission_summary_confirmed_value double,
 publisher_commission_summary_open_value double,
 sales_total_count_cancelled_count long,
 sales_total_count_confirmed_count long,
 sales_total_count_open_count long,
 sales_total_net_price_cancelled_value string,
 sales_total_net_price_confirmed_value double,
 sales_total_net_price_open_value double,
 sales_total_network_fee_cancelled_value double,
 sales_total_network_fee_confirmed_value double,
 sales_total_network_fee_open_value double,
 sales_total_publisher_commission_cancelled_value double,
 sales_total_publisher_commission_confirmed_value double,
 sales_total_publisher_commission_open_value double,
 Views_GrossCount long,
 Views_NetCount long,
 Views_NetworkFee double,
 Views_PublisherCommission double
) 
AS BEGIN
DECLARE string		missing_arguments = '';
DECLARE string 	request_xml_1    ='';
DECLARE string 	request_xml_2    ='';
DECLARE integer	total_rows	= 300;
DECLARE integer	i_current_page		= 1;
DECLARE integer	i_page_size		= 150;
DECLARE boolean	i_show_details		= false;
IF( current_page IS NOT NULL  ) 
	BEGIN
		i_current_page = current_page;
	END 
IF( page_size IS NOT NULL  ) 
	BEGIN
		i_page_size = page_size;
	END 
IF( show_details IS NOT NULL  ) 
	BEGIN
		i_show_details = show_details;
	END 
IF( program_id IS NULL  ) 
	BEGIN
		missing_arguments = missing_arguments || 'program_id, ';
	END 
IF( start_date IS NULL  ) 
	BEGIN
		missing_arguments = missing_arguments || 'start_date, ';
	END 
IF( end_date IS NULL  ) 
	BEGIN
		missing_arguments = missing_arguments || 'end_date, ';
	END 
IF( missing_arguments <> ''  ) 
	BEGIN
		ERROR 'Arguments ' || missing_arguments || ' must not be empty';
	END 
request_xml_1 = '<mes:DisplaySettings>
			<typ:CurrentPage>';
request_xml_2 = '</typ:CurrentPage>
			<typ:PageSize>' || i_page_size || '</typ:PageSize>
		</mes:DisplaySettings>
		<mes:GetStatisticsPerPublisherQuery>
			<typ:EndDate>' || end_date || '</typ:EndDate>
			<typ:ProgramId>' || program_id || '</typ:ProgramId>
			<typ:ShowDetails>' || i_show_details || '</typ:ShowDetails>
			<typ:StartDate>' || start_date || '</typ:StartDate>'
			|| CASE WHEN channel1 IS NOT NULL THEN '<typ:Channel1>' || channel1 || '</typ:Channel1>' ELSE '' END
			|| CASE WHEN channel2 IS NOT NULL THEN '<typ:Channel2>' || channel2 || '</typ:Channel2>' ELSE '' END
			|| CASE WHEN creative_number IS NOT NULL THEN '<typ:CreativeNumber>' || creative_number || '</typ:CreativeNumber>' ELSE '' END
			|| CASE WHEN creative_type IS NOT NULL THEN '<typ:CreativeType>' || creative_type || '</typ:CreativeType>' ELSE '' END
			|| CASE WHEN PublisherId IS NOT NULL THEN '<typ:PublisherId>' || PublisherId || '</typ:PublisherId>' ELSE '' END
			|| CASE WHEN PublisherName IS NOT NULL THEN '<typ:PublisherName>' || PublisherName || '</typ:PublisherName>' ELSE '' END
			|| CASE WHEN PublisherSegment IS NOT NULL THEN '<typ:PublisherSegment>' || PublisherSegment || '</typ:PublisherSegment>' ELSE '' END
			|| CASE WHEN PublisherURL IS NOT NULL THEN '<typ:PublisherURL>' || PublisherURL || '</typ:PublisherURL>' ELSE '' END
			|| CASE WHEN RateQueryCollection IS NOT NULL THEN '<typ:RateQueryCollection>' || RateQueryCollection || '</typ:RateQueryCollection>' ELSE '' END
			|| CASE WHEN ValuationType IS NOT NULL THEN '<typ:ValuationType>' || ValuationType || '</typ:ValuationType>' ELSE '' END
			|| CASE WHEN VolumeMax IS NOT NULL THEN '<VolumeMax>' || VolumeMax || '</VolumeMax>' ELSE '' END
			|| CASE WHEN VolumeMin IS NOT NULL THEN '<typ:VolumeMin>' || VolumeMin || '</typ:VolumeMin>' ELSE '' END
			|| CASE WHEN VolumeType IS NOT NULL THEN '<typ:VolumeType>' || VolumeType || '</typ:VolumeType>' ELSE '' END
			|| CASE WHEN VolumeTypeRateNumber IS NOT NULL THEN '<typ:VolumeTypeRateNumber>' || VolumeTypeRateNumber || '</typ:VolumeTypeRateNumber>' ELSE '' END
		|| '</mes:GetStatisticsPerPublisherQuery>';
SELECT * INTO #data 
  FROM (
	   call affilinet_adv.parseGetStatisticsPerPublisher
	   (
	      (
	       CALL affilinet_adv.Statistics( 'GetStatisticsPerPublisher', request_xml_1 || i_current_page || request_xml_2 )
	      ) 
	   )
) response;
i_current_page = 2;
total_rows=(SELECT ""TotalCount"" from #data LIMIT 1 );	
WHILE ( i_current_page < ( total_rows / i_page_size ) + 2 )
	BEGIN
		INSERT INTO #data SELECT * 
		 FROM (
			   call affilinet_adv.parseGetStatisticsPerPublisher
			   (
			      (
			       CALL affilinet_adv.Statistics( 'GetStatisticsPerPublisher', request_xml_1 || i_current_page || request_xml_2 )
			      ) 
			   )
		) response;
		i_current_page = i_current_page + 1;
	END
select * from #data;
END"	READY
229,376	2015-09-04 11:20:40		raw.getcurDWH	"CREATE VIRTUAL PROCEDURE raw.getcurDWH ()  RETURNS ( cdwh string )
AS 
BEGIN
select  cast (nameInDv as string) as cdwh
        from
            ( exec getCurrentDWH ( ) )a;
END"	READY
262,148	2015-09-08 12:02:17		raw.sec_2_hrmisec	"CREATE virtual procedure raw.sec_2_hrmisec (IN in_seconds long ) RETURNS (""hms"" string) 
as
begin
    DECLARE long VARIABLES.MINUTES_IN_AN_HOUR = 60;
    DECLARE long VARIABLES.SECONDS_IN_A_MINUTE = 60;
    
    DECLARE long VARIABLES.local_second=in_seconds;
    DECLARE long VARIABLES.hours=0;
    DECLARE long VARIABLES.minutes=0;
    DECLARE string hms=null;
    
    VARIABLES.minutes = VARIABLES.local_second / VARIABLES.SECONDS_IN_A_MINUTE;
    VARIABLES.local_second = VARIABLES.local_second - (minutes * VARIABLES.SECONDS_IN_A_MINUTE);

    VARIABLES.hours = (VARIABLES.minutes / VARIABLES.MINUTES_IN_AN_HOUR);
    VARIABLES.minutes = VARIABLES.minutes - (VARIABLES.hours * VARIABLES.MINUTES_IN_AN_HOUR);
	
	hms = lpad(cast(VARIABLES.hours as string),2,0)||':'||lpad(cast(VARIABLES.minutes as string),2,0)||':'||lpad(cast(VARIABLES.local_second as string),2,0);
	select hms;
end"	READY
262,149	2015-09-08 12:12:37		raw.test_sec_conv	"CREATE virtual procedure raw.test_sec_conv() as
begin
	DECLARE string p =  (call  ""raw.sec_2_hrmisec""(9945));	
	insert into test_sec_tab (p_t) values (p);
end"	READY
11	2015-04-24 18:09:56		affilinet_adv.GetRateList	"CREATE VIRTUAL PROCEDURE affilinet_adv.GetRateList
(
   IN ProgramId integer
)
RETURNS (RateNumber integer, RateMode string, RateName string) AS BEGIN
SELECT
xml_table.RateNumber, xml_table.RateMode, xml_table.RateName
FROM (EXEC affilinet_adv.Toolbox('GetRateList', (('<mes:ProgramId>' || ProgramId) || '</mes:ProgramId>'))) AS f,
XMLTABLE
(
   XMLNAMESPACES('http://schemas.xmlsoap.org/soap/envelope/' AS s, 'http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' AS u,
   'http://affilinet.framework.esbfa/advertiserservices/toolbox/types' AS a),
   '//a:RateCollection' PASSING f.response COLUMNS RateNumber integer PATH 'a:RateNumber',
   RateMode string PATH 'a:RateMode',
   RateName string PATH 'a:RateName'
)
AS xml_table;
END"	READY
5	2015-04-24 18:08:19		affilinet_adv.Toolbox	"CREATE VIRTUAL PROCEDURE affilinet_adv.Toolbox(IN do_action string, IN request_xml string) RETURNS (response xml) AS
BEGIN
SELECT * FROM TABLE(EXEC affilinet_src.invoke(binding => 'SOAP11', action => ('http://affilinet.framework.esbfa/advertiserservices/toolbox/AdvertiserToolboxContract/' || do_action), request => XMLPARSE(CONTENT (((((((('<SOAP-ENV:Envelope xmlns:SOAP-ENV=""http://schemas.xmlsoap.org/soap/envelope/"" xmlns:mes=""http://affilinet.framework.esbfa/advertiserservices/toolbox/messages"" xmlns:ns2=""http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"" xmlns:ns3=""http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"">' || (SELECT * FROM (EXEC affilinet_adv.wssec_soap_auth()) AS x)) || '<SOAP-ENV:Body>
    <mes:') || do_action) || 'Request>
      ') || request_xml) || '
    </mes:') || do_action) || 'Request>
  </SOAP-ENV:Body>
</SOAP-ENV:Envelope>')), endpoint => 'https://advertiser-webservices.affili.net/V3/advertiserservice.svc')) AS c;
END"	READY
6	2015-04-24 18:08:19		affilinet_adv.OrderManagement	"CREATE VIRTUAL PROCEDURE affilinet_adv.OrderManagement(IN do_action string, IN request_xml string) RETURNS ( response xml ) AS
BEGIN

SELECT * FROM TABLE(EXEC affilinet_src.invoke(binding => 'SOAP11', action => ('http://affilinet.framework.esbfa/advertiserservices/ordermanagement/OrderManagementContract/' || do_action), request => XMLPARSE(CONTENT (((((((('<SOAP-ENV:Envelope xmlns:SOAP-ENV=""http://schemas.xmlsoap.org/soap/envelope/"" xmlns:mes=""http://affilinet.framework.esbfa/advertiserservices/ordermanagement/messages"" xmlns:arr=""http://schemas.microsoft.com/2003/10/Serialization/Arrays"" xmlns:typ=""http://affilinet.framework.esbfa/advertiserservices/ordermanagement/types"" xmlns:ns2=""http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"" xmlns:ns3=""http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"">' || (SELECT * FROM (EXEC affilinet_adv.wssec_soap_auth()) AS x)) || '<SOAP-ENV:Body>
    <mes:') || do_action) || 'Request>
      ') || request_xml) || '
    </mes:') || do_action) || 'Request>
  </SOAP-ENV:Body>
</SOAP-ENV:Envelope>')), endpoint => 'https://advertiser-webservices.affili.net/V4/advertiserservice.svc')) AS c;

END"	READY
7	2015-04-24 18:08:29		affilinet_adv.Statistics	"CREATE VIRTUAL PROCEDURE affilinet_adv.Statistics(IN do_action string, IN request_xml string) RETURNS (response xml) AS
BEGIN
SELECT * FROM TABLE(EXEC affilinet_src.invoke(binding => 'SOAP11', action => ('http://affilinet.framework.esbfa/advertiserservices/statistics/AdvertiserStatisticsContract/' || do_action), request => XMLPARSE(CONTENT (((((((('<SOAP-ENV:Envelope xmlns:SOAP-ENV=""http://schemas.xmlsoap.org/soap/envelope/"" xmlns:mes=""http://affilinet.framework.esbfa/advertiserservices/statistics/messages""  xmlns:typ=""http://affilinet.framework.esbfa/advertiserservices/statistics/types"" xmlns:ns2=""http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"" xmlns:ns3=""http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"">' || (SELECT * FROM (EXEC affilinet_adv.wssec_soap_auth()) AS x)) || '<SOAP-ENV:Body>
	    <mes:') || do_action) || 'Request>
	     ') || request_xml) || '
	    </mes:') || do_action) || 'Request>
	  </SOAP-ENV:Body>
	</SOAP-ENV:Envelope>')), endpoint => 'https://advertiser-webservices.affili.net/V4/advertiserservice.svc')) AS c;
END"	READY
8	2015-04-24 18:08:44		affilinet_adv.GetChannels	"CREATE VIRTUAL PROCEDURE affilinet_adv.GetChannels
(
   IN ChannelGroup string, IN ProgramId integer
)
RETURNS
(
   ChannelId integer, ChannelName string, ChannelGroupName string
)
AS BEGIN
SELECT
parseinteger(xml_table.ChannelId, '') AS ChannelId,
xml_table.ChannelName,
xml_table.ChannelGroupName
FROM (EXEC affilinet_adv.Toolbox('GetChannels', ((((' <mes:ChannelGroup>' || ChannelGroup) || '</mes:ChannelGroup><mes:ProgramId>') || ProgramId) || '</mes:ProgramId>'))) AS f,
XMLTABLE
(
   XMLNAMESPACES( 
   'http://schemas.xmlsoap.org/soap/envelope/' AS s,
   'http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' AS u,
   'http://affilinet.framework.esbfa/advertiserservices/toolbox/types' AS a,
   'http://affilinet.framework.esbfa/advertiserservices/toolbox/messages' AS m),
   '//a:ChannelCollection' PASSING f.response COLUMNS a xml PATH '.',
   ChannelId STRING PATH 'a:ChannelId',
   ChannelName STRING PATH 'a:ChannelName',
   ChannelGroupName STRING PATH '../../m:ChannelGroupName'
)
AS xml_table;
END"	READY
12	2015-04-24 18:09:56		affilinet_adv.GetPublisherSegments	"CREATE VIRTUAL PROCEDURE affilinet_adv.GetPublisherSegments
(
   IN ProgramId integer
)
RETURNS (SegmentId integer, Description string, SegmentName string) AS BEGIN
SELECT
xml_table.SegmentId, xml_table.Description, xml_table.SegmentName
FROM (EXEC affilinet_adv.Toolbox('GetPublisherSegments', (('<mes:ProgramId>' || ProgramId) || '</mes:ProgramId>'))) AS f,
XMLTABLE
(
   XMLNAMESPACES('http://schemas.xmlsoap.org/soap/envelope/' AS s,
   'http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' AS u,
   'http://affilinet.framework.esbfa/advertiserservices/toolbox/types' AS a),
   '//a:PublisherSegmentCollection' PASSING f.response COLUMNS SegmentId integer PATH 'a:SegmentId',
   Description string PATH 'a:Description',
   SegmentName string PATH 'a:SegmentName'
)
AS xml_table;
END"	READY
13	2015-04-24 18:09:56		affilinet_adv.GetCreativesPerType	"CREATE VIRTUAL PROCEDURE affilinet_adv.GetCreativesPerType
(
   IN CreativeType string, IN ProgramId integer
)
RETURNS (CreativeNumber integer, CreativeName string) AS BEGIN
SELECT
parseinteger(xml_table.CreativeNumber, '') AS CreativeNumber,
xml_table.CreativeName
FROM (EXEC affilinet_adv.Toolbox('GetCreativesPerType', ((((' <mes:CreativeType>' || CreativeType) || '</mes:CreativeType><mes:ProgramId>') || ProgramId) || '</mes:ProgramId>'))) AS f,
XMLTABLE
(
   XMLNAMESPACES('http://schemas.xmlsoap.org/soap/envelope/' AS s,
   'http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' AS u,
   'http://affilinet.framework.esbfa/advertiserservices/toolbox/types' AS a),
   '//a:CreativeCollection' PASSING f.response COLUMNS CreativeNumber STRING PATH 'a:CreativeNumber',
   CreativeName STRING PATH 'a:CreativeName'
)
AS xml_table;
END"	READY
